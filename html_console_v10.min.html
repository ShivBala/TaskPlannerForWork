<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Enterprise Project Scheduler with Task Tracking</title><script src="https://cdn.tailwindcss.com"></script><style>:root{--primary-color:#1e3a8a;--secondary-color:#374151;--accent-color:#059669;--warning-color:#d97706;--danger-color:#dc2626;--background-color:#f8fafc;--card-background:#ffffff;--border-color:#e5e7eb;}body{font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;background:linear-gradient(135deg,#f1f5f9 0%,#e2e8f0 100%);color:var(--secondary-color);}.enterprise-container{max-width:1600px;}.input-card,.output-card{background:var(--card-background);border:1px solid var(--border-color);box-shadow:0 2px 4px rgba(0,0,0,0.05);transition:all 0.2s ease;}.input-card.dirty,.output-card.dirty,div.card.dirty{background:#f0fdfa !important;border:1px solid #5eead4 !important;box-shadow:0 2px 4px rgba(45,212,191,0.1) !important;}.dirty{background-color:#f0fdfa !important;border-color:#5eead4 !important;}.input-card:hover,.output-card:hover{box-shadow:0 4px 6px rgba(0,0,0,0.07);}.input-card.dirty:hover,.output-card.dirty:hover,.card.dirty:hover{box-shadow:0 4px 6px rgba(45,212,191,0.15);}.enterprise-header{background:linear-gradient(135deg,var(--primary-color) 0%,#1e40af 100%);color:white;border-bottom:3px solid var(--accent-color);}.task-size-manager{background:linear-gradient(135deg,var(--primary-color) 0%,#1e40af 100%);color:white;border-radius:8px;padding:16px;margin-bottom:16px;}.task-size-card{background:rgba(255,255,255,0.1);border-radius:4px;padding:4px 8px;margin-bottom:0;backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,0.2);transition:all 0.3s ease;display:inline-flex;flex-direction:column;align-items:center;min-width:80px;max-width:100px;}.task-size-card:hover{background:rgba(255,255,255,0.15);transform:translateY(-2px);}.size-input-enhanced{background:rgba(255,255,255,0.9);border:none;border-radius:3px;padding:3px 6px;color:var(--secondary-color);font-weight:600;text-align:center;width:50px;font-size:10px;}.size-controls{display:flex;flex-direction:column;align-items:center;gap:3px;flex-wrap:nowrap;width:100%;}.size-label-enhanced{font-weight:bold;font-size:11px;min-width:auto;text-align:center;}.size-metrics{font-size:9px;opacity:0.9;margin-top:2px;text-align:center;white-space:nowrap;}.preset-btn{background:rgba(255,255,255,0.2);border:1px solid rgba(255,255,255,0.3);color:white;padding:4px 10px;border-radius:4px;font-size:11px;cursor:pointer;transition:all 0.3s ease;}.preset-btn:hover{background:rgba(255,255,255,0.3);transform:translateY(-1px);}.custom-size-form{background:rgba(255,255,255,0.1);border-radius:6px;padding:12px;margin-top:12px;border:1px dashed rgba(255,255,255,0.3);}.timeline-container{background:linear-gradient(135deg,#f0f9ff 0%,#e0f2fe 100%);border:1px solid #bae6fd;}.timeline-scroll-container{scrollbar-width:thin;scrollbar-color:#6b7280 #f3f4f6;}.timeline-scroll-container::-webkit-scrollbar{width:12px;height:12px;}.timeline-scroll-container::-webkit-scrollbar-track{background:#f3f4f6;border-radius:6px;}.timeline-scroll-container::-webkit-scrollbar-thumb{background:#6b7280;border-radius:6px;border:2px solid #f3f4f6;}.timeline-scroll-container::-webkit-scrollbar-thumb:hover{background:#4b5563;}.timeline-scroll-container::-webkit-scrollbar-corner{background:#f3f4f6;}.modal-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(30,58,138,0.4);display:flex;align-items:center;justify-content:center;z-index:1000;opacity:0;visibility:hidden;transition:all 0.3s ease;}.modal-overlay.active{opacity:1;visibility:visible;}.modal-content{background:var(--card-background);border-radius:8px;padding:20px;max-width:600px;max-height:80vh;overflow-y:auto;box-shadow:0 20px 25px -5px rgba(0,0,0,0.1),0 10px 10px -5px rgba(0,0,0,0.04);transform:scale(0.9);transition:transform 0.3s ease;margin:20px;width:calc(100% - 40px);border:2px solid var(--primary-color);}@media (min-width:640px){.modal-content{width:auto;margin:0;}}.modal-overlay.active .modal-content{transform:scale(1);}.modal-header{border-bottom:2px solid var(--primary-color);padding-bottom:12px;margin-bottom:16px;display:flex;justify-content:space-between;align-items:center;}.modal-title{font-size:16px;font-weight:600;color:var(--primary-color);}.modal-close{background:none;border:none;font-size:20px;cursor:pointer;color:var(--secondary-color);padding:4px;border-radius:4px;transition:background-color 0.2s;}.modal-close:hover{background-color:#f3f4f6;}.calculation-details{font-family:'Courier New',monospace;font-size:12px;line-height:1.5;white-space:pre-wrap;background:#f8fafc;padding:12px;border-radius:6px;border-left:4px solid var(--primary-color);max-height:350px;overflow-y:auto;}.details-btn{background:var(--primary-color);color:white;border:none;padding:3px 6px;border-radius:3px;font-size:10px;cursor:pointer;margin-left:6px;transition:background-color 0.2s;}.details-btn:hover{background:#1e40af;}.size-dropdown{border:1px solid var(--border-color);border-radius:4px;padding:3px 6px;font-size:11px;font-weight:600;color:var(--primary-color);background:white;cursor:pointer;transition:all 0.2s ease;width:100%;min-width:70px;}.size-dropdown:hover{border-color:var(--primary-color);box-shadow:0 0 0 1px var(--primary-color);}.size-dropdown:focus{outline:none;border-color:var(--primary-color);box-shadow:0 0 0 2px rgba(30,58,138,0.2);}.size-dropdown option{padding:3px;font-weight:normal;}.timeline-marker{position:absolute;width:16px;height:16px;border-radius:50%;cursor:pointer;transition:all 0.3s ease;top:50%;transform:translateY(-50%);z-index:100;}.timeline-marker:hover{transform:translateY(-50%) scale(1.2);z-index:101;}.timeline-marker.active{transform:translateY(-50%) scale(1.4);z-index:102;}.timeline-tooltip{position:absolute;bottom:150%;left:50%;transform:translateX(-50%);background:rgba(0,0,0,0.9);color:white;padding:12px 16px;border-radius:8px;font-size:13px;font-weight:500;white-space:normal;pointer-events:none;opacity:0;transition:all 0.3s ease;z-index:1000;box-shadow:0 4px 12px rgba(0,0,0,0.4);margin-bottom:12px;min-width:350px;max-width:450px;width:400px;text-align:left;line-height:1.4;}.timeline-tooltip.visible{opacity:1;transform:translateX(-50%) translateY(-8px);}.timeline-tooltip.tooltip-left.visible{opacity:1;transform:translateX(0) translateY(-8px);}.timeline-tooltip.tooltip-right.visible{opacity:1;transform:translateX(0) translateY(-8px);}.timeline-tooltip.tooltip-center.visible{opacity:1;transform:translateX(-50%) translateY(-8px);}.timeline-tooltip::after{content:'';position:absolute;top:100%;left:50%;transform:translateX(-50%);border:8px solid transparent;border-top-color:rgba(0,0,0,0.9);}.timeline-tooltip.tooltip-left::after{left:20px;transform:translateX(0);}.timeline-tooltip.tooltip-right::after{left:auto;right:20px;transform:translateX(0);}.timeline-delayed{background:linear-gradient(45deg,var(--danger-color) 0%,#b91c1c 100%);}.timeline-ontime{background:linear-gradient(45deg,var(--accent-color) 0%,#047857 100%);}.timeline-legend-item{display:flex;align-items:center;gap:4px;padding:2px 6px;background:rgba(255,255,255,0.8);border-radius:10px;border:1px solid rgba(0,0,0,0.1);font-size:11px;}.timeline-legend-dot{width:6px;height:6px;border-radius:50%;}.tooltip-container{position:relative;cursor:pointer;}.tooltip-text{visibility:hidden;width:280px;background-color:var(--secondary-color);color:#fff;text-align:left;border-radius:6px;padding:8px;position:absolute;z-index:10;bottom:125%;left:50%;margin-left:-140px;opacity:0;transition:opacity 0.3s;font-size:0.8rem;pointer-events:none;white-space:pre-wrap;}.tooltip-container:hover .tooltip-text{visibility:visible;opacity:1;}.select-multiple{appearance:none;-webkit-appearance:none;-moz-appearance:none;background-image:url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20' fill='none' stroke='%236b7280'%3e%3cpath d='M7 7l3-3 3 3m0 6l-3 3-3-3' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'/%3e%3c/svg%3e");background-repeat:no-repeat;background-position:right 0.5rem center;background-size:1.5em;}.compact-spacing{gap:12px;}.compact-card{padding:12px;}.btn-enterprise{background:var(--primary-color);color:white;border:none;padding:8px 16px;border-radius:4px;font-weight:500;cursor:pointer;transition:all 0.2s ease;font-size:13px;}.btn-enterprise:hover{background:#1e40af;transform:translateY(-1px);box-shadow:0 2px 4px rgba(0,0,0,0.1);}.btn-secondary{background:var(--secondary-color);}.btn-secondary:hover{background:#4b5563;}.btn-success{background:var(--accent-color);}.btn-success:hover{background:#047857;}.btn-danger{background:var(--danger-color);}.btn-danger:hover{background:#b91c1c;}#main-content{display:block !important;margin-bottom:2rem !important;}@media (max-width:1024px){#main-content{display:block !important;}.task-config-container{width:100% !important;float:none !important;margin-right:0 !important;margin-bottom:20px !important;}}.task-config-container{width:100% !important;max-width:100% !important;float:none !important;margin-right:0 !important;margin-bottom:20px !important;margin-top:20px !important;}.task-management-area{width:100% !important;overflow:visible !important;}#task-size-cards{display:flex !important;flex-direction:row !important;flex-wrap:wrap !important;gap:8px !important;margin-bottom:12px !important;}#task-size-cards > *{margin-top:0 !important;flex:0 0 auto !important;}.team-availability-scroll{scrollbar-width:thin;scrollbar-color:#cbd5e1 #f1f5f9;position:relative;}.team-availability-scroll::-webkit-scrollbar{width:6px;}.team-availability-scroll::-webkit-scrollbar-track{background:#f1f5f9;border-radius:3px;}.team-availability-scroll::-webkit-scrollbar-thumb{background:#cbd5e1;border-radius:3px;}.team-availability-scroll::-webkit-scrollbar-thumb:hover{background:#94a3b8;}.team-availability-scroll::after{content:'';position:absolute;bottom:0;left:0;right:0;height:20px;background:linear-gradient(transparent,rgba(248,250,252,0.8));pointer-events:none;border-radius:0 0 8px 8px;}.team-availability-scroll .person-card{transition:all 0.2s ease;}.team-availability-scroll .person-card:hover{transform:translateX(2px);box-shadow:0 2px 4px rgba(0,0,0,0.1);}.enterprise-table{font-size:12px;}.enterprise-table th{padding:8px 12px;background:var(--primary-color);color:white;font-weight:600;text-transform:uppercase;font-size:10px;letter-spacing:0.5px;}.enterprise-table td{padding:6px 12px;border-bottom:1px solid var(--border-color);}.enterprise-table tr:hover{background:rgba(30,58,138,0.03);}.enterprise-input{background:var(--card-background);border:2px solid var(--border-color);border-radius:6px;padding:8px 12px;color:var(--secondary-color);font-weight:500;transition:all 0.2s ease;outline:none;}.enterprise-input:focus{border-color:var(--primary-color);box-shadow:0 0 0 3px rgba(30,58,138,0.1);}.enterprise-input:hover{border-color:var(--primary-color);}.form-section{transition:all 0.3s ease;}.form-section:hover{transform:translateY(-1px);box-shadow:0 4px 12px rgba(0,0,0,0.05);}.compact-grid{gap:0.75rem;}.compact-grid input,.compact-grid select{height:36px;}.btn-enterprise{position:relative;overflow:hidden;}.btn-enterprise::before{content:'';position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,0.2),transparent);transition:left 0.5s;}.btn-enterprise:hover::before{left:100%;}.section-header{border-bottom:2px solid #e5e7eb;margin-bottom:1rem;padding-bottom:0.5rem;}input,select,button,.card{transition:all 0.2s cubic-bezier(0.4,0,0.2,1);}.mb-tight{margin-bottom:0.5rem;}.mt-tight{margin-top:0.5rem;}.space-y-tight > * + *{margin-top:0.75rem;}.status-badge{display:inline-flex;align-items:center;padding:4px 8px;border-radius:12px;font-size:11px;font-weight:600;cursor:pointer;transition:all 0.2s ease;border:1px solid transparent;white-space:nowrap;user-select:none;}.status-badge:hover{transform:translateY(-1px);box-shadow:0 2px 4px rgba(0,0,0,0.1);}.status-badge.status-done{background:#dbeafe;color:#1e40af;border-color:#93c5fd;}.status-badge.status-todo:hover{background:#bfdbfe;}.status-badge.status-closed{background:#6b7280;color:#fff;border-color:#6b7280;}.status-badge.status-closed:hover{background:#374151;border-color:#374151;}.status-badge.status-inprogress{background:#fef3c7;color:#d97706;border-color:#fcd34d;}.status-badge.status-inprogress:hover{background:#fde68a;}.status-badge.status-paused{background:#fed7aa;color:#ea580c;border-color:#fdba74;}.status-badge.status-paused:hover{background:#fec996;}.status-badge.status-done{background:#dcfce7;color:#166534;border-color:#86efac;}.status-badge.status-done:hover{background:#bbf7d0;}</style></head><body class="p-4 md:p-8"><div id="app" class="enterprise-container mx-auto"><div class="enterprise-header flex justify-between items-center mb-4 p-4 rounded-lg"><h1 class="text-2xl font-bold">Enterprise Project Tracking Console</h1><div class="flex gap-2"><button id="export-closed-btn" onclick="exportClosedItems()" class="btn-enterprise flex items-center" disabled><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                    Export Closed
                </button><button onclick="exportConfiguration()" class="btn-enterprise flex items-center"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" /></svg>
                    Export Config
                </button><button onclick="triggerImport()" class="btn-enterprise flex items-center"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10" /></svg>
                    Import Config
                </button><button onclick="triggerTaskImport()" class="btn-enterprise flex items-center"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" /></svg>
                    Import Tasks
                </button><button onclick="exportData()" class="btn-enterprise flex items-center"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" /></svg>
                    Export Schedule
                </button><button onclick="resetToDefaults()" class="btn-danger flex items-center"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" /></svg>
                    Reset
                </button></div></div><p id="auth-status" class="text-xs text-gray-600 mb-3">📊 Enterprise data management - All information stored securely in browser storage.</p><input type="file" id="import-config-file" accept=".csv" style="display: none;" onchange="handleConfigImport(event)"><input type="file" id="import-tasks-file" accept=".csv" style="display: none;" onchange="handleTaskImport(event)"><div id="loading-spinner" class="text-center p-10 hidden"></div><div id="main-content" class="mb-8"><div class="task-management-area input-card enterprise-table p-4 rounded-lg"><h2 class="text-lg font-semibold mb-3 text-primary-dark flex items-center mt-4"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                    Task Management
                </h2><div class="mb-3 p-4 enterprise-card border rounded-lg bg-gradient-to-r from-blue-50 to-indigo-50"><div class="flex items-center justify-between gap-6"><div class="flex items-center gap-4"><label class="flex items-center cursor-pointer group"><input type="checkbox" id="use-common-start-date" onchange="toggleCommonStartDate()"
                                       class="w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500 transition-all"><span class="ml-2 text-sm font-semibold text-primary-dark group-hover:text-blue-700 transition-colors">📅 Unified Start Date</span></label><input type="date" id="common-start-date" disabled
                                   class="enterprise-input text-sm w-36 transition-all duration-200"
                                   title="Common start date for all tasks"
                                   onchange="updateAllTaskStartDates()"></div><div class="text-right bg-white/70 backdrop-blur-sm rounded-lg p-3 border border-blue-200/50"><div class="flex items-center gap-2 mb-1"><span class="text-xs font-medium text-gray-600">🏁 PROJECT COMPLETION</span></div><div class="flex items-center justify-end gap-2"><div class="text-sm font-bold text-blue-800" id="furthest-completion-date">No tasks</div><div class="text-xs font-medium text-white bg-blue-600 px-2 py-1 rounded-full" id="furthest-completion-week">—</div></div></div></div><div class="text-xs text-gray-600 mt-2 italic">
                        💡 Synchronizes all task start dates for streamlined project planning
                    </div></div><div class="mb-4 p-4 bg-white border rounded-lg shadow-sm"><div class="flex items-center gap-2 mb-3"><h3 class="font-bold text-md text-primary-dark">➕ Add New Task</h3><div class="flex-1 border-t border-gray-200"></div></div><div class="grid grid-cols-1 lg:grid-cols-12 gap-3 items-end"><div class="lg:col-span-4"><label class="block text-xs font-medium text-gray-700 mb-1">Task Description</label><input type="text" id="new-ticket-desc" placeholder="Enter task description..."
                                   class="enterprise-input w-full focus:ring-2 focus:ring-blue-500 transition-all"></div><div class="lg:col-span-2"><label class="block text-xs font-medium text-gray-700 mb-1">Start Date</label><input type="date" id="new-ticket-start-date"
                                   class="enterprise-input w-full focus:ring-2 focus:ring-blue-500 transition-all" title="Start Date"></div><div class="lg:col-span-2 grid grid-cols-2 gap-2"><div><label class="block text-xs font-medium text-gray-700 mb-1">Size</label><select id="new-ticket-size" class="enterprise-input w-full focus:ring-2 focus:ring-blue-500 transition-all"></select></div><div><label class="block text-xs font-medium text-gray-700 mb-1">Priority</label><select id="new-ticket-priority" class="enterprise-input w-full focus:ring-2 focus:ring-blue-500 transition-all" title="Priority"><option value="P3">P3</option><option value="P1">P1</option><option value="P2">P2</option><option value="P4">P4</option><option value="P5">P5</option></select></div></div><div class="lg:col-span-1 flex items-end pb-1 gap-2"><label class="flex items-center gap-1 text-xs font-medium text-gray-700 cursor-pointer" title="Check to make task duration split among assignees. Unchecked (default) keeps fixed duration regardless of assignees."><input type="checkbox" id="new-ticket-flexible" class="w-4 h-4 text-blue-600 focus:ring-2 focus:ring-blue-500 rounded"><span>Flexible</span></label><button type="button" id="new-ticket-details-icon" onclick="openNewTicketDetailsModal()" class="text-gray-400 hover:text-blue-600 transition-colors" title="Add task details (description, positives, negatives)"><span style="font-size: 1.2em;">📝</span></button></div><div class="lg:col-span-1"><label class="block text-xs font-medium text-gray-700 mb-1">Stakeholder*</label><select id="new-ticket-stakeholder" class="enterprise-input w-full focus:ring-2 focus:ring-blue-500 transition-all" required></select></div><div class="lg:col-span-1"><label class="block text-xs font-medium text-gray-700 mb-1">Initiative*</label><select id="new-ticket-initiative" class="enterprise-input w-full focus:ring-2 focus:ring-blue-500 transition-all" required></select></div><div class="lg:col-span-2"><label class="block text-xs font-medium text-gray-700 mb-1">Assign to:</label><div id="new-ticket-assigned" class="flex flex-wrap gap-1 p-2 border border-gray-300 rounded-md bg-gray-50 min-h-[36px] items-center transition-all hover:bg-white focus-within:bg-white focus-within:border-blue-500"></div></div><div class="lg:col-span-1"><button onclick="addTicket()" class="btn-enterprise w-full h-[36px] font-semibold shadow-md hover:shadow-lg transition-all duration-200 transform hover:scale-105">
                                Add Task
                            </button></div></div><div class="text-xs text-gray-500 mt-2 bg-gray-50 rounded p-2">
                        💡 <span id="start-date-help">Individual start dates enabled. Team availability calculated from earliest task.</span></div></div><div class="space-y-3"><div class="flex items-center gap-2"><h3 class="text-lg font-bold text-primary-dark">📋 Task Schedule</h3><div class="flex-1 border-t border-gray-300"></div><button onclick="exportFilteredTasksToCSV()" class="btn-enterprise flex items-center text-sm px-3 py-1.5"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" /></svg>
                            Export to CSV
                        </button></div><div id="task-filter-section" class="p-3 bg-gradient-to-r from-blue-50 to-blue-100 border border-blue-200 rounded-lg"><div class="flex items-center gap-3"><span class="text-sm font-semibold text-gray-700 whitespace-nowrap">🔍 Filter by person:</span><div id="person-filter-buttons" class="flex flex-wrap gap-2 flex-1"></div><button id="clear-filter-btn" onclick="clearPersonFilter()"
                                    class="px-2 py-1 bg-red-500 text-white rounded text-xs hover:bg-red-600 transition-colors flex-shrink-0"
                                    style="display: none;">
                                Clear
                            </button></div><div class="flex items-center gap-3 mt-2"><span class="text-sm font-semibold text-gray-700 whitespace-nowrap">📊 Filter by status:</span><div id="status-filter-buttons" class="flex flex-wrap gap-2 flex-1"></div><button id="clear-status-filter-btn" onclick="clearStatusFilter()"
                                    class="px-2 py-1 bg-red-500 text-white rounded text-xs hover:bg-red-600 transition-colors flex-shrink-0"
                                    style="display: none;">
                                Clear
                            </button></div><div class="flex items-center gap-3 mt-2"><span class="text-sm font-semibold text-gray-700 whitespace-nowrap">📅 Filter by date:</span><div id="date-filter-buttons" class="flex flex-wrap gap-2 flex-1"></div><button id="clear-date-filter-btn" onclick="clearDateFilter()"
                                    class="px-2 py-1 bg-red-500 text-white rounded text-xs hover:bg-red-600 transition-colors flex-shrink-0"
                                    style="display: none;">
                                Clear
                            </button></div><div class="flex items-center gap-3 mt-2"><span class="text-sm font-semibold text-gray-700 whitespace-nowrap">👥 Filter by stakeholder:</span><select id="stakeholder-filter-dropdown" onchange="filterByStakeholder(this.value)"
                                    class="flex-1 px-3 py-1.5 bg-white border border-gray-300 rounded text-sm focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-teal-500"><option value="">All Stakeholders</option></select></div><div class="flex items-center gap-3 mt-2"><span class="text-sm font-semibold text-gray-700 whitespace-nowrap">📊 Filter by initiative:</span><select id="initiative-filter-dropdown" onchange="filterByInitiative(this.value)"
                                    class="flex-1 px-3 py-1.5 bg-white border border-gray-300 rounded text-sm focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-orange-500"><option value="">All Initiatives</option></select></div><div id="filter-status" class="text-xs text-gray-600 mt-2" style="display: none;"></div></div><div class="overflow-x-auto rounded-lg border"><table class="enterprise-table min-w-full divide-y"><thead><tr><th class="px-3 py-2 text-left w-16">ID</th><th class="px-3 py-2 text-left min-w-0 flex-1">Description</th><th class="px-3 py-2 text-left w-32"><span id="start-date-column-header">Start Date</span></th><th class="px-3 py-2 text-left" style="min-width: 120px;">Size</th><th class="px-3 py-2 text-left w-24 tooltip-container">Task Type
                                        <div class="tooltip-text">
                                            🔒 Fixed-Length: Duration constant regardless of assignees<br>
                                            ⚡ Flexible: Duration splits among assignees
                                        </div></th><th class="px-3 py-2 text-left w-20">Priority</th><th class="px-3 py-2 text-left w-24">Status</th><th class="px-3 py-2 text-left w-28">Stakeholder</th><th class="px-3 py-2 text-left w-28">Initiative</th><th class="px-3 py-2 text-left w-48">Assigned</th><th class="px-3 py-2 text-left w-32 tooltip-container">End Date
                                        <div class="tooltip-text">
                                            Calculated from start date, team availability, and effort hours.
                                        </div></th><th class="px-3 py-2 text-left w-24">Actions</th></tr></thead><tbody id="ticket-table-body" class="divide-y"></tbody></table></div><p id="no-tickets" class="text-center py-3 text-gray-500 hidden">No tasks defined. Add a task to begin!</p></div></div></div></div><div class="w-full p-4 bg-gradient-to-r from-teal-50 via-cyan-50 to-blue-50 border-t-2 border-teal-400 mt-6"><h2 class="text-lg font-bold mb-3 text-center text-teal-800 flex items-center justify-center"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1.5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /></svg>
                ⚙️ Configuration Management
            </h2><div class="grid grid-cols-1 lg:grid-cols-2 gap-4 max-w-7xl mx-auto"><div class="bg-white rounded-lg p-3 shadow-sm border-l-4 border-teal-500"><h3 class="text-base font-bold mb-2 text-teal-700 flex items-center"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1.5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" /></svg>
                        👥 Stakeholders
                    </h3><div id="stakeholders-list" class="flex flex-wrap gap-1.5 mb-3 min-h-[40px] p-2 bg-gray-50 rounded border border-gray-200"></div><div class="flex gap-2"><input type="text" id="new-stakeholder-input" placeholder="Enter stakeholder name..." 
                               class="enterprise-input flex-1 text-sm"
                               onkeypress="if(event.key==='Enter') addStakeholder()"><button onclick="addStakeholder()" class="btn-enterprise px-4 py-1.5 text-sm font-semibold">
                            ➕ Add
                        </button></div><div class="text-xs text-teal-600 mt-2 italic">
                        💡 "General" is the default and cannot be removed.
                    </div></div><div class="bg-white rounded-lg p-3 shadow-sm border-l-4 border-orange-500"><h3 class="text-base font-bold mb-2 text-orange-700 flex items-center"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1.5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" /></svg>
                        📊 Initiatives
                    </h3><div id="initiatives-list" class="flex flex-wrap gap-1.5 mb-3 min-h-[40px] p-2 bg-gray-50 rounded border border-gray-200"></div><div class="flex gap-2"><input type="text" id="new-initiative-input" placeholder="Enter initiative name..." 
                               class="enterprise-input flex-1 text-sm"
                               onkeypress="if(event.key==='Enter') addInitiative()"><button onclick="addInitiative()" class="btn-enterprise px-4 py-1.5 text-sm font-semibold">
                            ➕ Add
                        </button></div><div class="text-xs text-orange-600 mt-2 italic">
                        💡 "General" is the default and cannot be removed.
                    </div></div></div></div></div><div id="calculation-modal" class="modal-overlay"><div class="modal-content"><div class="modal-header"><h3 class="modal-title" id="modal-title">Calculation Details</h3><button class="modal-close" onclick="closeCalculationModal()">&times;</button></div><div class="calculation-details" id="calculation-content"></div></div></div><div id="overdue-tasks-modal" class="modal-overlay"><div class="modal-content" style="max-width: 700px;"><div class="modal-header"><h3 class="modal-title">⚠️ Overdue Tasks Found</h3><button class="modal-close" onclick="closeOverdueTasksModal()">&times;</button></div><div style="margin-bottom: 20px;"><p style="margin-bottom: 8px; color: var(--text-color);">The following "To Do" tasks have start dates in the past:</p><p style="margin-bottom: 12px; color: var(--text-secondary); font-size: 13px; font-style: italic;">
                    💡 Tip: Use the buttons on each task for individual actions, or use the buttons below to apply to all remaining tasks.
                </p><div id="overdue-tasks-list" style="background: var(--background-color); border-radius: 6px; padding: 12px; max-height: 350px; overflow-y: auto; margin-bottom: 16px;"></div><p style="margin-bottom: 12px; color: var(--text-color); font-size: 14px; font-weight: 600; border-top: 1px solid var(--border-color); padding-top: 12px;">
                    Bulk Actions (apply to all remaining tasks):
                </p><div style="display: flex; gap: 10px; flex-wrap: wrap;"><button onclick="handleOverdueTasksAction('move')" class="btn-enterprise" style="flex: 1; min-width: 180px;">
                        📅 Move All to Today
                    </button><button onclick="handleOverdueTasksAction('progress')" class="btn-enterprise" style="flex: 1; min-width: 180px;">
                        ▶️ Change All to In Progress
                    </button><button onclick="handleOverdueTasksAction('skip')" class="btn-enterprise" style="flex: 1; min-width: 180px;">
                        ⏭️ Skip / Dismiss
                    </button></div></div></div></div><div id="task-details-modal" class="modal-overlay"><div class="modal-content" style="max-width: 60vw; width: 60vw;"><div class="modal-header"><h3 class="modal-title">📝 Task Details</h3><button class="modal-close" onclick="closeTaskDetailsModal()">&times;</button></div><div style="padding: 20px;"><input type="hidden" id="details-modal-task-id"><div class="space-y-4"><div><label class="block text-sm font-medium text-gray-700 mb-2">📄 Description</label><textarea id="details-modal-description"
                                  rows="6"
                                  placeholder="Enter task description..."
                                  class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm"></textarea></div><div><label class="block text-sm font-medium text-green-700 mb-2">✅ Positives</label><textarea id="details-modal-positives"
                                  rows="6"
                                  placeholder="Benefits, positive outcomes, advantages..."
                                  class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 text-sm"></textarea></div><div><label class="block text-sm font-medium text-red-700 mb-2">⚠️ Negatives</label><textarea id="details-modal-negatives"
                                  rows="6"
                                  placeholder="Risks, challenges, concerns..."
                                  class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500 text-sm"></textarea></div></div><div class="flex gap-3 mt-6 justify-end"><button onclick="closeTaskDetailsModal()" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors">
                        Cancel
                    </button><button onclick="saveTaskDetails()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                        💾 Save Details
                    </button></div></div></div></div><div id="new-ticket-details-modal" class="modal-overlay"><div class="modal-content" style="max-width: 60vw; width: 60vw;"><div class="modal-header"><h3 class="modal-title">📝 Add Task Details (Optional)</h3><button class="modal-close" onclick="closeNewTicketDetailsModal()">&times;</button></div><div style="padding: 20px;"><div class="space-y-4"><div><label class="block text-sm font-medium text-gray-700 mb-2">📄 Description</label><textarea id="new-ticket-details-description"
                                  rows="6"
                                  placeholder="Enter task description..."
                                  class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm"></textarea></div><div><label class="block text-sm font-medium text-green-700 mb-2">✅ Positives</label><textarea id="new-ticket-details-positives"
                                  rows="6"
                                  placeholder="Benefits, positive outcomes, advantages..."
                                  class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 text-sm"></textarea></div><div><label class="block text-sm font-medium text-red-700 mb-2">⚠️ Negatives</label><textarea id="new-ticket-details-negatives"
                                  rows="6"
                                  placeholder="Risks, challenges, concerns..."
                                  class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500 text-sm"></textarea></div></div><div class="flex gap-3 mt-6 justify-end"><button onclick="closeNewTicketDetailsModal()" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors">
                        Cancel
                    </button><button onclick="saveNewTicketDetails()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                        💾 Save Details
                    </button></div></div></div></div><div class="container mx-auto px-4 py-6"><div class="card"><div class="card-header"><div class="flex justify-between items-center"><div><h2 class="card-title">📊 Team Workload Heat Map (Next 8 Weeks)</h2><p class="text-sm text-gray-600 mt-1">Visual overview of team capacity utilization based on individual availability</p><div class="mt-2"><label class="flex items-center gap-2 text-sm cursor-pointer"><input type="checkbox" 
                                       id="show-p1-percentage" 
                                       checked
                                       onchange="toggleP1Display(this.checked)"
                                       class="w-4 h-4 text-red-600 border-gray-300 rounded"><span class="text-gray-700">Show P1 Priority Percentages</span></label></div></div><div class="flex gap-2"><button onclick="openBulkTaskResolution()" class="btn-enterprise flex items-center gap-2"><span>✅</span>
                            Resolve Completed
                        </button><button onclick="generateDelayAnalysis()" class="btn-enterprise flex items-center gap-2"><span>📅</span>
                            Analyze Start Date Delays
                        </button><button onclick="generateEndDateDelayAnalysis()" class="btn-enterprise flex items-center gap-2"><span>⏰</span>
                            Analyze End Date Delays
                        </button><button onclick="generateComprehensiveDelayAnalysis()" class="btn-enterprise flex items-center gap-2"><span>🔍</span>
                            Analyze All Delays
                        </button><button onclick="generateCompletionGraph()" class="btn-enterprise flex items-center gap-2"><span>📈</span>
                            Generate Completion Graph
                        </button><button onclick="exportTaskMapCSV()" class="btn-enterprise flex items-center gap-2"><span>📊</span>
                            Export Task Map CSV
                        </button></div></div></div><div class="card-content"><div id="workload-heatmap" class="overflow-x-auto"></div><div class="mt-4 flex flex-wrap gap-4 text-sm"><div class="flex items-center gap-2"><div class="w-4 h-4 bg-green-100 border border-green-300 rounded"></div><span>0-60% Capacity (Available)</span></div><div class="flex items-center gap-2"><div class="w-4 h-4 bg-yellow-100 border border-yellow-300 rounded"></div><span>61-90% Capacity (Busy)</span></div><div class="flex items-center gap-2"><div class="w-4 h-4 bg-red-100 border border-red-300 rounded"></div><span>91%+ Capacity (Overloaded)</span></div></div></div></div></div><div id="completionGraphModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden"><div class="bg-white rounded-lg shadow-xl max-w-6xl w-full mx-4 max-h-[90vh] overflow-auto"><div class="flex justify-between items-center p-6 border-b"><h2 class="text-2xl font-bold text-gray-800">📈 Task Completion Projection</h2><button onclick="closeCompletionGraph()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button></div><div class="p-6"><div id="completionGraphContent" class="w-full h-96"></div><div class="mt-4 text-sm text-gray-600"><p><strong>📊 Chart Explanation:</strong> This graph shows the projected completion dates for all tasks based on current scheduling and team capacity.</p></div></div></div></div><div id="delayAnalysisModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden"><div class="bg-white rounded-lg shadow-xl max-w-6xl w-full mx-4 max-h-[90vh] overflow-auto"><div class="flex justify-between items-center p-6 border-b"><h2 class="text-2xl font-bold text-gray-800">⏰ Start Date Delay Analysis</h2><button onclick="closeDelayAnalysis()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button></div><div class="p-6"><div id="delayAnalysisContent" class="w-full"></div></div></div></div><div id="bulkTaskResolutionModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden"><div class="bg-white rounded-lg shadow-xl max-w-5xl w-full mx-4 max-h-[90vh] overflow-auto"><div class="flex justify-between items-center p-6 border-b"><h2 class="text-2xl font-bold text-gray-800">✅ Resolve Completed Tasks</h2><button onclick="closeBulkTaskResolution()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button></div><div class="p-6"><div class="mb-4 p-4 bg-blue-50 border border-blue-200 rounded-lg"><p class="text-sm text-blue-800"><strong>📋 Tasks shown:</strong> "In Progress" tasks with calculated end dates in the past (overdue).
                        Use the actions below to resolve each task or extend deadlines as needed.
                    </p></div><div id="bulkTaskResolutionContent" class="w-full"></div></div></div></div><div class="container mx-auto px-4 py-6"><div class="card"><div class="card-header"><h2 class="card-title">👥 Team Configuration</h2><p id="availability-header" class="text-sm text-gray-600 mt-1">Team Availability (Next 8 Weeks)</p></div><div class="card-content"><div id="people-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 mb-6"></div><div class="border-t pt-4"><h3 class="text-lg font-semibold mb-3">Add New Team Member</h3><div class="flex gap-3 items-center max-w-md"><input type="text" id="new-person-name" placeholder="Enter team member name" class="enterprise-input flex-grow"><button onclick="addPerson()" class="btn-enterprise">Add Member</button></div></div></div></div></div><div class="container mx-auto px-4"><div class="task-config-container input-card enterprise-table p-4 rounded-lg"><div class="task-size-manager"><div class="flex items-center justify-between mb-3"><h2 class="text-base font-bold flex items-center text-primary-dark"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" /></svg>
                        📏 Task Configuration
                    </h2><div class="flex gap-2 flex-wrap text-xs"><button onclick="applyPreset('agile')" class="btn-enterprise">🏃 Agile</button><button onclick="applyPreset('enterprise')" class="btn-enterprise">🏢 Enterprise</button><button onclick="applyPreset('startup')" class="btn-enterprise">🚀 Startup</button><button onclick="applyPreset('conservative')" class="btn-enterprise">🛡️ Conservative</button><button onclick="showCustomSizeForm()" class="btn-enterprise">➕ Custom</button></div></div><div class="compact-spacing"><div class="mb-3 flex items-center gap-6 flex-wrap"><div class="flex items-center gap-2"><label class="text-sm font-semibold text-white">Estimation Base (hrs/day):</label><input type="number" id="estimation-base-hours" value="5" min="1" max="12"
                                   onchange="updateEstimationBase(event.target.value)"
                                   class="enterprise-input w-16 text-base font-bold"><span class="text-xs font-medium text-blue-100">ℹ️ Productive hours (after meetings)</span></div><div class="flex items-center gap-2"><label class="text-sm font-semibold text-white">Project Hours/Day:</label><input type="number" id="project-hours-per-day" value="8" min="1" max="24"
                                   onchange="updateProjectHours(event.target.value)"
                                   class="enterprise-input w-16 text-base font-bold"><span class="text-xs font-medium text-blue-100">Task Effort = Days × <span id="estimation-base-display" class="font-bold text-yellow-300">5</span>h</span></div></div><div id="task-size-cards" class="mb-3"></div><div id="custom-size-form" class="custom-size-form hidden"><h4 class="font-semibold mb-2 text-sm">Add Custom Task Size</h4><div class="flex gap-2 items-end flex-wrap"><div><label class="block text-xs mb-1">Key</label><input type="text" id="new-size-key" placeholder="XS" maxlength="4"
                                       class="enterprise-input w-16"></div><div><label class="block text-xs mb-1">Name</label><input type="text" id="new-size-name" placeholder="Extra Small"
                                       class="enterprise-input w-24"></div><div><label class="block text-xs mb-1">Days</label><input type="number" id="new-size-days" placeholder="0.5" min="0.1" max="50" step="0.5"
                                       class="enterprise-input w-16"></div><button onclick="addCustomSize()" class="btn-enterprise">Add</button><button onclick="hideCustomSizeForm()" class="btn-danger">Cancel</button></div></div></div></div></div></div><div class="container mx-auto px-4 py-6"><div class="card"><div class="card-header"><h2 class="card-title">🧮 Calculation Formulas</h2><p class="text-sm text-gray-600 mt-1">Click below to understand how end dates and capacity utilization are calculated</p></div><div class="card-content"><div class="grid grid-cols-1 md:grid-cols-3 gap-3"><button onclick="showEndDateFormula()"
                            class="p-4 bg-gradient-to-br from-blue-600 to-blue-700 border border-blue-800 rounded-lg hover:from-blue-700 hover:to-blue-800 transition-all duration-200 flex flex-col items-center gap-2 group shadow-md"><div class="flex items-center gap-2"><span class="text-2xl">📅</span><span class="text-base font-semibold text-white">End Date Calculation</span></div><p class="text-xs text-blue-100 text-center">
                            How task end dates are calculated
                        </p><span class="text-xs text-blue-200 group-hover:text-white font-medium">Click to view formula →</span></button><button onclick="showHeatMapFormula()"
                            class="p-4 bg-gradient-to-br from-blue-600 to-blue-700 border border-blue-800 rounded-lg hover:from-blue-700 hover:to-blue-800 transition-all duration-200 flex flex-col items-center gap-2 group shadow-md"><div class="flex items-center gap-2"><span class="text-2xl">📊</span><span class="text-base font-semibold text-white">Heat Map Calculation</span></div><p class="text-xs text-blue-100 text-center">
                            Team capacity utilization per week
                        </p><span class="text-xs text-blue-200 group-hover:text-white font-medium">Click to view formula →</span></button></div></div></div></div><div id="formula-modal" class="modal-overlay"><div class="modal-content" style="max-width: 800px;"><div class="modal-header"><h3 class="modal-title" id="formula-modal-title">Calculation Formula</h3><button class="modal-close" onclick="closeFormulaModal()">&times;</button></div><div style="padding: 20px;"><div id="formula-modal-content" style="white-space: pre-wrap; font-family: 'Segoe UI', sans-serif; line-height: 1.8;"></div><div class="flex gap-3 mt-6 justify-end"><button onclick="closeFormulaModal()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                        Close
                    </button></div></div></div></div><div id="week-task-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center"><div class="bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4 max-h-[80vh] overflow-hidden"><div class="bg-blue-600 text-white px-6 py-4 flex justify-between items-center"><h3 id="modal-title" class="text-xl font-semibold">Week Task Details</h3><button onclick="closeWeekTaskModal()" class="text-white hover:text-gray-200 text-2xl">&times;</button></div><div class="p-6 overflow-y-auto max-h-[60vh]"><div id="modal-content"></div></div></div></div><script>const IS_TEST_MODE=window.self!==window.top,originalAlert=window.alert,originalConfirm=window.confirm;if(IS_TEST_MODE){console.log("🧪 Test mode detected (running in iframe) - suppressing alerts and clearing localStorage..."),window.alert=function(e){console.log("🔕 [Alert suppressed in test mode]:",e)},window.confirm=function(e){return console.log("🔕 [Confirm auto-accepted in test mode]:",e),!0};const e=[];for(let t=0;t<localStorage.length;t++){const n=localStorage.key(t);n&&(n.startsWith("taskScheduler_")||n.startsWith("projectScheduler"))&&e.push(n)}e.forEach(e=>localStorage.removeItem(e)),console.log(`✅ Cleared ${e.length} localStorage keys for testing`)}const STORAGE_KEY="projectSchedulerDataV10",APP_VERSION="10.0.0";let people=[],tickets=[],stakeholders=["General"],initiatives=[{name:"General",creationDate:getLocalDateString(new Date),startDate:null}],estimationBaseHours=5,projectHoursPerDay=8,ticketDays={S:1,M:2,L:5,XL:10,XXL:15},closedItemsExported=!1;function generateUUID(){return"undefined"!=typeof crypto&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}function getNextDisplayId(){if(0===tickets.length)return 1;return Math.max(...tickets.map(e=>e.id||0))+1}function normalizeTitle(e){return e.toLowerCase().replace(/\s+/g,"")}function findSimilarTasks(e){const t=normalizeTitle(e),n=[];for(const e of tickets){const a=normalizeTitle(e.description);if(a===t){n.push({ticket:e,matchType:"exact",confidence:100});continue}if(a.includes(t)||t.includes(a)){const s=Math.round(Math.min(t.length,a.length)/Math.max(t.length,a.length)*100);n.push({ticket:e,matchType:"contains",confidence:s});continue}const s=100*(1-levenshteinDistance(t,a)/Math.max(t.length,a.length));s>=70&&n.push({ticket:e,matchType:"fuzzy",confidence:Math.round(s)})}return n.sort((e,t)=>t.confidence-e.confidence),n}function levenshteinDistance(e,t){const n=[];for(let e=0;e<=t.length;e++)n[e]=[e];for(let t=0;t<=e.length;t++)n[0][t]=t;for(let a=1;a<=t.length;a++)for(let s=1;s<=e.length;s++)t.charAt(a-1)===e.charAt(s-1)?n[a][s]=n[a-1][s-1]:n[a][s]=Math.min(n[a-1][s-1]+1,n[a][s-1]+1,n[a-1][s]+1);return n[t.length][e.length]}let renderDebounceTimer=null,renderPending=!1;function scheduleRender(){renderPending||(renderPending=!0,requestAnimationFrame(()=>{clearTimeout(renderDebounceTimer),renderDebounceTimer=setTimeout(()=>{renderPending=!1,calculateProjection()},50)}))}function immediateRender(){clearTimeout(renderDebounceTimer),renderPending=!1,calculateProjection()}let taskSizeDefinitions={S:{name:"Small",days:1,removable:!1},M:{name:"Medium",days:2,removable:!1},L:{name:"Large",days:5,removable:!1},XL:{name:"X-Large",days:10,removable:!1},XXL:{name:"XX-Large",days:15,removable:!1}};function getLocalDateString(e){return e.getFullYear()+"-"+String(e.getMonth()+1).padStart(2,"0")+"-"+String(e.getDate()).padStart(2,"0")}function initializeStartDateHistory(e){return e.startDateHistory||(e.startDateHistory=[],e.startDate&&e.startDateHistory.push({date:e.startDate,timestamp:(new Date).toISOString(),reason:"Initial planning"})),e}function trackStartDateChange(e,t,n,a="Manual update"){initializeStartDateHistory(e),t!==n&&(e.startDateHistory.push({date:n,timestamp:(new Date).toISOString(),reason:a,previousDate:t}),console.log(`📅 Start date changed for "${e.description}": ${t} → ${n} (${a})`))}function initializeEndDateHistory(e){return e.endDateHistory||(e.endDateHistory=[]),e}function trackEndDateChange(e,t,n,a="Date extension"){initializeEndDateHistory(e),t!==n&&(e.endDateHistory.push({date:n,timestamp:(new Date).toISOString(),reason:a,previousDate:t}),console.log(`📅 End date changed for "${e.description}": ${t} → ${n} (${a})`))}function initializeSizeHistory(e){return e.sizeHistory||(e.sizeHistory=[],e.size&&e.sizeHistory.push({size:e.size,days:taskSizeDefinitions[e.size]?.days||0,timestamp:(new Date).toISOString(),reason:"Initial sizing"})),e}function trackSizeChange(e,t,n,a="Manual update"){initializeSizeHistory(e),t!==n&&(e.sizeHistory.push({size:n,days:taskSizeDefinitions[n]?.days||0,timestamp:(new Date).toISOString(),reason:a,previousSize:t,previousDays:taskSizeDefinitions[t]?.days||0}),console.log(`📊 Size changed for "${e.description}": ${t} → ${n} (${a})`))}let effortMap={},currentTicketId=1,useCommonStartDate=!1,selectedPersonFilters=[],isUnassignedFilterActive=!1,selectedStatusFilters=[],selectedDateFilters=[],selectedStakeholderFilter="",selectedInitiativeFilter="",isDirty=!1;function setDirtyState(e=!0){isDirty=e;const t=document.querySelectorAll(".input-card, .output-card, .card");e?(t.forEach(e=>e.classList.add("dirty")),document.title="💾 Enterprise Project Tracking Console (Unsaved Changes)",console.log("💾 Unsaved changes detected - export configuration to save")):(t.forEach(e=>e.classList.remove("dirty")),document.title="Enterprise Project Tracking Console",console.log("✅ Configuration saved - all changes exported"))}function markDirty(){isDirty||(setDirtyState(!0),closedItemsExported=!1,updateExportButtonsState())}function markClean(){setDirtyState(!1)}const startDate=getNextMonday(new Date);function getEffectiveStartDate(){if(useCommonStartDate){const e=document.getElementById("common-start-date")?.value;if(e){return getMondayOfWeek(new Date(e))}}const e=getEarliestTaskStartDate();return e?getMondayOfWeek(e):startDate}function getMondayOfWeek(e){const t=new Date(e),n=t.getDay(),a=t.getDate()-n+(0===n?-6:1),s=new Date(t.setDate(a));return s.setHours(0,0,0,0),s}function getEarliestTaskStartDate(){if(0===tickets.length)return null;const e=tickets.map(e=>e.startDate?new Date(e.startDate):null).filter(e=>null!==e).sort((e,t)=>e-t);return e.length>0?e[0]:null}function saveToLocalStorage(){console.log("💾 Saving to localStorage..."),console.log("📊 taskSizeDefinitions being saved:",taskSizeDefinitions);const e={people:people,tickets:tickets,stakeholders:stakeholders,initiatives:initiatives,estimationBaseHours:estimationBaseHours,projectHoursPerDay:projectHoursPerDay,ticketDays:ticketDays,taskSizeDefinitions:taskSizeDefinitions,currentTicketId:currentTicketId,useCommonStartDate:useCommonStartDate,version:"10.0.0",lastUpdated:(new Date).toISOString()};try{localStorage.setItem(STORAGE_KEY,JSON.stringify(e)),console.log("✅ Save successful (V10)")}catch(e){console.error("Error saving to local storage:",e)}}function loadFromLocalStorage(){try{console.log("🔧 Loading from localStorage...");const e=localStorage.getItem(STORAGE_KEY);if(e){console.log("📦 Found stored data, parsing...");const t=JSON.parse(e);return people=t.people||[],people.forEach(e=>{void 0===e.isProjectReady&&(e.isProjectReady=!0)}),tickets=t.tickets||[],stakeholders=t.stakeholders||["General"],initiatives=t.initiatives||[{name:"General",creationDate:getLocalDateString(new Date),startDate:null}],tickets=tickets.map(e=>(void 0===(e=initializeSizeHistory(e=initializeEndDateHistory(e=initializeStartDateHistory(e)))).isFixedLength&&(e.isFixedLength=!0),e.uuid||(e.uuid=generateUUID()),e.stakeholder||(e.stakeholder="General"),e.initiative||(e.initiative="General"),e)),recalculateAllInitiativeStartDates(),estimationBaseHours=t.estimationBaseHours||5,projectHoursPerDay=t.projectHoursPerDay||t.hoursPerDay||8,ticketDays=t.ticketDays||{S:1,M:2,L:5,XL:10,XXL:15},console.log("📊 Loaded taskSizeDefinitions from storage:",t.taskSizeDefinitions),taskSizeDefinitions=t.taskSizeDefinitions||{S:{name:"Small",days:1,removable:!1},M:{name:"Medium",days:2,removable:!1},L:{name:"Large",days:5,removable:!1},XL:{name:"X-Large",days:10,removable:!1},XXL:{name:"XX-Large",days:15,removable:!1}},Object.keys(taskSizeDefinitions).forEach(e=>{e&&""!==e.trim()||(console.warn("🧹 Removing invalid task size key:",e),delete taskSizeDefinitions[e])}),console.log("📊 Final taskSizeDefinitions after loading:",taskSizeDefinitions),backupTaskSizeDefinitions(),currentTicketId=t.currentTicketId||(tickets.length>0?Math.max(...tickets.map(e=>e.id))+1:1),useCommonStartDate=t.useCommonStartDate||!1,console.log("🔄 About to sync task sizes..."),syncTaskSizes(),console.log("📊 taskSizeDefinitions after sync:",taskSizeDefinitions),migratePeopleToEightWeeks(),markClean(),!0}}catch(e){console.error("Error loading from local storage:",e)}return!1}function syncTaskSizes(){Object.keys(taskSizeDefinitions).forEach(e=>{taskSizeDefinitions[e]&&"number"==typeof taskSizeDefinitions[e].days?ticketDays[e]=taskSizeDefinitions[e].days:console.warn(`⚠️ syncTaskSizes: Invalid task size for key "${e}":`,taskSizeDefinitions[e])})}function migratePeopleToEightWeeks(){people.forEach(e=>{if(e.availability)if(e.availability.length<8){const t=e.availability[e.availability.length-1]||25;for(;e.availability.length<8;)e.availability.push(t)}else e.availability.length>8&&(e.availability=e.availability.slice(0,8));else e.availability=[25,25,25,25,25,25,25,25]}),saveToLocalStorage()}function getNextMonday(e){const t=new Date(e),n=t.getDay();let a;a=0===n?1:1===n?t.getHours()<9?0:7:8-n;const s=new Date(t);return s.setDate(t.getDate()+a),s.setHours(0,0,0,0),s}function generatePersonFilterButtons(){const e=document.getElementById("person-filter-buttons");if(!e)return;e.innerHTML="",people.forEach(t=>{const n=document.createElement("button");n.className="person-filter-btn px-3 py-1 rounded-md text-xs transition-all duration-200 border",n.textContent=t.name,n.onclick=()=>togglePersonFilter(t.name),n.setAttribute("data-person",t.name),updatePersonFilterButtonState(n,t.name),e.appendChild(n)});const t=document.createElement("button");t.className="person-filter-btn px-3 py-1 rounded-md text-xs transition-all duration-200 border",t.textContent="🚫 Unassigned",t.onclick=()=>toggleUnassignedFilter(),t.setAttribute("data-person","__unassigned__"),updateUnassignedFilterButtonState(t),e.appendChild(t)}function updatePersonFilterButtonState(e,t){selectedPersonFilters.includes(t)?(e.className="person-filter-btn px-3 py-1 rounded-md text-xs transition-all duration-200 border bg-blue-600 text-white border-blue-600 font-medium",e.title=`✓ Showing ${t}'s tasks (click to remove filter)`):selectedPersonFilters.length>0?(e.className="person-filter-btn px-3 py-1 rounded-md text-xs transition-all duration-200 border bg-gray-100 text-gray-500 border-gray-300",e.title=`Click to show ${t}'s tasks`):(e.className="person-filter-btn px-3 py-1 rounded-md text-xs transition-all duration-200 border bg-white text-gray-700 border-gray-300 hover:bg-gray-50",e.title=`Click to filter ${t}'s tasks`)}function togglePersonFilter(e){selectedPersonFilters.includes(e)?selectedPersonFilters=selectedPersonFilters.filter(t=>t!==e):(selectedPersonFilters.push(e),isUnassignedFilterActive=!1),updateFilterUI(),updateTable()}function toggleUnassignedFilter(){isUnassignedFilterActive=!isUnassignedFilterActive,isUnassignedFilterActive&&(selectedPersonFilters=[]),updateFilterUI(),updateTable()}function updateUnassignedFilterButtonState(e){isUnassignedFilterActive?(e.className="person-filter-btn px-3 py-1 rounded-md text-xs transition-all duration-200 border bg-blue-600 text-white border-blue-600 font-medium",e.title="✓ Showing unassigned tasks (click to remove filter)"):selectedPersonFilters.length>0?(e.className="person-filter-btn px-3 py-1 rounded-md text-xs transition-all duration-200 border bg-gray-100 text-gray-500 border-gray-300",e.title="Click to show unassigned tasks"):(e.className="person-filter-btn px-3 py-1 rounded-md text-xs transition-all duration-200 border bg-white text-gray-700 border-gray-300 hover:bg-gray-50",e.title="Click to filter unassigned tasks")}function clearPersonFilter(){selectedPersonFilters=[],isUnassignedFilterActive=!1,updateFilterUI(),updateTable()}function updateFilterUI(){try{document.querySelectorAll(".person-filter-btn").forEach(e=>{const t=e.getAttribute("data-person");"__unassigned__"===t?updateUnassignedFilterButtonState(e):updatePersonFilterButtonState(e,t)}),document.querySelectorAll(".status-filter-btn").forEach(e=>{const t=e.getAttribute("data-status");updateStatusFilterButtonState(e,t)}),document.querySelectorAll(".date-filter-btn").forEach(e=>{const t=e.getAttribute("data-date");updateDateFilterButtonState(e,t)});const e=document.getElementById("filter-status"),t=document.getElementById("clear-filter-btn"),n=document.getElementById("clear-status-filter-btn"),a=document.getElementById("clear-date-filter-btn");if(!e)return void console.warn("Filter status element not found");t&&(t.style.display=selectedPersonFilters.length>0||isUnassignedFilterActive?"inline-block":"none"),n&&(n.style.display=selectedStatusFilters.length>0?"inline-block":"none"),a&&(a.style.display=selectedDateFilters.length>0?"inline-block":"none");if(selectedPersonFilters.length>0||isUnassignedFilterActive||selectedStatusFilters.length>0||selectedDateFilters.length>0||selectedStakeholderFilter||selectedInitiativeFilter){e.style.display="block";const t=getFilteredTickets().length;let n="Showing tasks",a=!1;isUnassignedFilterActive?(n+=" that are <strong>Unassigned</strong>",a=!0):selectedPersonFilters.length>0&&(n+=` assigned to: <strong>${selectedPersonFilters.join(", ")}</strong>`,a=!0),selectedStatusFilters.length>0&&(a&&(n+=" and"),n+=` with status: <strong>${selectedStatusFilters.join(", ")}</strong>`,a=!0),selectedDateFilters.length>0&&(a&&(n+=" and"),n+=` active in: <strong>${selectedDateFilters.join(", ")}</strong>`,a=!0),selectedStakeholderFilter&&(a&&(n+=" and"),n+=` for stakeholder: <strong>${selectedStakeholderFilter}</strong>`,a=!0),selectedInitiativeFilter&&(a&&(n+=" and"),n+=` in initiative: <strong>${selectedInitiativeFilter}</strong>`,a=!0),n+=` (${t} task${1!==t?"s":""} visible)`,e.innerHTML=n}else e.style.display="none"}catch(e){console.error("Error updating filter UI:",e)}}function generateStatusFilterButtons(){const e=document.getElementById("status-filter-buttons");if(!e)return;e.innerHTML="";const t={"To Do":"📋","In Progress":"🚀",Paused:"⏸️",Done:"✅",Closed:"🗃️"};["To Do","In Progress","Paused","Done","Closed"].forEach(n=>{const a=document.createElement("button");a.className="status-filter-btn px-3 py-1 rounded-md text-xs transition-all duration-200 border",a.innerHTML=`${t[n]} ${n}`,a.onclick=()=>toggleStatusFilter(n),a.setAttribute("data-status",n),updateStatusFilterButtonState(a,n),e.appendChild(a)})}function updateStatusFilterButtonState(e,t){selectedStatusFilters.includes(t)?(e.className="status-filter-btn px-3 py-1 rounded-md text-xs transition-all duration-200 border bg-green-600 text-white border-green-600 font-medium",e.title=`✓ Showing "${t}" tasks (click to remove filter)`):selectedStatusFilters.length>0?(e.className="status-filter-btn px-3 py-1 rounded-md text-xs transition-all duration-200 border bg-gray-100 text-gray-500 border-gray-300",e.title=`Click to show "${t}" tasks`):(e.className="status-filter-btn px-3 py-1 rounded-md text-xs transition-all duration-200 border bg-white text-gray-700 border-gray-300 hover:border-green-400",e.title=`Click to filter by "${t}" tasks`)}function toggleStatusFilter(e){selectedStatusFilters.includes(e)?selectedStatusFilters=selectedStatusFilters.filter(t=>t!==e):selectedStatusFilters.push(e),updateFilterUI(),updateTable()}function clearStatusFilter(){selectedStatusFilters=[],updateFilterUI(),updateTable()}function generateDateFilterButtons(){const e=document.getElementById("date-filter-buttons");if(!e)return;e.innerHTML="";const t={Today:"📅","This Week":"📆","Next Week":"🗓️"};["Today","This Week","Next Week"].forEach(n=>{const a=document.createElement("button");a.className="date-filter-btn px-3 py-1 rounded-md text-xs transition-all duration-200 border",a.innerHTML=`${t[n]} ${n}`,a.onclick=()=>toggleDateFilter(n),a.setAttribute("data-date",n),updateDateFilterButtonState(a,n),e.appendChild(a)})}function updateDateFilterButtonState(e,t){selectedDateFilters.includes(t)?(e.className="date-filter-btn px-3 py-1 rounded-md text-xs transition-all duration-200 border bg-blue-600 text-white border-blue-600 font-medium",e.title=`✓ Showing tasks active "${t}" (click to remove filter)`):selectedDateFilters.length>0?(e.className="date-filter-btn px-3 py-1 rounded-md text-xs transition-all duration-200 border bg-gray-100 text-gray-500 border-gray-300",e.title=`Click to show tasks active "${t}"`):(e.className="date-filter-btn px-3 py-1 rounded-md text-xs transition-all duration-200 border bg-white text-gray-700 border-gray-300 hover:border-blue-400",e.title=`Click to filter by tasks active "${t}"`)}function toggleDateFilter(e){selectedDateFilters.includes(e)?selectedDateFilters=selectedDateFilters.filter(t=>t!==e):selectedDateFilters.push(e),updateFilterUI(),updateTable()}function clearDateFilter(){selectedDateFilters=[],updateFilterUI(),updateTable()}function filterByStakeholder(e){selectedStakeholderFilter=e,updateFilterUI(),updateTable()}function populateStakeholderFilterDropdown(){const e=document.getElementById("stakeholder-filter-dropdown");e&&(e.innerHTML='<option value="">All Stakeholders</option>',stakeholders.forEach(t=>{const n=document.createElement("option");n.value=t,n.textContent=t,t===selectedStakeholderFilter&&(n.selected=!0),e.appendChild(n)}))}function filterByInitiative(e){selectedInitiativeFilter=e,updateFilterUI(),updateTable()}function populateInitiativeFilterDropdown(){const e=document.getElementById("initiative-filter-dropdown");e&&(e.innerHTML='<option value="">All Initiatives</option>',initiatives.forEach(t=>{const n=document.createElement("option");n.value=t.name,n.textContent=t.name,t.name===selectedInitiativeFilter&&(n.selected=!0),e.appendChild(n)}))}function isTaskActiveInDateRange(e,t){const n=new Date;let a,s;if(n.setHours(0,0,0,0),"Today"===t)a=new Date(n),s=new Date(n);else if("This Week"===t){a=new Date(n);const e=a.getDay(),t=0===e?-6:1-e;a.setDate(a.getDate()+t),s=new Date(a),s.setDate(a.getDate()+4)}else if("Next Week"===t){a=new Date(n);const e=a.getDay(),t=0===e?1:8-e;a.setDate(a.getDate()+t),s=new Date(a),s.setDate(a.getDate()+4)}const i=new Date(e.startDate);i.setHours(0,0,0,0);const o=getProjectedTickets().find(t=>t.id===e.id);let r=i;return o&&o.rawEndDate&&(r=new Date(o.rawEndDate),r.setHours(0,0,0,0)),i<=s&&r>=a}function shouldShowTicket(e){let t=!1;t=isUnassignedFilterActive?!e.assigned||0===e.assigned.length:0===selectedPersonFilters.length||selectedPersonFilters.some(t=>e.assigned.some(e=>e.toLowerCase()===t.toLowerCase()));const n=0===selectedStatusFilters.length||selectedStatusFilters.includes(e.status||"To Do"),a=0===selectedDateFilters.length||selectedDateFilters.some(t=>isTaskActiveInDateRange(e,t)),s=!selectedStakeholderFilter||e.stakeholder===selectedStakeholderFilter,i=!selectedInitiativeFilter||e.initiative===selectedInitiativeFilter;return t&&n&&a&&s&&i}function getFilteredTickets(){return tickets.filter(e=>shouldShowTicket(e))}function updateTable(){scheduleRender()}function getDefaultTaskStartDate(){const e=new Date,t=e.getDay(),n=e.getHours();if(t>=1&&t<=4&&n<17)return e;if(5===t&&n<12)return e;if(t>=1&&t<=4){const t=new Date(e);return t.setDate(e.getDate()+1),t}return getNextMonday(e)}function formatDate(e){if(!e)return"Not set";return new Date(e).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}function formatWeekEndDate(e){const t=getEffectiveStartDate(),n=new Date(t);return n.setDate(n.getDate()+7*e+4),n.toLocaleDateString("en-US",{month:"short",day:"numeric"})}function getWeekDateRange(e){let t;t=heatMapStartDate?new Date(heatMapStartDate):getPreviousMonday(new Date);const{weekStart:n,weekEnd:a}=calculateWeekDateRange(t,e,!1);return`${n.toLocaleDateString("en-US",{month:"short",day:"numeric"})} - ${a.toLocaleDateString("en-US",{month:"short",day:"numeric"})}`}function formatCompletionDate(e,t,n){const a=getEffectiveStartDate(),s=new Date(a);let i=0;if(n>0){const e=t/projectHoursPerDay;i=Math.ceil(e),i=Math.min(i,5)}s.setDate(s.getDate()+7*e+i);let o=s.getDay();return 6===o?s.setDate(s.getDate()+2):0===o&&s.setDate(s.getDate()+1),s.toLocaleDateString("en-US",{month:"short",day:"numeric"})}function getCompletionDateDetails(e,t,n){const a=getEffectiveStartDate(),s=new Date(a);s.setDate(s.getDate()+7*e);const i=getNextBusinessDay(s);if(n>0){const e=Math.ceil(t/projectHoursPerDay),n=addBusinessDays(i,Math.max(1,e-1));return{formatted:n.toLocaleDateString("en-US",{month:"short",day:"numeric"}),rawDate:new Date(n)}}return{formatted:i.toLocaleDateString("en-US",{month:"short",day:"numeric"}),rawDate:new Date(i)}}function getDefaultTaskSizeDefinitions(){return{S:{name:"Small",days:1,removable:!1},M:{name:"Medium",days:2,removable:!1},L:{name:"Large",days:5,removable:!1},XL:{name:"X-Large",days:10,removable:!1},XXL:{name:"XX-Large",days:15,removable:!1}}}function backupTaskSizeDefinitions(){if(taskSizeDefinitions&&0!==Object.keys(taskSizeDefinitions).length)try{const e=localStorage.getItem("taskSizeDefinitions_backup"),t=JSON.stringify(taskSizeDefinitions);if(e===t)return;localStorage.setItem("taskSizeDefinitions_backup",t);const n=(new Date).toISOString();localStorage.setItem("taskSizeDefinitions_backup_timestamp",n),console.log("📁 Backed up taskSizeDefinitions (changed data detected)"),cleanupOldBackups()}catch(e){console.log("⚠️ Could not create backup:",e.message)}}function cleanupOldBackups(){try{["taskSizeDefinitions_backup_1","taskSizeDefinitions_backup_2","taskSizeDefinitions_backup_old"].forEach(e=>{localStorage.getItem(e)&&(localStorage.removeItem(e),console.log(`🧹 Cleaned up old backup: ${e}`))})}catch(e){console.log("⚠️ Could not clean up old backups:",e.message)}}function restoreTaskSizeDefinitions(){console.log("🔧 Attempting to restore taskSizeDefinitions...");try{const e=localStorage.getItem("taskSizeDefinitions_backup"),t=localStorage.getItem("taskSizeDefinitions_backup_timestamp");if(e){const n=JSON.parse(e);if(n&&Object.keys(n).length>0)return console.log("✅ Restored from backup:",n),t&&console.log("📅 Backup created:",new Date(t).toLocaleString()),n}}catch(e){console.log("⚠️ Could not restore from backup:",e.message)}const e=getDefaultTaskSizeDefinitions();return console.log("✅ Restored from defaults:",e),e}function calculateEffortMap(){console.log("🔧 calculateEffortMap called"),console.log("📊 taskSizeDefinitions keys count:",Object.keys(taskSizeDefinitions).length),console.log("📊 taskSizeDefinitions:",taskSizeDefinitions),0===Object.keys(taskSizeDefinitions).length&&(console.error("❌ CRITICAL: taskSizeDefinitions is empty! Stack trace:"),console.trace(),taskSizeDefinitions=restoreTaskSizeDefinitions()),effortMap={},Object.keys(taskSizeDefinitions).forEach(e=>{const t=taskSizeDefinitions[e].days,n=t*estimationBaseHours;effortMap[e]=n,console.log(`📊 Size ${e}: ${t} days × ${estimationBaseHours} hours = ${n} hours`)}),console.log("📊 Final effort map:",effortMap)}function getProjectedTickets(){if(console.log("🔧 getProjectedTickets called"),console.log("📊 People count:",people.length),console.log("📊 Tickets count:",tickets.length),0===people.length||0===tickets.length)return console.log("❌ No people or tickets, returning N/A end dates"),tickets.map(e=>({...e,endDate:"N/A",explanation:"No people or no effort.",isDelayed:!1}));calculateEffortMap(),console.log("📊 Effort map:",effortMap),console.log("📊 Task size definitions:",taskSizeDefinitions);const e=people.reduce((e,t)=>(e[t.name]=[...t.availability],e),{}),t=[...tickets].sort((e,t)=>new Date(e.startDate||getEffectiveStartDate())-new Date(t.startDate||getEffectiveStartDate()));console.log("📅 Processing tickets in chronological order:"),t.forEach(e=>{console.log(`  - Ticket ${e.id}: ${e.description}, Start: ${e.startDate}, Size: ${e.size}`)}),console.log("🔄 ========== PASS 1: Fixed-Length Capacity Consumption ==========");const n=new Map;t.forEach(t=>{const a=!1!==t.isFixedLength;if(t.customEndDate||!a||0===t.assigned.length)return;console.log(`🔒 [PASS 1] Consuming capacity for Fixed-Length task ${t.id}: ${t.description}`);const s=taskSizeDefinitions[t.size]?.days||0,i=effortMap[t.size]||0;let o;if(useCommonStartDate){const e=document.getElementById("common-start-date").value;o=e?new Date(e):getEffectiveStartDate()}else o=new Date(t.startDate||getEffectiveStartDate());const r=getNextBusinessDay(new Date(o)),l=calculateTaskEndDate(o,s,!0,t.assigned.length),d=getHeatMapBaselineDate(tickets),c=i/(s*t.assigned.length);let u=new Date(r);for(let n=0;n<s;n++){const n=Math.round((u.getTime()-d.getTime())/864e5),a=Math.floor(n/7);a>=0&&a<8&&t.assigned.forEach(t=>{void 0!==e[t]?.[a]&&(e[t][a]-=c,e[t][a]<0&&(e[t][a]=0))}),u=addBusinessDays(u,1)}console.log(`✅ [PASS 1] Task ${t.id} consumed ${i}h capacity (${c.toFixed(1)}h/person/day × ${s} days)`);const g=`🔒 Fixed-Length Task\nTask Size: ${t.size} = ${s} business days\nTotal Effort: ${i} hours\nAssigned to: ${t.assigned.join(", ")} (${t.assigned.length} person(s))\nStart Date: ${formatDate(r.toISOString().split("T")[0])}\nDuration: ${s} business days (fixed, regardless of team size)\nDaily Capacity per Person: ${c.toFixed(1)} hours/day (${(c/projectHoursPerDay*100).toFixed(0)}% of ${projectHoursPerDay}h day)\nEnd Date: ${formatDate(l.toISOString().split("T")[0])}\n\nNote: Fixed-Length tasks maintain the same duration regardless of how many people are assigned.\nEach person works on the task proportionally over the full duration.`;n.set(t.id,{...t,endDate:l.toLocaleDateString("en-US",{month:"short",day:"numeric"}),rawEndDate:l,explanation:g,isDelayed:!1})}),console.log("🔄 ========== PASS 2: Process All Tasks ==========");const a=t.map(t=>{if(console.log(`🎫 Processing ticket ${t.id}: ${t.description}`),t.customEndDate){console.log(`📅 Using custom end date for ticket ${t.id}: ${t.customEndDate}`);const e=new Date(t.customEndDate),n={...t,endDate:e.toLocaleDateString("en-US",{month:"short",day:"numeric"}),rawEndDate:e,explanation:`Custom deadline set via bulk resolution: ${e.toLocaleDateString()}`,isDelayed:!1};return console.log(`📅 Custom end date result for ticket ${t.id}:`,n),n}if(n.has(t.id))return console.log(`✅ [PASS 2] Using Pass 1 result for Fixed-Length task ${t.id}`),n.get(t.id);console.log(`⚡ [PASS 2] Processing Flexible task ${t.id}`);const a=effortMap[t.size]||0,s=t.assigned.length;console.log(`📊 Ticket ${t.id} - Size: ${t.size}, Effort: ${a}h, Assigned: ${s} people`);const i=t.assigned.filter(e=>{const t=people.find(t=>t.name===e);return t&&t.isProjectReady}),o=t.assigned.filter(e=>{const t=people.find(t=>t.name===e);return t&&!t.isProjectReady});if(console.log(`👥 Assigned to: ${t.assigned.join(", ")}`),i.length>0&&console.log(`🎯 Project Ready (Contributing): ${i.join(", ")}`),o.length>0&&console.log(`📋 Tracked Only (Not Contributing): ${o.join(", ")}`),t.assigned.forEach(t=>{console.log(`🔍 ${t} availability:`,e[t])}),0===a||0===s)return console.log(`❌ Ticket ${t.id} - No effort defined or no one assigned`),{...t,endDate:"N/A",explanation:"No effort defined or no one assigned.",isDelayed:!1};let r;if(useCommonStartDate){const e=document.getElementById("common-start-date").value;r=e?new Date(e):getEffectiveStartDate()}else r=new Date(t.startDate||getEffectiveStartDate());r=getNextBusinessDay(r);const l=getHeatMapBaselineDate(tickets),d=new Date(Date.UTC(r.getFullYear(),r.getMonth(),r.getDate())),c=new Date(Date.UTC(l.getFullYear(),l.getMonth(),l.getDate())),u=Math.max(0,Math.round((d-c)/864e5));console.log("🔍 Debug date calculation (UTC normalization):"),console.log(`  - Original task start: ${r.toDateString()}`),console.log(`  - Original baseline: ${l.toDateString()}`),console.log(`  - UTC task start: ${d.toISOString()}`),console.log(`  - UTC baseline: ${c.toISOString()}`),console.log("  - Raw difference (ms): "+(d-c)),console.log("  - Calculated days: "+(d-c)/864e5),console.log(`  - Days difference (rounded): ${u}`);const g=Math.floor(u/7);console.log(`📅 Task ${t.id} week calculation:`),console.log(`  - Task start date: ${r.toDateString()}`),console.log(`  - Heat map baseline (Monday): ${l.toDateString()}`),console.log(`  - Days difference: ${u}`),console.log(`  - Calculated week index: ${g} (Week ${g+1})`),console.log(`  - Week range: ${getWeekDateRange(g)}`);let m=a;const p=m;let h=-1,k=0,f=0,y=`Ticket Effort: ${a} hours (${t.size}, ${taskSizeDefinitions[t.size].days} person-days).\n`;if(y+=`Assigned: ${t.assigned.join(", ")} (${s} person(s)).\n`,useCommonStartDate){document.getElementById("common-start-date").value;y+=`Start Date: ${formatDate(r.toISOString().split("T")[0])} (Week ${g+1}) [Common Start Date].\n`}else y+=`Start Date: ${formatDate(r.toISOString().split("T")[0])} (Week ${g+1}).\n`;y+=`Required Duration Hours (pooled): ${p.toFixed(1)} hours.\n`,y+=`Planning baseline: Week 1 starts ${formatDate(l.toISOString().split("T")[0])}.\n\n`;let D,v=m;for(let n=g;n<8;n++){f=0;const a={},s=t.assigned.filter(e=>{const t=people.find(t=>t.name===e);return t&&t.isProjectReady}),i=t.assigned.filter(e=>{const t=people.find(t=>t.name===e);return t&&!t.isProjectReady});if(s.forEach(t=>{const s=e[t]&&e[t][n]||0;f+=s,a[t]=s,console.log(`👤 ${t} Week ${n+1}: ${s} hours available (Project Ready)`)}),i.forEach(t=>{const s=e[t]&&e[t][n]||0;a[t]=`${s} (Not Contributing)`,console.log(`👤 ${t} Week ${n+1}: ${s} hours available (Not Project Ready - Tracked Only)`)}),y+=`--- Week ${n+1} (${getWeekDateRange(n)}) ---\n`,s.length>0&&(y+=`Project Ready Resources: ${s.join(", ")}\n`),i.length>0&&(y+=`Tracked Only (Not Contributing): ${i.join(", ")}\n`),y+=`Pooled Capacity: ${f.toFixed(1)} hours.\n`,console.log(`📊 Week ${n+1} Total Pooled Capacity: ${f} hours, Need: ${v} hours`),f<=0)y+="No capacity this week from assigned team members. Moving to next week.\n",console.log(`⏭️ Week ${n+1}: No capacity, moving to next week`);else{if(v<=f){h=n,k=v,y+=`Task completes this week, consuming ${v.toFixed(1)} hours of pooled capacity.\n`,console.log(`✅ Task completes in Week ${n+1}, using ${v} hours of ${f} available`);let s=v;t.assigned.forEach(t=>{const i=a[t];if(i>0){const a=s*(i/f);e[t][n]-=a,y+=`  - ${t} contribution: ${a.toFixed(1)} hours (Remaining: ${e[t][n].toFixed(1)}).\n`}});break}v-=f,y+=`Full capacity consumed (${f.toFixed(1)} hours). Remaining hours for task: ${v.toFixed(1)}.\n`,console.log(`🔄 Week ${n+1}: Used all ${f} hours, ${v} hours remaining`),t.assigned.forEach(t=>{e[t][n]=0})}}let b=null,x=!1;if(-1!==h){const e=new Date(r),t=h-g;if(e.setDate(e.getDate()+7*t),f>0&&k>0){const t=f/5,n=addBusinessDays(e,Math.ceil(k/t)-1);D=n.toLocaleDateString("en-US",{month:"short",day:"numeric"}),b=n}else{const t=getNextBusinessDay(e);D=t.toLocaleDateString("en-US",{month:"short",day:"numeric"}),b=t}y+=`\nTask completes in Week ${h+1}: ${D}\n`}else{y+="\nTask cannot complete within the 8-week planning window based on available capacity.",x=!0;const e=new Date(r);e.setDate(e.getDate()+56),D=e.toLocaleDateString("en-US",{month:"short",day:"numeric"}),b=e}return{...t,endDate:D,rawEndDate:b,explanation:y,isDelayed:x}});return tickets.map(e=>a.find(t=>t.id===e.id)||e)}function calculateProjection(){const e=getProjectedTickets();renderTickets(e),renderWorkloadHeatMap(),updateFurthestCompletionDate(e),populateStakeholderDropdowns(),populateInitiativeDropdowns(),renderStakeholdersList(),renderInitiativesList()}function getPersonNextAvailableDate(e){const t=getProjectedTickets(),n=new Date,a=t.filter(t=>t.assigned&&t.assigned.includes(e));if(0===a.length){return{nextAvailable:getNextBusinessDay(n),status:"Available immediately",lastTaskEnd:null}}let s=new Date(n),i="";a.forEach(e=>{if(e.rawEndDate){const t=new Date(e.rawEndDate);t>s&&(s=t,i=e.description)}});const o=new Date(s);o.setDate(o.getDate()+1);return{nextAvailable:getNextBusinessDay(o),status:`Busy until ${s.toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"})}`,lastTaskEnd:s,lastTaskDescription:i}}function showPersonAvailability(e){const t=getPersonNextAvailableDate(e),n=t.nextAvailable.toLocaleDateString("en-US",{weekday:"long",month:"short",day:"numeric",year:"numeric"}),a=new Date,s=Math.ceil((t.nextAvailable-a)/864e5),i=s<=0?"Available now":1===s?"Available tomorrow":`Available in ${s} days`;let o=`👤 ${e} - Availability Status\n`;o+=`${"=".repeat(40)}\n\n`,o+=`📅 Next Available: ${n}\n`,o+=`⏰ Timeline: ${i}\n\n`,o+=`📊 Current Status: ${t.status}\n`,t.lastTaskDescription&&(o+=`🔗 Last Task: "${t.lastTaskDescription}"\n`),o+="\n💡 Tip: Use this date as the start date when assigning new tasks to avoid overallocation.",alert(o)}function updateFurthestCompletionDate(e){const t=document.getElementById("furthest-completion-date"),n=document.getElementById("furthest-completion-week");if(!e||0===e.length)return t.textContent="No tasks",void(n.textContent="—");let a=null,s=null;if(e.forEach(e=>{e.rawEndDate&&!e.isDelayed&&(!a||e.rawEndDate>a)&&(a=e.rawEndDate,s=e.id)}),a){const e=formatDate(a.toLocaleDateString("en-CA"));t.textContent=e;const i=getEffectiveStartDate(),o=Math.ceil((a-i)/864e5),r=Math.ceil(o/7);n.textContent=`Week ${r}`,n.title=`Task #${s} completes in week ${r}`}else{e.some(e=>e.isDelayed||e.endDate&&e.endDate.includes(">"))?(t.textContent="Beyond 8 weeks",n.textContent="Week 8+",n.title="Some tasks extend beyond the 8-week planning horizon"):(t.textContent="No valid dates",n.textContent="—")}}function renderEffortMap(){calculateEffortMap(),document.getElementById("estimation-base-display").textContent=estimationBaseHours,document.getElementById("estimation-base-hours").value=estimationBaseHours,document.getElementById("project-hours-per-day").value=projectHoursPerDay,renderTaskSizeCards()}function renderTaskSizeCards(){const e=document.getElementById("task-size-cards");e&&(e.innerHTML=Object.keys(taskSizeDefinitions).filter(e=>e&&""!==e.trim()).map(e=>{const t=taskSizeDefinitions[e],n=t.days*estimationBaseHours;return`\n                        <div class="task-size-card">\n                            <div class="size-controls">\n                                <div class="flex justify-between items-center w-full gap-1" style="min-height: 18px;">\n                                    <div class="size-label-enhanced">${e}</div>\n                                    ${t.removable?`<button onclick="removeTaskSize('${e}')" class="text-red-300 hover:text-red-100" style="font-size:10px;line-height:1;">✕</button>`:'<span style="width:10px;"></span>'}\n                                </div>\n                                <input\n                                    type="number"\n                                    value="${t.days}"\n                                    min="0.1"\n                                    max="50"\n                                    step="0.5"\n                                    onchange="updateTaskSizeDaysEnhanced('${e}', this.value)"\n                                    class="size-input-enhanced"\n                                    title="${t.name}"\n                                >\n                                <div class="size-metrics">\n                                    <div style="font-size:9px;">${n}h</div>\n                                </div>\n                            </div>\n                        </div>\n                    `}).join(""),updateTicketSizeDropdown())}function updateEstimationBase(e){estimationBaseHours=parseFloat(e),document.getElementById("estimation-base-display").textContent=estimationBaseHours,console.log("📊 Estimation Base Hours updated to:",estimationBaseHours),markDirty(),calculateEffortMap(),renderTaskSizeCards(),calculateProjection()}function updateProjectHours(e){projectHoursPerDay=parseFloat(e),console.log("📊 Project Hours/Day updated to:",projectHoursPerDay),markDirty(),calculateProjection()}function updateTaskSizeDaysEnhanced(e,t){const n=parseFloat(t);isNaN(n)||n<=0?alert("Please enter a valid number of days"):(backupTaskSizeDefinitions(),taskSizeDefinitions[e].days=n,syncTaskSizes(),calculateEffortMap(),renderTaskSizeCards(),updateTable(),saveData(),console.log(`✅ Updated ${e} to ${n} days and backed up configuration`))}function updateTicketSizeDropdown(){const e=document.getElementById("new-ticket-size");e&&(e.innerHTML=Object.keys(taskSizeDefinitions).filter(e=>e&&""!==e.trim()).map(e=>`<option value="${e}">${taskSizeDefinitions[e].name} (${e})</option>`).join(""))}function updateAvailabilityHeader(){const e=document.getElementById("availability-header");if(useCommonStartDate){const t=document.getElementById("common-start-date")?.value;if(t){const n=formatDate(t);e.textContent=`Team Availability (8 weeks from ${n})`}else e.textContent="Team Availability (8 weeks from common start date)"}else{const t=getEarliestTaskStartDate();if(t){const n=formatDate(t.toISOString().split("T")[0]);e.textContent=`Team Availability (8 weeks from ${n})`}else e.textContent="Team Availability (Next 8 Weeks)"}}function updateStartDateColumnHeader(){const e=document.getElementById("start-date-column-header");e.textContent=useCommonStartDate?"Start Date (Common)":"Start Date (Editable)"}function populateStakeholderDropdowns(){const e=document.getElementById("new-ticket-stakeholder");e&&(e.innerHTML=stakeholders.map(e=>`<option value="${e}">${e}</option>`).join("")),populateStakeholderFilterDropdown()}function populateInitiativeDropdowns(){const e=document.getElementById("new-ticket-initiative");e&&(e.innerHTML=initiatives.map(e=>`<option value="${e.name}">${e.name}</option>`).join("")),populateInitiativeFilterDropdown()}function renderStakeholdersList(){const e=document.getElementById("stakeholders-list");e&&(e.innerHTML=stakeholders.map(e=>`\n                    <span class="inline-flex items-center gap-1.5 px-2.5 py-1.5 bg-teal-100 text-teal-800 rounded-full text-xs font-semibold shadow-sm hover:bg-teal-200 transition">\n                        👤 ${e}\n                        ${"General"!==e?`\n                            <button onclick="removeStakeholder('${e.replace(/'/g,"\\'")}')" \n                                    class="text-red-600 hover:text-red-800 font-bold"\n                                    title="Remove stakeholder">\n                                ✕\n                            </button>\n                        `:'\n                            <span class="text-[10px] text-teal-600 italic">(default)</span>\n                        '}\n                    </span>\n                `).join(""))}function renderInitiativesList(){const e=document.getElementById("initiatives-list");e&&(e.innerHTML=initiatives.map(e=>{const t="General"!==e.name,n=e.startDate?formatDate(e.startDate):"(no tasks)";return`\n                    <div class="inline-flex items-center gap-1.5 px-2.5 py-1.5 bg-orange-100 text-orange-800 rounded-md text-xs shadow-sm hover:bg-orange-200 transition" title="Created: ${formatDate(e.creationDate)} | Start: ${n}">\n                        <span class="font-semibold">📊 ${e.name}</span>\n                        <span class="text-orange-600">•</span>\n                        <span class="text-orange-700">${n}</span>\n                        ${t?`\n                            <button onclick="removeInitiative('${e.name.replace(/'/g,"\\'")}')" \n                                    class="text-red-600 hover:text-red-800 font-bold ml-1"\n                                    title="Remove initiative">\n                                ✕\n                            </button>\n                        `:'\n                            <span class="text-[10px] text-orange-600 italic ml-1">(default)</span>\n                        '}\n                    </div>\n                `}).join(""))}function renderPeople(){updateAvailabilityHeader();const e=document.getElementById("people-list"),t=document.getElementById("new-ticket-assigned");e.innerHTML="",t.innerHTML="",people.forEach((n,a)=>{const s=document.createElement("div");s.className="p-4 bg-indigo-50 rounded-lg border border-indigo-200 hover:bg-indigo-100 transition-colors";let i="";for(let e=0;e<8;e++){i+=`\n                        <div class="flex flex-col items-center min-w-[40px]">\n                            <label class="text-xs text-gray-600 mb-1">W${e+1}</label>\n                            <label class="text-xs text-gray-500 mb-1">${formatWeekEndDate(e)}</label>\n                            <input\n                                type="number"\n                                value="${n.availability[e]||0}"\n                                min="0"\n                                onchange="updatePersonAvailability('${n.name}', ${e}, this.value)"\n                                class="w-10 p-1 text-xs border border-gray-300 rounded text-center focus:border-blue-500 focus:ring-1 focus:ring-blue-200"\n                            >\n                        </div>\n                    `}const o=useCommonStartDate?" (Based on common start date)":getEarliestTaskStartDate()?" (Based on earliest task start date)":"";s.innerHTML=`\n                    <div class="flex justify-between items-start mb-3">\n                        <span class="font-bold text-indigo-800 text-base cursor-pointer hover:text-blue-600 hover:underline transition-colors"\n                              onclick="showPersonAvailability('${n.name}')"\n                              title="Click to see availability">\n                            📅 ${n.name}\n                        </span>\n                        <button onclick="removePerson('${n.name}')" class="text-red-500 hover:text-red-700 transition p-1 rounded hover:bg-red-50">\n                             <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">\n                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />\n                            </svg>\n                        </button>\n                    </div>\n                    <div class="flex items-center gap-2 mb-3 px-1">\n                        <label class="flex items-center gap-1 text-sm cursor-pointer">\n                            <input\n                                type="checkbox"\n                                ${n.isProjectReady?"checked":""}\n                                onchange="updatePersonProjectReady('${n.name}', this.checked)"\n                                class="w-3 h-3 text-blue-600 border-gray-300 rounded focus:ring-blue-500 focus:ring-1"\n                            >\n                            <span class="text-blue-700 font-medium" title="When checked, this person contributes to project delivery timelines. When unchecked, their capacity is tracked but doesn't affect completion dates.">\n                                🎯 Project Ready Resource\n                            </span>\n                        </label>\n                    </div>\n                    <div class="overflow-x-auto">\n                        <div class="flex gap-1 text-xs min-w-max">\n                            ${i}\n                        </div>\n                    </div>\n                    ${o?`<div class="text-xs text-blue-600 mt-2">${o}</div>`:""}\n                `,e.appendChild(s);const r=document.createElement("label");r.className="flex items-center space-x-1 px-2 py-1 hover:bg-gray-100 rounded cursor-pointer";const l=n.isProjectReady?"🎯":"📋",d=n.isProjectReady?"Project Ready - Contributes to delivery timelines":"Tracked Only - Does not affect delivery dates";r.innerHTML=`\n                    <input type="checkbox" value="${n.name}" class="w-3 h-3 text-blue-600 border-gray-300 rounded focus:ring-blue-500 focus:ring-1">\n                    <span class="text-sm cursor-pointer hover:text-blue-600 ${n.isProjectReady?"text-gray-700":"text-gray-500"}"\n                          onclick="event.preventDefault(); showPersonAvailability('${n.name}')"\n                          title="Click to see availability - ${d}">\n                        ${l} ${n.name}\n                    </span>\n                `,t.appendChild(r)}),generatePersonFilterButtons(),generateStatusFilterButtons(),generateDateFilterButtons(),populateStakeholderFilterDropdown(),populateInitiativeFilterDropdown()}function renderTickets(e){const t=document.getElementById("ticket-table-body");t.innerHTML="",updateStartDateColumnHeader();const n=e.filter(e=>shouldShowTicket(e));if(0===n.length){document.getElementById("no-tickets").classList.remove("hidden");const e=document.getElementById("no-tickets");if(selectedPersonFilters.length>0||isUnassignedFilterActive||selectedStatusFilters.length>0||selectedDateFilters.length>0){let t="No tasks found";isUnassignedFilterActive?t+=" that are unassigned":selectedPersonFilters.length>0&&(t+=` for ${selectedPersonFilters.join(", ")}`),selectedStatusFilters.length>0&&((selectedPersonFilters.length>0||isUnassignedFilterActive)&&(t+=" and"),t+=` with status ${selectedStatusFilters.join(", ")}`),selectedDateFilters.length>0&&((selectedPersonFilters.length>0||isUnassignedFilterActive||selectedStatusFilters.length>0)&&(t+=" and"),t+=` active in ${selectedDateFilters.join(", ")}`),t+=".",e.textContent=t}else e.textContent="No tasks defined. Add a task to begin!";return}document.getElementById("no-tickets").classList.add("hidden"),n.forEach(e=>{const n=document.createElement("tr");n.className="hover:bg-gray-50";const a=Array.isArray(e.assigned)?e.assigned.map(e=>e.trim().replace(/^"|"$/g,"").toLowerCase()):[],s=people.map(t=>{const n=t.name.trim().replace(/^"|"$/g,"").toLowerCase(),s=a.includes(n);return`\n                        <label class="flex items-center space-x-1 text-xs whitespace-nowrap">\n                            <input\n                                type="checkbox"\n                                value="${t.name}"\n                                ${s?"checked":""}\n                                onchange="handleAssignmentCheckboxChange(this, ${e.id})"\n                                class="w-3 h-3 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500"\n                            >\n                            <span class="text-gray-700 cursor-pointer hover:text-blue-600"\n                                  onclick="event.preventDefault(); showPersonAvailability('${t.name}')"\n                                  title="Click to see availability">\n                                📅 ${t.name}\n                            </span>\n                        </label>\n                    `}).join(""),i=Object.keys(taskSizeDefinitions).map(t=>{const n=taskSizeDefinitions[t];return`<option value="${t}" ${e.size===t?"selected":""}>${n.name} (${t})</option>`}).join(""),o=["P1","P2","P3","P4","P5"].map(t=>`<option value="${t}" ${(e.priority||"P3")===t?"selected":""}>${t}</option>`).join(""),r=e.isDelayed?"bg-red-100 text-red-700 font-bold p-1 rounded":"text-green-600 font-semibold";let l,d="";if(useCommonStartDate){l=formatDate(document.getElementById("common-start-date").value)+" 🔗",d=`<span class="text-gray-500 text-sm">${l}</span>`}else d=`\n                        <input\n                            type="date"\n                            value="${e.startDate||""}"\n                            onchange="handleStartDateChange(this, ${e.id})"\n                            class="w-full p-1 border border-gray-300 rounded-lg text-xs bg-white"\n                            title="Change task start date"\n                        >\n                    `;const c=!1===e.isFixedLength?"⚡":"🔒",u=!1===e.isFixedLength?"Flexible Task (click to change to Fixed-Length)":"Fixed-Length Task (click to change to Flexible)",g=stakeholders.map(t=>`<option value="${t}" ${(e.stakeholder||"General")===t?"selected":""}>${t}</option>`).join(""),m=initiatives.map(t=>{const n=(e.initiative||"General")===t.name;return`<option value="${t.name}" ${n?"selected":""}>${t.name}</option>`}).join("");n.innerHTML=`\n                    <td class="px-3 py-2 whitespace-nowrap text-sm text-gray-500">${e.id}</td>\n                    <td class="px-3 py-2 text-sm text-gray-900 w-1/3">\n                        <span\n                            class="cursor-pointer hover:opacity-70 transition-opacity"\n                            title="${u}"\n                            onclick="toggleTaskType(${e.id})"\n                            style="font-size: 1.2em; user-select: none;"\n                        >${c}</span> ${e.description}\n                    </td>\n                    <td class="px-3 py-2 whitespace-nowrap text-sm text-gray-600">${d}</td>\n                    <td class="px-3 py-2 whitespace-nowrap text-sm font-medium">\n                        <select\n                            class="w-full p-2 border border-gray-300 rounded-lg text-sm bg-white text-indigo-600 font-semibold"\n                            onchange="handleSizeChange(this, ${e.id})"\n                            title="Change task size"\n                            style="min-width: 100px; font-size: 13px;"\n                        >\n                            ${i}\n                        </select>\n                    </td>\n                    <td class="px-3 py-2 whitespace-nowrap text-center">\n                        <div class="flex items-center justify-center gap-2">\n                            <span style="font-size: 1.2em;">${c}</span>\n                            <label class="flex items-center cursor-pointer" title="Check for Flexible, uncheck for Fixed-Length">\n                                <input\n                                    type="checkbox"\n                                    ${!1===e.isFixedLength?"checked":""}\n                                    onchange="toggleTaskType(${e.id})"\n                                    class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500"\n                                >\n                                <span class="ml-1 text-xs text-gray-600">Flex</span>\n                            </label>\n                        </div>\n                    </td>\n                    <td class="px-3 py-2 whitespace-nowrap text-sm font-medium">\n                        <select\n                            class="w-full p-1 border border-gray-300 rounded-lg text-xs bg-white text-purple-600 font-medium"\n                            onchange="handlePriorityChange(this, ${e.id})"\n                            title="Change task priority"\n                        >\n                            ${o}\n                        </select>\n                    </td>\n                    <td class="px-3 py-2 whitespace-nowrap text-sm font-medium">\n                        <span\n                            class="status-badge ${getStatusClass(e.status||"To Do")}"\n                            onclick="cycleTaskStatus(${e.id})"\n                            oncontextmenu="handleStatusRightClick(event, ${e.id})"\n                            data-ticket-id="${e.id}"\n                            title="Click to change status"\n                        >\n                            ${getStatusDisplayWithComments(e)}\n                        </span>\n                    </td>\n                    <td class="px-3 py-2 whitespace-nowrap text-sm font-medium">\n                        <select\n                            class="w-full p-1 border border-gray-300 rounded-lg text-xs bg-white text-teal-600 font-medium"\n                            onchange="handleStakeholderChange(this, ${e.id})"\n                            title="Change stakeholder"\n                        >\n                            ${g}\n                        </select>\n                    </td>\n                    <td class="px-3 py-2 whitespace-nowrap text-sm font-medium">\n                        <select\n                            class="w-full p-1 border border-gray-300 rounded-lg text-xs bg-white text-orange-600 font-medium"\n                            onchange="handleInitiativeChange(this, ${e.id})"\n                            title="Change initiative"\n                        >\n                            ${m}\n                        </select>\n                    </td>\n                    <td class="px-3 py-2 text-sm text-gray-500 w-1/4">\n                        <div class="flex flex-wrap gap-1 min-h-[40px] items-center">\n                            ${s}\n                        </div>\n                    </td>\n                    <td class="px-3 py-2 whitespace-nowrap text-sm text-gray-900">\n                        <div class="flex items-center">\n                            <span class="${r}">${e.endDate}</span>\n                            ${e.customEndDate?'<span class="ml-1 text-xs text-blue-600" title="Custom deadline set">📅</span>':""}\n                            <button onclick="showCalculationDetails(${e.id})" class="details-btn" title="Show calculation details">\n                                Details\n                            </button>\n                        </div>\n                    </td>\n                    <td class="px-3 py-2 whitespace-nowrap text-right text-sm font-medium">\n                        <div class="flex items-center justify-end gap-2">\n                            <button onclick="openTaskDetailsModal(${e.id})" class="${e.taskDetails&&(e.taskDetails.description||e.taskDetails.positives||e.taskDetails.negatives)?"text-blue-600 hover:text-blue-800":"text-gray-400 hover:text-gray-600"} transition" title="Edit task details">\n                                <span style="font-size: 1.2em;">📝</span>\n                            </button>\n                            <button onclick="removeTicket(${e.id})" class="text-red-500 hover:text-red-700 transition" title="Delete task">\n                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">\n                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />\n                                </svg>\n                            </button>\n                        </div>\n                    </td>\n                `,t.appendChild(n);const p=n.querySelector(".status-badge");if(p&&"Paused"===e.status&&e.pauseComments&&e.pauseComments.length>0){const t=e.pauseComments[e.pauseComments.length-1];let n='Left click: Change status\nRight click: Edit latest comment\n\nLatest pause reason:\n"'+t.comment+'"\n('+t.timestamp+")";e.pauseComments.length>1&&(n+="\n\n"+e.pauseComments.length+" total pause comments"),p.title=n,console.log(`🏷️ Set tooltip for ticket ${e.id}:`,n)}else p&&"Paused"===e.status&&(p.title="Left click: Change status\nRight click: Add pause comment")}),updateExportButtonsState()}function updateExportButtonsState(){const e=tickets.filter(e=>"Closed"===(e.status||"To Do")),t=document.getElementById("export-closed-btn");t&&(e.length>0&&!closedItemsExported?(t.disabled=!1,t.classList.remove("opacity-50","cursor-not-allowed")):0===e.length&&(t.disabled=!0,t.classList.add("opacity-50","cursor-not-allowed")))}function importConfiguration(e){const t=parseCSVContent(e);let n="",a={settings:{},taskSizeDefinitions:{},people:[],tickets:[],stakeholders:["General"],initiatives:[{name:"General",creationDate:getLocalDateString(new Date),startDate:null}]},s=!1;for(let e=0;e<t.length;e++){const i=t[e];if(i.startsWith("SECTION,"))n=i.split(",")[1],s=!["METADATA","SETTINGS"].includes(n);else if(s)s=!1;else if(i)try{if("SETTINGS"===n){const[e,t]=parseCSVLine(i);"Estimation Base Hours"===e?a.settings.estimationBaseHours=parseInt(t):"Project Hours Per Day"===e||"Hours Per Day"===e?a.settings.projectHoursPerDay=parseInt(t):"Use Common Start Date"===e?a.settings.useCommonStartDate="true"===t:"Common Start Date"===e?a.settings.commonStartDate=t:"Current Ticket ID"===e&&(a.settings.currentTicketId=parseInt(t))}else if("TASK_SIZES"===n){const[e,t,n,s]=parseCSVLine(i);if(console.log(`📦 IMPORT TASK_SIZE: key="${e}", name="${t}", days="${n}" (parsed: ${parseFloat(n)}), removable="${s}"`),!e||""===e.trim()||isNaN(parseFloat(n))){console.warn(`⚠️ Skipping invalid task size: key="${e}", days="${n}"`);continue}a.taskSizeDefinitions[e]={name:t,days:parseFloat(n),removable:"true"===s},console.log("📦 IMPORT TASK_SIZE RESULT:",a.taskSizeDefinitions[e])}else if("STAKEHOLDERS"===n){const e=parseCSVLine(i)[0];e&&e.trim()&&(1===a.stakeholders.length&&"General"===a.stakeholders[0]&&(a.stakeholders=[]),a.stakeholders.push(e))}else if("INITIATIVES"===n){const e=parseCSVLine(i),[t,n,s]=e;t&&t.trim()&&(1===a.initiatives.length&&"General"===a.initiatives[0].name&&(a.initiatives=[]),a.initiatives.push({name:t,creationDate:n||getLocalDateString(new Date),startDate:s&&s.trim()?s:null}))}else if("PEOPLE"===n){const e=parseCSVLine(i),t=e[0],n=e.slice(1,9).map(e=>parseInt(e)||0),s=!(e.length>=10)||("true"===e[9]||"Yes"===e[9]);for(;n.length<8;){const e=n[n.length-1]||25;n.push(e)}n.length>8&&(n.length=8),a.people.push({name:t,availability:n,isProjectReady:s})}else if("TICKETS"===n){const e=parseCSVLine(i);let t,n,s,o,r,l,d,c,u,g,m,p,h,k,f,y,D,v,b;const x=e[0];x&&x.includes("-")?[t,n,s,o,r,l,d,c,u,g,m,p,h,k,f,y,createdDate,D,v,b]=e:([n,s,o,r,l,u,g,m,p,h,k,f,y,D,v,b]=e,t=generateUUID(),createdDate="",d="General",c="General");const $=u?u.split(";").map(e=>e.trim().replace(/^"|"$/g,"")).filter(e=>e):[];let S=!0;if(m){const e=m.trim().toLowerCase();"flexible"!==e&&"flex"!==e||(S=!1)}const w=[];if(p&&p.trim()){p.split(" | ").forEach(e=>{const t=e.match(/^\[([^\]]+)\] (.+)$/);t&&w.push({timestamp:t[1],comment:t[2]})})}const T=[];if(h&&h.trim()){h.split(" | ").forEach(e=>{const t=e.match(/^([^(]+)\(([^@]+)@([^)]+)\)$/);t&&T.push({date:t[1],reason:t[2],timestamp:t[3]})})}const E=[];if(k&&k.trim()){k.split(" | ").forEach(e=>{const t=e.match(/^([^(]+)\(([^@]+)@([^)]+)\)$/);t&&E.push({date:t[1],reason:t[2],timestamp:t[3]})})}const C=[];if(f&&f.trim()){f.split(" | ").forEach(e=>{const t=e.match(/^([^:]+):(\d+)d\(([^@]+)@([^)]+)\)$/);t&&C.push({size:t[1],days:parseInt(t[2]),reason:t[3],timestamp:t[4]})})}const I={uuid:t||generateUUID(),id:parseInt(n),description:s,startDate:o,size:r,priority:l||"P3",stakeholder:d||"General",initiative:c||"General",assigned:$,status:g||"To Do",isFixedLength:S,pauseComments:w,startDateHistory:T,endDateHistory:E,sizeHistory:C,customEndDate:y&&y.trim()?y:void 0};(D||v||b)&&(I.taskDetails={description:D||"",positives:v||"",negatives:b||""}),a.tickets.push(I)}}catch(e){console.warn(`Skipping invalid line in ${n}: ${i}`)}}if(!validateImportedData(a))return void alert("❌ Invalid configuration file. Please check the file format and try again.");const i=`📋 Import Configuration\n\nFound:\n• ${Object.keys(a.taskSizeDefinitions).length} task size definitions\n• ${a.people.length} team members\n• ${a.stakeholders.length} stakeholders\n• ${a.initiatives.length} initiatives\n• ${a.tickets.length} tickets\n\n⚠️ This will replace ALL current data!\n\nContinue with import?`;if(confirm(i))try{estimationBaseHours=a.settings.estimationBaseHours||5,projectHoursPerDay=a.settings.projectHoursPerDay||a.settings.hoursPerDay||8,useCommonStartDate=a.settings.useCommonStartDate||!1;let e=1;a.tickets.forEach(t=>{const n=t.id;t.id=e,console.log(`🔢 Renumbered task: ${n} → ${e} (${t.description})`),e++}),currentTicketId=a.tickets.length+1,console.log(`🔢 Set currentTicketId to ${currentTicketId} (renumbered ${a.tickets.length} tickets)`),console.log("🔄 IMPORT: About to replace taskSizeDefinitions"),console.log("🔄 IMPORT: Current taskSizeDefinitions:",taskSizeDefinitions),console.log("🔄 IMPORT: Incoming taskSizeDefinitions:",a.taskSizeDefinitions),taskSizeDefinitions=a.taskSizeDefinitions,console.log("🔄 IMPORT: After replacement:",taskSizeDefinitions),people=a.people,people.forEach(e=>{void 0===e.isProjectReady&&(e.isProjectReady=!0)}),stakeholders=a.stakeholders,initiatives=a.initiatives,console.log("🔄 V10 IMPORT: Stakeholders:",stakeholders),console.log("🔄 V10 IMPORT: Initiatives:",initiatives),tickets=a.tickets,tickets=tickets.map(e=>e=initializeSizeHistory(e=initializeEndDateHistory(e=initializeStartDateHistory(e)))),recalculateAllInitiativeStartDates(),console.log("🔄 V10 IMPORT: Initiative start dates recalculated"),console.log("🔍 People after import:",JSON.stringify(people,null,2)),console.log("🔍 Tickets after import:",JSON.stringify(tickets,null,2));tickets.filter(e=>"Closed"===(e.status||"To Do")).forEach(e=>{console.log(`🔍 Closed Ticket ${e.id} assigned:`,e.assigned)}),0===people.length&&alert("❌ No people imported! Please check the PEOPLE section of your configuration CSV. Assigned people will not display unless team members are imported."),0===Object.keys(taskSizeDefinitions).length&&alert("⚠️ No task sizes imported! Please check the TASK_SIZES section of your configuration CSV."),selectedPersonFilters=[],selectedStatusFilters=[],selectedDateFilters=[],document.getElementById("estimation-base-hours").value=estimationBaseHours,document.getElementById("project-hours-per-day").value=projectHoursPerDay,document.getElementById("estimation-base-display").textContent=estimationBaseHours,document.getElementById("use-common-start-date").checked=useCommonStartDate,a.settings.commonStartDate&&(document.getElementById("common-start-date").value=a.settings.commonStartDate),useCommonStartDate&&toggleCommonStartDate(),syncTaskSizes(),calculateEffortMap(),renderEffortMap(),renderPeople(),calculateProjection(),updateFilterUI(),saveToLocalStorage(),markClean(),alert(`✅ Configuration imported successfully (V10)!\n\n• ${Object.keys(taskSizeDefinitions).length} task sizes loaded\n• ${people.length} team members configured\n• ${stakeholders.length} stakeholders loaded\n• ${initiatives.length} initiatives loaded\n• ${tickets.length} tickets imported\n\nAll data has been restored and calculations updated.`)}catch(e){console.error("❌ IMPORT ERROR:",e),console.error("❌ ERROR STACK:",e.stack),alert(`❌ Error applying configuration: ${e.message}\n\nPlease check your file and try again.`)}}function parseCSVLine(e){const t=[];let n="",a=!1,s=0;for(;s<e.length;){const i=e[s],o=s<e.length-1?e[s+1]:null;'"'===i?a?'"'===o?(n+='"',s++):a=!1:a=!0:","!==i||a?n+=i:(t.push(n),n=""),s++}return t.push(n),t}function parseCSVContent(e){const t=[];let n="",a=!1;for(let s=0;s<e.length;s++){const i=e[s],o=s<e.length-1?e[s+1]:null;'"'===i?(n+=i,a&&'"'===o?(n+='"',s++):a=!a):"\n"!==i||a?"\r"===i?"\n"===o||a||(n.trim()&&t.push(n.trim()),n=""):n+=i:(n.trim()&&t.push(n.trim()),n="")}return n.trim()&&t.push(n.trim()),t}function validateImportedData(e){if(!(e.settings&&e.taskSizeDefinitions&&e.people&&e.tickets))return!1;for(const t of e.people)if(!t.name||!Array.isArray(t.availability)||8!==t.availability.length)return!1;for(const t of e.tickets)if(!(t.id&&t.description&&t.size&&Array.isArray(t.assigned)))return!1;return!0}function importTasksFromCSV(e){const t=e.split("\n").map(e=>e.trim()).filter(e=>e);if(0===t.length)return void alert("❌ The CSV file appears to be empty.");const n=[];let a=!1;const s=t[0].toLowerCase();(s.includes("task")||s.includes("description")||s.includes("name"))&&(a=!0);for(let e=a?1:0;e<t.length;e++){const a=t[e];if(!a)continue;let s=a.replace(/^"(.*)"$/,"$1").replace(/""/g,'"').trim();s&&(s.length>200&&(console.warn(`Task name too long, truncating: ${s.substring(0,50)}...`),s=s.substring(0,200)),n.push(s))}if(0===n.length)return void alert("❌ No valid tasks found in the CSV file.\n\nExpected format:\n• One task per line\n• Optional header row\n• Task names in first column");const i=n.slice(0,5).join("\n"),o=n.length>5?`\n... and ${n.length-5} more tasks`:"",r=`📋 Import ${n.length} Tasks\n\nPreview:\n${i}${o}\n\n✅ Default settings will be applied:\n• Size: Medium (M)\n• Priority: P3\n• Status: To Do\n• Start Date: Next Monday\n• Assigned: Unassigned\n\nContinue with import?`;if(!confirm(r))return;const l=getLocalDateString(getNextMonday(new Date)),d=[];let c=0,u=0;if(n.forEach(e=>{if(tickets.some(t=>t.description.toLowerCase()===e.toLowerCase()))return u++,void console.warn(`Skipping duplicate task: ${e}`);tickets.push({id:currentTicketId++,description:e,startDate:l,size:"M",priority:"P3",status:"To Do",assigned:[...d],pauseComments:[]}),c++}),c>0){useCommonStartDate||renderPeople(),calculateProjection(),saveToLocalStorage();let e=`✅ Task Import Complete!\n\n• ${c} tasks added successfully`;u>0&&(e+=`\n• ${u} duplicates skipped`),e+=`\n\n📝 All tasks set to:\n• Size: Medium (M)\n• Priority: P3\n• Start Date: ${formatDate(l)}\n• Status: Unassigned\n\nYou can now edit individual tasks as needed.`,alert(e)}else alert("❌ No tasks were added. All tasks may have been duplicates.")}function checkP1TaskConflicts(e,t,n,a=null){if(console.log("🔍 P1 Conflict Check:",{employeeNames:e,taskStartDate:t,taskSize:n,excludeTaskId:a}),!Array.isArray(e)||0===e.length)return console.log("❌ No employees to check or invalid input"),{hasConflicts:!1,conflictedEmployees:[],availableEmployees:[]};const s=getProjectedTickets();console.log("📊 Fresh projected tickets count:",s.length),console.log("📊 Sample projected ticket:",s[0]);const i={id:-1,description:"temp",startDate:t,size:n,priority:"P1",assigned:e};console.log("🔧 Created temp task:",i);s.concat([i]);let o=getProjectedTickets([i]).find(e=>-1===e.id);if(console.log("📈 Temp task projected:",o),!o||!o.rawEndDate){const e=new Date(t);e.setDate(e.getDate()+28),o={rawEndDate:e},console.log("⚠️ Using fallback end date calculation:",e)}const r=new Date(t),l=o.rawEndDate;console.log("🗓️ New task date range:",{start:r.toDateString(),end:l.toDateString()});const d=[],c=[];e.forEach(e=>{console.log(`🔍 Checking ${e} for P1 conflicts...`);let t=!1;const n=tickets.filter(t=>"P1"===t.priority&&t.assigned.includes(e)&&t.id!==a);console.log(`📋 Found ${n.length} existing P1 tasks for ${e}:`,n.map(e=>({id:e.id,desc:e.description,start:e.startDate})));for(const a of n){console.log("🔍 Checking existing task:",{id:a.id,desc:a.description,start:a.startDate,size:a.size});const n=s.find(e=>e.id===a.id);if(console.log("📊 Existing task projected:",n),console.log("📊 Available properties:",n?Object.keys(n):"none"),n&&(n.rawEndDate||n.endDate)){const s=new Date(a.startDate),i=n.rawEndDate||n.endDate,o=new Date(i);if(console.log("📊 Date values:",{existingEndValue:i,existingEnd:o,isValidDate:!isNaN(o.getTime())}),isNaN(o.getTime())||"N/A"===i)return console.error(`❌ PROJECTION SYSTEM BUG: Task ${a.id} has invalid end date '${i}'. This must be fixed!`),console.log("Task details:",a),void console.log("Projected details:",n);const c=r<=o&&l>=s;if(console.log(`📅 Date overlap check for ${e}:`,{newTaskStart:r.toDateString(),newTaskEnd:l.toDateString(),existingStart:s.toDateString(),existingEnd:o.toDateString(),hasOverlap:c,condition1:r<=o,condition2:l>=s}),c){console.log(`⚠️ CONFLICT DETECTED for ${e}!`),t=!0,d.find(t=>t.name===e)||d.push({name:e,conflictingTaskId:a.id,conflictingTaskDescription:a.description,conflictingTaskStart:a.startDate});break}}else console.log(`❌ No projected data found for existing task ${a.id}, available properties:`,n?Object.keys(n):"task not found")}t||c.push(e)});people.map(e=>e.name).filter(t=>!e.includes(t)).forEach(e=>{let t=!1;const n=tickets.filter(t=>"P1"===t.priority&&t.assigned.includes(e)&&t.id!==a);for(const e of n){const n=s.find(t=>t.id===e.id);if(n&&n.rawEndDate){const a=new Date(e.startDate),s=n.rawEndDate;if(r<=s&&l>=a){t=!0;break}}}t||c.push(e)});const u={hasConflicts:d.length>0,conflictedEmployees:d,availableEmployees:c};return console.log("✅ P1 Conflict Check Result:",u),u}function showP1ConflictWarning(e){const t=e.conflictedEmployees.map(e=>e.name),n=e.availableEmployees;let a="";if(1===t.length){const n=e.conflictedEmployees[0];a=`Employee ${t[0]} already has another P1 task assigned ("${n.conflictingTaskDescription}") starting ${formatDate(n.conflictingTaskStart)}.`}else{a=`Employees ${e.conflictedEmployees.map(e=>`${e.name} ("${e.conflictingTaskDescription}" from ${formatDate(e.conflictingTaskStart)})`).join(", ")} already have other P1 tasks assigned.`}return n.length>0?a+=`\n\nFollowing employees have no P1 tasks against them during this period - ${n.join(", ")}. You can pick any of them.`:a+="\n\nNo employees are available for P1 tasks during this period.",a+="\n\n⚠️ Do you want to proceed anyway? This person will have multiple P1 tasks during overlapping periods.",confirm(a)}function updateInitiativeStartDate(e,t){const n=initiatives.find(t=>t.name===e);if(!n)return;const a=tickets.filter(t=>t.initiative===e&&t.startDate);let s=t;for(const e of a)(!s||e.startDate<s)&&(s=e.startDate);n.startDate!==s&&(console.log(`📊 Initiative "${e}" start date updated: ${n.startDate} → ${s}`),n.startDate=s)}function recalculateAllInitiativeStartDates(){for(const e of initiatives){const t=tickets.filter(t=>t.initiative===e.name&&t.startDate);if(t.length>0){const n=t.reduce((e,t)=>!e||t.startDate<e?t.startDate:e,null);e.startDate=n}else e.startDate=null}}function setTaskStatusDirect(e,t){const n=tickets.findIndex(t=>t.id===e);if(n>-1){const a=tickets[n].status||"To Do";return tickets[n].status=t,console.log(`📊 Ticket #${e} status changed from "${a}" to "${t}" (bulk operation)`),!0}return!1}window.addStakeholder=function(){const e=document.getElementById("new-stakeholder-input"),t=e.value.trim();t?stakeholders.includes(t)?alert(`Stakeholder "${t}" already exists.`):(stakeholders.push(t),e.value="",markDirty(),saveToLocalStorage(),renderStakeholdersList(),populateStakeholderDropdowns(),calculateProjection(),console.log(`✅ Added stakeholder: "${t}"`)):alert("Please enter a stakeholder name.")},window.removeStakeholder=function(e){if("General"===e)return void alert('Cannot remove the default "General" stakeholder.');const t=tickets.filter(t=>t.stakeholder===e);if(t.length>0){if(!window.confirm(`⚠️ Warning: ${t.length} task(s) are assigned to stakeholder "${e}".\n\nThese tasks will be reassigned to "General".\n\nContinue?`))return;t.forEach(e=>{e.stakeholder="General"})}stakeholders=stakeholders.filter(t=>t!==e),selectedStakeholderFilter===e&&(selectedStakeholderFilter="",updateFilterUI()),markDirty(),saveToLocalStorage(),renderStakeholdersList(),populateStakeholderDropdowns(),calculateProjection(),console.log(`✅ Removed stakeholder: "${e}"`)},window.addInitiative=function(){const e=document.getElementById("new-initiative-input"),t=e.value.trim();t?initiatives.find(e=>e.name===t)?alert(`Initiative "${t}" already exists.`):(initiatives.push({name:t,creationDate:getLocalDateString(new Date),startDate:null}),e.value="",markDirty(),saveToLocalStorage(),renderInitiativesList(),populateInitiativeDropdowns(),calculateProjection(),console.log(`✅ Added initiative: "${t}"`)):alert("Please enter an initiative name.")},window.removeInitiative=function(e){if("General"===e)return void alert('Cannot remove the default "General" initiative.');const t=tickets.filter(t=>t.initiative===e);if(t.length>0){if(!window.confirm(`⚠️ Warning: ${t.length} task(s) are assigned to initiative "${e}".\n\nThese tasks will be reassigned to "General".\n\nContinue?`))return;t.forEach(e=>{e.initiative="General"})}initiatives=initiatives.filter(t=>t.name!==e),selectedInitiativeFilter===e&&(selectedInitiativeFilter="",updateFilterUI()),markDirty(),saveToLocalStorage(),renderInitiativesList(),populateInitiativeDropdowns(),calculateProjection(),console.log(`✅ Removed initiative: "${e}"`)},window.exportData=()=>{const e=getProjectedTickets();if(0===e.length)return void alert("No tickets to export.");const t=e=>{if(!e)return"Not set";const t=new Date(e);return`${t.toLocaleDateString("en-US",{month:"short"})} ${t.getDate()} ${t.getFullYear()}`};let n="Ticket ID,Description,Start Date,Size,Priority,Status,Task Type,Pause Comments,Person Days,Total Hours,Assigned Team,Projected End Date,Detailed Explanation,Details: Description,Details: Positives,Details: Negatives\n";e.forEach(e=>{const a=effortMap[e.size]||0,s=taskSizeDefinitions[e.size]?.days||0,i=e=>`"${String(e).replace(/"/g,'""')}"`,o=e.pauseComments&&e.pauseComments.length>0?e.pauseComments.map(e=>`[${e.timestamp}] ${e.comment}`).join(" | "):"",r=!1!==e.isFixedLength?"Fixed":"Flexible",l=e.taskDetails||{},d=i(l.description||""),c=i(l.positives||""),u=i(l.negatives||""),g=[e.id,i(e.description),t(e.startDate),e.size,e.priority||"P3",i(e.status||"To Do"),r,i(o),s,a,i(e.assigned.join("; ")),e.endDate.replace(/,/g,""),i(e.explanation.replace(/\n/g," | ")),d,c,u].join(",");n+=g+"\n"});const a=new Blob([n],{type:"text/csv;charset=utf-8;"}),s=document.createElement("a"),i=URL.createObjectURL(a);s.setAttribute("href",i),s.setAttribute("download",`project_schedule_${(new Date).toISOString().slice(0,10)}.csv`),s.style.visibility="hidden",document.body.appendChild(s),s.click(),document.body.removeChild(s)},window.exportFilteredTasksToCSV=()=>{const e=document.getElementById("ticket-table-body");if(!e)return void alert("Task table not found.");const t=e.getElementsByTagName("tr"),n=[];for(let e=0;e<t.length;e++){const a=t[e];if("none"!==a.style.display){const e=parseInt(a.cells[0].textContent),t=tickets.find(t=>t.id===e);t&&n.push(t)}}if(0===n.length)return void alert("No visible tasks to export.");const a=e=>{if(!e)return"Not set";const t=new Date(e);return`${t.toLocaleDateString("en-US",{month:"short"})} ${t.getDate()} ${t.getFullYear()}`};let s="Ticket ID,Description,Start Date,Size,Priority,Status,Task Type,Assigned Team,Stakeholder,Initiative,Projected End Date,Details: Description,Details: Positives,Details: Negatives\n";n.forEach(e=>{const t=getProjectedTickets().find(t=>t.id===e.id),n=t?t.endDate.replace(/,/g,""):"N/A",i=e=>`"${String(e).replace(/"/g,'""')}"`,o=e.taskDetails||{},r=i(o.description||""),l=i(o.positives||""),d=i(o.negatives||""),c=!1!==e.isFixedLength?"Fixed":"Flexible",u=[e.id,i(e.description),a(e.startDate),e.size,e.priority||"P3",i(e.status||"To Do"),c,i(e.assigned.join("; ")),i(e.stakeholder||""),i(e.initiative||""),n,r,l,d].join(",");s+=u+"\n"});const i=new Blob([s],{type:"text/csv;charset=utf-8;"}),o=document.createElement("a"),r=URL.createObjectURL(i);o.setAttribute("href",r),o.setAttribute("download",`filtered_tasks_${(new Date).toISOString().slice(0,10)}.csv`),o.style.visibility="hidden",document.body.appendChild(o),o.click(),document.body.removeChild(o),console.log(`✅ Exported ${n.length} filtered tasks to CSV`)},window.exportClosedItems=()=>{const e=(new Date).toISOString().slice(0,19).replace("T","_").replace(/:/g,"-"),t=tickets.filter(e=>"Closed"===(e.status||"To Do"));if(0===t.length)return;const n={metadata:{exportDate:(new Date).toISOString(),version:"2.0",description:"Enterprise Project Tracking Console Configuration Export - Closed Items"},settings:{estimationBaseHours:estimationBaseHours,projectHoursPerDay:projectHoursPerDay,useCommonStartDate:useCommonStartDate,commonStartDate:document.getElementById("common-start-date")?.value||"",currentTicketId:currentTicketId},taskSizeDefinitions:taskSizeDefinitions,people:people,tickets:t};let a="";a+="SECTION,METADATA\n",a+="Key,Value\n",a+=`Export Date,${n.metadata.exportDate}\n`,a+=`Version,${n.metadata.version}\n`,a+=`Description,${n.metadata.description}\n`,a+="\n",a+="SECTION,SETTINGS\n",a+="Key,Value\n",a+=`Estimation Base Hours,${n.settings.estimationBaseHours}\n`,a+=`Project Hours Per Day,${n.settings.projectHoursPerDay}\n`,a+=`Use Common Start Date,${n.settings.useCommonStartDate}\n`,a+=`Common Start Date,${n.settings.commonStartDate}\n`,a+=`Current Ticket ID,${n.settings.currentTicketId}\n`,a+="\n",a+="SECTION,TASK_SIZES\n",a+="Size Key,Name,Days,Removable\n",Object.keys(n.taskSizeDefinitions).forEach(e=>{const t=n.taskSizeDefinitions[e];a+=`${e},"${t.name}",${t.days},${t.removable}\n`}),a+="\n",a+="SECTION,PEOPLE\n",a+="Name,Week1,Week2,Week3,Week4,Week5,Week6,Week7,Week8,Project Ready\n",n.people.forEach(e=>{const t=[...e.availability];for(;t.length<8;)t.push(25);const n=void 0===e.isProjectReady||e.isProjectReady;a+=`"${e.name}",${t.slice(0,8).join(",")},${n?"Yes":"No"}\n`}),a+="\n",a+="SECTION,TICKETS\n",a+="ID,Description,Start Date,Size,Priority,Assigned Team,Status,Task Type,Pause Comments,Start Date History,End Date History,Size History,Custom End Date,Created Date,Details Description,Details Positives,Details Negatives\n",n.tickets.forEach(e=>{const t=e.assigned.join(";"),n=e.priority||"P3",s=e.status||"Closed",i=!1!==e.isFixedLength?"Fixed":"Flexible",o=e.pauseComments&&e.pauseComments.length>0?e.pauseComments.map(e=>`[${e.timestamp}] ${e.comment}`).join(" | "):"",r=e.startDateHistory&&e.startDateHistory.length>0?e.startDateHistory.map(e=>`${e.date}(${e.reason}@${e.timestamp})`).join(" | "):"",l=e.endDateHistory&&e.endDateHistory.length>0?e.endDateHistory.map(e=>`${e.date}(${e.reason}@${e.timestamp})`).join(" | "):"",d=e.sizeHistory&&e.sizeHistory.length>0?e.sizeHistory.map(e=>`${e.size}:${e.days}d(${e.reason}@${e.timestamp})`).join(" | "):"",c=e.customEndDate||"",u=e.createdDate||(new Date).toISOString().split("T")[0],g=e.taskDetails||{},m=(g.description||"").replace(/"/g,'""').replace(/\r\n/g,"\n"),p=(g.positives||"").replace(/"/g,'""').replace(/\r\n/g,"\n"),h=(g.negatives||"").replace(/"/g,'""').replace(/\r\n/g,"\n");a+=`${e.id},"${e.description.replace(/"/g,'""')}",${e.startDate},${e.size},${n},"${t}","${s}","${i}","${o}","${r}","${l}","${d}","${c}","${u}","${m}","${p}","${h}"\n`});const s=new Blob([a],{type:"text/csv;charset=utf-8;"}),i=document.createElement("a"),o=URL.createObjectURL(s);i.setAttribute("href",o),i.setAttribute("download",`project_config_closed_${e}.csv`),i.style.visibility="hidden",document.body.appendChild(i),i.click(),document.body.removeChild(i),closedItemsExported=!0;const r=document.getElementById("export-closed-btn");r&&(r.disabled=!0,r.classList.add("opacity-50","cursor-not-allowed")),alert(`✅ Closed items exported successfully!\n\nFile: project_config_closed_${e}.csv\n\nNow you can click "Export Config" to export active tasks.`)},window.exportConfiguration=()=>{if(tickets.filter(e=>"Closed"===(e.status||"To Do")).length>0&&!closedItemsExported)return void alert('⚠️ Please export closed items first!\n\nClick the "Export Closed" button before exporting the configuration.\n\nThis prevents the browser from blocking multiple file downloads.');const e=(new Date).toISOString().slice(0,19).replace("T","_").replace(/:/g,"-"),t={metadata:{exportDate:(new Date).toISOString(),version:"2.0",description:"Enterprise Project Tracking Console Configuration Export"},settings:{estimationBaseHours:estimationBaseHours,projectHoursPerDay:projectHoursPerDay,useCommonStartDate:useCommonStartDate,commonStartDate:document.getElementById("common-start-date")?.value||"",currentTicketId:currentTicketId},taskSizeDefinitions:taskSizeDefinitions,people:people,tickets:tickets};let n="";n+="SECTION,METADATA\n",n+="Key,Value\n",n+=`Export Date,${t.metadata.exportDate}\n`,n+=`Version,${t.metadata.version}\n`,n+=`Description,${t.metadata.description}\n`,n+="\n",n+="SECTION,SETTINGS\n",n+="Key,Value\n",n+=`Estimation Base Hours,${t.settings.estimationBaseHours}\n`,n+=`Project Hours Per Day,${t.settings.projectHoursPerDay}\n`,n+=`Use Common Start Date,${t.settings.useCommonStartDate}\n`,n+=`Common Start Date,${t.settings.commonStartDate}\n`,n+=`Current Ticket ID,${t.settings.currentTicketId}\n`,n+="\n",n+="SECTION,TASK_SIZES\n",n+="Size Key,Name,Days,Removable\n",Object.keys(t.taskSizeDefinitions).forEach(e=>{const a=t.taskSizeDefinitions[e];n+=`${e},"${a.name}",${a.days},${a.removable}\n`}),n+="\n",n+="SECTION,PEOPLE\n",n+="Name,Week1,Week2,Week3,Week4,Week5,Week6,Week7,Week8,Project Ready\n",t.people.forEach(e=>{const t=[...e.availability];for(;t.length<8;)t.push(25);const a=void 0===e.isProjectReady||e.isProjectReady;n+=`"${e.name}",${t.slice(0,8).join(",")},${a?"Yes":"No"}\n`}),n+="\n",n+="SECTION,STAKEHOLDERS\n",n+="Name\n",stakeholders.forEach(e=>{n+=`"${e}"\n`}),n+="\n",n+="SECTION,INITIATIVES\n",n+="Name,Creation Date,Start Date\n",initiatives.forEach(e=>{n+=`"${e.name}",${e.creationDate},${e.startDate||""}\n`}),n+="\n",n+="SECTION,TICKETS\n",n+="UUID,ID,Description,Start Date,Size,Priority,Stakeholder,Initiative,Assigned Team,Status,Task Type,Pause Comments,Start Date History,End Date History,Size History,Custom End Date,Created Date,Details Description,Details Positives,Details Negatives\n",t.tickets.filter(e=>"Closed"!==(e.status||"To Do")).forEach(e=>{const t=e.uuid||generateUUID(),a=(e.stakeholder||"General").replace(/"/g,'""'),s=(e.initiative||"General").replace(/"/g,'""'),i=e.assigned.join(";"),o=e.priority||"P3",r=e.status||"To Do",l=!1!==e.isFixedLength?"Fixed":"Flexible",d=e.pauseComments&&e.pauseComments.length>0?e.pauseComments.map(e=>`[${e.timestamp}] ${e.comment}`).join(" | "):"",c=e.startDateHistory&&e.startDateHistory.length>0?e.startDateHistory.map(e=>`${e.date}(${e.reason}@${e.timestamp})`).join(" | "):"",u=e.endDateHistory&&e.endDateHistory.length>0?e.endDateHistory.map(e=>`${e.date}(${e.reason}@${e.timestamp})`).join(" | "):"",g=e.sizeHistory&&e.sizeHistory.length>0?e.sizeHistory.map(e=>`${e.size}:${e.days}d(${e.reason}@${e.timestamp})`).join(" | "):"",m=e.customEndDate||"",p=e.createdDate||(new Date).toISOString().split("T")[0],h=e.taskDetails||{},k=(h.description||"").replace(/"/g,'""').replace(/\r\n/g,"\n"),f=(h.positives||"").replace(/"/g,'""').replace(/\r\n/g,"\n"),y=(h.negatives||"").replace(/"/g,'""').replace(/\r\n/g,"\n");n+=`"${t}",${e.id},"${e.description.replace(/"/g,'""')}",${e.startDate},${e.size},${o},"${a}","${s}","${i}","${r}","${l}","${d}","${c}","${u}","${g}","${m}","${p}","${k}","${f}","${y}"\n`});const a=new Blob([n],{type:"text/csv;charset=utf-8;"}),s=document.createElement("a"),i=URL.createObjectURL(a);s.setAttribute("href",i),s.setAttribute("download",`project_config_${e}.csv`),s.style.visibility="hidden",document.body.appendChild(s),s.click(),document.body.removeChild(s),markClean(),closedItemsExported=!1;const o=tickets.some(e=>"Closed"===(e.status||"To Do")),r=document.getElementById("export-closed-btn");r&&o&&(r.disabled=!1,r.classList.remove("opacity-50","cursor-not-allowed")),alert(`✅ Configuration exported successfully!\n\nFile: project_config_${e}.csv\n\nThis file contains all active and non-closed tasks.\n\nUse "Import Config" to restore this configuration later.`)},window.updateTaskStartDate=function(e,t){const n=tickets.find(t=>t.id===e);if(n&&t){const a=n.startDate;n.startDate=t,trackStartDateChange(n,a,t,"Changed from heat map popup"),recalculateAllInitiativeStartDates(),markDirty(),saveToLocalStorage(),immediateRender();if(!document.getElementById("week-task-modal").classList.contains("hidden")){const e=document.getElementById("modal-title").textContent,t=e.match(/^(.*) - Week (\d+)/);if(t){const n=t[1].trim(),a=parseInt(t[2],10)-1,s=e.match(/\(([^-]+) - ([^)]+)\)/);if(s){showWeekTaskDetails(n,a,s[1].trim(),s[2].trim())}}}console.log(`✅ V10: Task #${e} start date updated and synced to table: ${a} → ${t}`)}},window.updateTaskAssignment=function(e,t,n,a){const s=tickets.find(t=>t.id===e);if(!s)return void console.log("updateTaskAssignment: Ticket not found for id",e);let i=Array.isArray(s.assigned)?[...s.assigned]:[];n?i.includes(t)||i.push(t):i=i.filter(e=>e!==t),s.assigned=i,console.log("updateTaskAssignment:",{taskId:e,personName:t,isChecked:n,assigned:i}),saveToLocalStorage(),updateTable(),renderWorkloadHeatMap();if(!document.getElementById("week-task-modal").classList.contains("hidden")){const e=document.getElementById("modal-title").textContent,t=e.match(/^(.*) - Week (\d+)/);if(t){const n=t[1].trim(),a=parseInt(t[2],10)-1,s=e.match(/\(([^-]+) - ([^)]+)\)/);if(s){showWeekTaskDetails(n,a,s[1].trim(),s[2].trim())}}}console.log("Updated ticket:",s)},window.triggerImport=()=>{document.getElementById("import-config-file").click()},window.handleConfigImport=e=>{const t=e.target.files[0];if(!t)return;if(!t.name.endsWith(".csv"))return void alert("❌ Please select a CSV configuration file.");const n=new FileReader;n.onload=function(e){try{importConfiguration(e.target.result)}catch(e){alert(`❌ Error reading file: ${e.message}`)}},n.readAsText(t),e.target.value=""},window.triggerTaskImport=()=>{document.getElementById("import-tasks-file").click()},window.handleTaskImport=e=>{const t=e.target.files[0];if(!t)return;if(!t.name.endsWith(".csv"))return void alert("❌ Please select a CSV file with tasks.");const n=new FileReader;n.onload=function(e){try{importTasksFromCSV(e.target.result)}catch(e){alert(`❌ Error reading file: ${e.message}`)}},n.readAsText(t),e.target.value=""},window.resetToDefaults=()=>{confirm("This will reset all data to defaults with current dates. Are you sure?")&&(localStorage.removeItem(STORAGE_KEY),initializeDefaultData(),useCommonStartDate=!1,document.getElementById("use-common-start-date").checked=!1,calculateEffortMap(),renderEffortMap(),renderPeople(),calculateProjection(),renderStakeholdersList(),renderInitiativesList(),alert("Data reset to defaults with current dates!"))},window.toggleCommonStartDate=()=>{const e=document.getElementById("use-common-start-date"),t=document.getElementById("common-start-date"),n=document.getElementById("new-ticket-start-date"),a=document.getElementById("start-date-help");useCommonStartDate=e.checked,useCommonStartDate?(t.disabled=!1,t.classList.remove("bg-gray-100"),t.classList.add("bg-white"),t.value||(t.value=getLocalDateString(getDefaultTaskStartDate())),n.disabled=!0,n.classList.add("bg-gray-100","text-gray-400"),a.innerHTML="Common start date is enabled - all tasks will use the same start date above. <strong>Team availability weeks are recalculated from this date.</strong>"):(t.disabled=!0,t.classList.add("bg-gray-100"),t.classList.remove("bg-white"),n.disabled=!1,n.classList.remove("bg-gray-100","text-gray-400"),a.innerHTML="Individual start dates enabled. <strong>Team availability weeks are calculated from the earliest task start date.</strong>"),renderPeople(),markDirty(),calculateProjection(),saveToLocalStorage()},window.toggleP1Display=e=>{showP1Percentages=e,renderWorkloadHeatMap()},window.updateAllTaskStartDates=()=>{useCommonStartDate&&(updateAvailabilityHeader(),renderPeople(),calculateProjection(),saveToLocalStorage())},window.updateEffortMapping=e=>{updateProjectHours(e)},window.updateTicketSizeDays=(e,t)=>{const n=parseInt(t,10);isNaN(n)||n<1||(ticketDays[e]=n,markDirty(),calculateEffortMap(),renderEffortMap(),calculateProjection(),saveToLocalStorage())},window.updateTicketSizeDaysEnhanced=(e,t)=>{const n=parseFloat(t);isNaN(n)||n<.1||(ticketDays[e]=n,taskSizeDefinitions[e].days=n,markDirty(),calculateEffortMap(),renderTaskSizeCards(),calculateProjection(),saveToLocalStorage())},window.applyPreset=e=>{const t={agile:{XS:{name:"Extra Small",days:.5,removable:!0},S:{name:"Small",days:1,removable:!1},M:{name:"Medium",days:3,removable:!1},L:{name:"Large",days:5,removable:!1},XL:{name:"X-Large",days:8,removable:!1}},enterprise:{S:{name:"Small",days:2,removable:!1},M:{name:"Medium",days:5,removable:!1},L:{name:"Large",days:10,removable:!1},XL:{name:"X-Large",days:20,removable:!1},XXL:{name:"XX-Large",days:40,removable:!1}},startup:{XS:{name:"Quick Fix",days:.25,removable:!0},S:{name:"Small",days:1,removable:!1},M:{name:"Medium",days:2,removable:!1},L:{name:"Large",days:5,removable:!1},XL:{name:"Epic",days:10,removable:!1}},conservative:{S:{name:"Small",days:3,removable:!1},M:{name:"Medium",days:8,removable:!1},L:{name:"Large",days:15,removable:!1},XL:{name:"X-Large",days:25,removable:!1},XXL:{name:"XX-Large",days:40,removable:!1}}};t[e]&&confirm(`Apply ${e} preset? This will replace your current task sizes.`)&&(taskSizeDefinitions={...t[e]},syncTaskSizes(),markDirty(),calculateEffortMap(),renderTaskSizeCards(),calculateProjection(),saveToLocalStorage())},window.showCustomSizeForm=()=>{document.getElementById("custom-size-form").classList.remove("hidden")},window.hideCustomSizeForm=()=>{document.getElementById("custom-size-form").classList.add("hidden"),document.getElementById("new-size-key").value="",document.getElementById("new-size-name").value="",document.getElementById("new-size-days").value=""},window.addCustomSize=()=>{const e=document.getElementById("new-size-key").value.trim().toUpperCase(),t=document.getElementById("new-size-name").value.trim(),n=parseFloat(document.getElementById("new-size-days").value);!e||!t||isNaN(n)||n<.1?alert("Please fill all fields with valid values."):taskSizeDefinitions[e]?alert("Size key already exists. Choose a different key."):(taskSizeDefinitions[e]={name:t,days:n,removable:!0},ticketDays[e]=n,markDirty(),calculateEffortMap(),renderTaskSizeCards(),hideCustomSizeForm(),saveToLocalStorage(),alert(`✅ Added custom size: ${t} (${e}) - ${n} days`))},window.removeTaskSize=e=>{if(!taskSizeDefinitions[e]?.removable)return void alert("This task size cannot be removed.");const t=tickets.filter(t=>t.size===e);t.length>0?alert(`Cannot remove size ${e}. It's used by ${t.length} ticket(s).`):confirm(`Remove task size ${e} (${taskSizeDefinitions[e].name})?`)&&(delete taskSizeDefinitions[e],delete ticketDays[e],markDirty(),calculateEffortMap(),renderTaskSizeCards(),saveToLocalStorage())},window.addPerson=()=>{const e=document.getElementById("new-person-name"),t=e.value.trim();t&&!people.some(e=>e.name===t)?(people.push({name:t,availability:[25,25,25,25,25,25,25,25],isProjectReady:!0}),e.value="",markDirty(),renderPeople(),calculateProjection(),saveToLocalStorage()):t&&alert("Person already exists or name is invalid.")},window.removePerson=e=>{people=people.filter(t=>t.name!==e),tickets.forEach(t=>{t.assigned=t.assigned.filter(t=>t!==e)}),markDirty(),renderPeople(),calculateProjection(),saveToLocalStorage()},window.updatePersonAvailability=(e,t,n)=>{const a=Math.max(0,parseInt(n,10));if(isNaN(a))return;const s=people.find(t=>t.name===e);s&&(console.log(`🔄 AVAILABILITY UPDATE: ${e} Week ${t+1} changed from ${s.availability[t]} to ${a} hours`),s.availability[t]=a,console.log(`📊 Updated ${e} availability:`,s.availability),markDirty(),calculateProjection(),saveToLocalStorage(),console.log("✅ Recalculation triggered for availability change"))},window.updatePersonProjectReady=(e,t)=>{const n=people.find(t=>t.name===e);n&&(console.log(`🎯 PROJECT READY UPDATE: ${e} changed from ${n.isProjectReady?"Project Ready":"Not Project Ready"} to ${t?"Project Ready":"Not Project Ready"}`),n.isProjectReady=t,console.log(`📊 Updated ${e} project ready status:`,n.isProjectReady),markDirty(),calculateProjection(),saveToLocalStorage(),console.log("✅ Recalculation triggered for project ready change"))},window.addTicket=()=>{const e=document.getElementById("new-ticket-desc"),t=document.getElementById("new-ticket-start-date"),n=document.getElementById("new-ticket-size"),a=document.getElementById("new-ticket-priority"),s=document.getElementById("new-ticket-stakeholder"),i=document.getElementById("new-ticket-initiative"),o=document.getElementById("new-ticket-assigned"),r=document.getElementById("new-ticket-flexible"),l=e.value.trim();let d;if(useCommonStartDate){d=document.getElementById("common-start-date").value||getLocalDateString(getDefaultTaskStartDate())}else d=t.value||getLocalDateString(getDefaultTaskStartDate());const c=n.value,u=a.value,g=s.value,m=i.value,p=Array.from(o.querySelectorAll('input[type="checkbox"]:checked')).map(e=>e.value),h=!r.checked;if(!l)return void alert("Ticket description cannot be empty.");if(!g)return void alert("Please select a stakeholder.");if(!m)return void alert("Please select an initiative.");const k=findSimilarTasks(l);if(k.length>0){let t=`⚠️ Found ${k.length} similar task(s):\n\n`;k.slice(0,3).forEach((e,n)=>{t+=`${n+1}. "${e.ticket.description}" (${e.confidence}% match)\n`,t+=`   ID: ${e.ticket.id}, Status: ${e.ticket.status}\n\n`}),k.length>3&&(t+=`...and ${k.length-3} more.\n\n`),t+="Do you want to:\n",t+="• OK - Change the title to make it unique\n",t+="• Cancel - Add anyway (not recommended)";if(confirm(t))return e.focus(),void e.select()}if("P1"===u&&p.length>0){const e=checkP1TaskConflicts(p,d,c);if(e.hasConflicts){if(!showP1ConflictWarning(e))return}}const f=document.getElementById("new-ticket-details-description").value.trim(),y=document.getElementById("new-ticket-details-positives").value.trim(),D=document.getElementById("new-ticket-details-negatives").value.trim(),v={uuid:generateUUID(),id:getNextDisplayId(),description:l,startDate:d,size:c,priority:u,stakeholder:g,initiative:m,assigned:p,status:"To Do",pauseComments:[],isFixedLength:h};updateInitiativeStartDate(m,d),(f||y||D)&&(v.taskDetails={description:f,positives:y,negatives:D}),initializeStartDateHistory(v),tickets.push(v),e.value="",t.value="",n.value="L",a.value="P3",r.checked=!1,document.getElementById("new-ticket-details-description").value="",document.getElementById("new-ticket-details-positives").value="",document.getElementById("new-ticket-details-negatives").value="",updateNewTicketDetailsIconColor(),o.querySelectorAll('input[type="checkbox"]').forEach(e=>e.checked=!1),markDirty(),useCommonStartDate||renderPeople(),calculateProjection(),saveToLocalStorage()},window.removeTicket=e=>{tickets=tickets.filter(t=>t.id!==e),markDirty(),useCommonStartDate||renderPeople(),calculateProjection(),saveToLocalStorage()},window.openTaskDetailsModal=e=>{const t=tickets.find(t=>t.id===e);if(!t)return void alert("Task not found.");document.getElementById("details-modal-task-id").value=e;const n=t.taskDetails||{};document.getElementById("details-modal-description").value=n.description||"",document.getElementById("details-modal-positives").value=n.positives||"",document.getElementById("details-modal-negatives").value=n.negatives||"",document.getElementById("task-details-modal").classList.add("active")},window.closeTaskDetailsModal=()=>{document.getElementById("task-details-modal").classList.remove("active"),document.getElementById("details-modal-task-id").value="",document.getElementById("details-modal-description").value="",document.getElementById("details-modal-positives").value="",document.getElementById("details-modal-negatives").value=""},window.saveTaskDetails=()=>{const e=parseInt(document.getElementById("details-modal-task-id").value),t=tickets.find(t=>t.id===e);if(!t)return void alert("Task not found.");const n=document.getElementById("details-modal-description").value.trim(),a=document.getElementById("details-modal-positives").value.trim(),s=document.getElementById("details-modal-negatives").value.trim();n||a||s?t.taskDetails={description:n,positives:a,negatives:s}:delete t.taskDetails,markDirty(),saveToLocalStorage(),calculateProjection(),closeTaskDetailsModal()},window.openNewTicketDetailsModal=()=>{document.getElementById("new-ticket-details-modal").classList.add("active"),updateNewTicketDetailsIconColor()},window.closeNewTicketDetailsModal=()=>{document.getElementById("new-ticket-details-modal").classList.remove("active")},window.saveNewTicketDetails=()=>{closeNewTicketDetailsModal(),updateNewTicketDetailsIconColor()},window.updateNewTicketDetailsIconColor=()=>{const e=document.getElementById("new-ticket-details-description").value.trim(),t=document.getElementById("new-ticket-details-positives").value.trim(),n=document.getElementById("new-ticket-details-negatives").value.trim(),a=document.getElementById("new-ticket-details-icon");a.className=e||t||n?"text-blue-600 hover:text-blue-700 transition-colors":"text-gray-400 hover:text-blue-600 transition-colors"},window.updateTicketAssignment=(e,t)=>{const n=tickets.find(t=>t.id===e);n&&(n.assigned=t,markDirty(),calculateProjection(),saveToLocalStorage())},window.handleAssignmentChange=(e,t)=>{const n=Array.from(e.selectedOptions).map(e=>e.value);window.updateTicketAssignment(t,n)},window.handleAssignmentCheckboxChange=(e,t)=>{const n=e.value,a=e.checked,s=tickets.find(e=>e.id===t);if(s){if(a&&"P1"===s.priority){console.log("🔍 Checkbox P1 check triggered for:",{personName:n,ticketId:t,priority:s.priority});const a=checkP1TaskConflicts([n],s.startDate,s.size,t);if(a.hasConflicts){console.log("⚠️ P1 conflicts found, showing warning...");if(!showP1ConflictWarning(a))return void(e.checked=!1)}else console.log("✅ No P1 conflicts found")}a?s.assigned.includes(n)||s.assigned.push(n):s.assigned=s.assigned.filter(e=>e!==n),e.parentElement.style.background="#dcfce7",setTimeout(()=>{e.parentElement.style.background="transparent"},500),markDirty(),calculateProjection(),saveToLocalStorage()}},window.handleSizeChange=(e,t)=>{const n=e.value,a=tickets.find(e=>e.id===t);if(a){const s=a.size;a.size=n,a.customEndDate&&(console.log(`📅 Clearing custom end date for ticket #${t} due to manual size change: ${s} → ${n}`),delete a.customEndDate),e.style.background="#dcfce7",setTimeout(()=>{e.style.background="white"},500),markDirty(),calculateProjection(),saveToLocalStorage(),console.log(`📊 Ticket #${t} size changed from ${s} to ${n} - recalculating...`)}},window.handlePriorityChange=(e,t)=>{const n=e.value,a=tickets.find(e=>e.id===t);if(a){const s=a.priority||"P3";if("P1"===n&&a.assigned.length>0){console.log("🔍 Priority change P1 check triggered for:",{ticketId:t,assigned:a.assigned});const n=checkP1TaskConflicts(a.assigned,a.startDate,a.size,t);if(n.hasConflicts){console.log("⚠️ P1 conflicts found during priority change, showing warning...");if(!showP1ConflictWarning(n))return void(e.value=s)}else console.log("✅ No P1 conflicts found during priority change")}a.priority=n,e.style.background="#e0e7ff",setTimeout(()=>{e.style.background="white"},500),markDirty(),saveToLocalStorage(),console.log(`⭐ Ticket #${t} priority changed from ${s} to ${n}`)}},window.handleStakeholderChange=(e,t)=>{const n=e.value,a=tickets.find(e=>e.id===t);if(a){const s=a.stakeholder||"General";a.stakeholder=n,e.style.background="#ccfbf1",setTimeout(()=>{e.style.background="white"},500),markDirty(),saveToLocalStorage(),console.log(`👤 Ticket #${t} stakeholder changed from "${s}" to "${n}"`)}},window.handleInitiativeChange=(e,t)=>{const n=e.value,a=tickets.find(e=>e.id===t);if(a){const s=a.initiative||"General";a.initiative=n,e.style.background="#fed7aa",setTimeout(()=>{e.style.background="white"},500),recalculateAllInitiativeStartDates(),markDirty(),saveToLocalStorage(),console.log(`📊 Ticket #${t} initiative changed from "${s}" to "${n}"`)}},window.toggleTaskType=e=>{const t=tickets.find(t=>t.id===e);if(t){const n=!1!==t.isFixedLength;t.isFixedLength=!n;const a=t.isFixedLength?"Fixed-Length":"Flexible",s=n?"Fixed-Length":"Flexible";console.log(`🔄 Ticket #${e} task type changed from ${s} to ${a}`),console.log("🔍 Task details:",{id:t.id,description:t.description,size:t.size,assigned:t.assigned,startDate:t.startDate,isFixedLength:t.isFixedLength}),t.customEndDate&&(console.log(`📅 Clearing custom end date for ticket #${e} due to task type change`),delete t.customEndDate),markDirty(),console.log(`⚡ Triggering full recalculation for ticket #${e}`),calculateProjection(),saveToLocalStorage(),console.log(`✅ Recalculation complete for ticket #${e}`)}},window.getStatusClass=e=>({"To Do":"status-todo","In Progress":"status-in-progress",Paused:"status-paused",Done:"status-done",Closed:"status-closed"}[e]||"status-todo"),window.getStatusDisplay=e=>({"To Do":"📋 To Do","In Progress":"🚀 In Progress",Paused:"⏸️ Paused",Done:"✅ Done",Closed:"🗃️ Closed"}[e]||"📋 To Do"),window.getStatusDisplayWithComments=e=>{const t=e.status||"To Do",n=window.getStatusDisplay(t);return"Paused"===t&&e.pauseComments&&e.pauseComments.length>0?n+" 💬":n},window.getStatusTooltip=e=>{let t="Click to change status";if("Paused"===(e.status||"To Do")&&e.pauseComments&&e.pauseComments.length>0){const n=e.pauseComments[e.pauseComments.length-1];t+=`\n\nLatest pause reason:\n"${n.comment}"\n(${n.timestamp})`,e.pauseComments.length>1&&(t+=`\n\n${e.pauseComments.length} total pause comments`)}return t},window.handleStatusRightClick=(e,t)=>{e.preventDefault();const n=tickets.find(e=>e.id===t);if(n)if("Paused"===n.status){if(n.pauseComments&&0!==n.pauseComments.length){const e=n.pauseComments[n.pauseComments.length-1],a=e.comment,s=prompt(`✏️ Edit Latest Pause Comment\n\nTask: "${n.description}"\nOriginal comment: "${a}"\nAdded: ${e.timestamp}\n\nEdit your comment:`,a);if(null===s)return;e.comment=s||"(No reason specified)",e.editedAt=(new Date).toLocaleString(),console.log(`✏️ Edited pause comment for ticket ${t}: "${s}"`)}else{const e=prompt(`➕ Add Pause Comment\n\nTask: "${n.description}"\n\nPlease provide a reason for why this task is paused:`);if(null===e)return;n.pauseComments||(n.pauseComments=[]);const a=(new Date).toLocaleString();n.pauseComments.push({timestamp:a,comment:e||"(No reason specified)",previousStatus:"Unknown"}),console.log(`➕ Added pause comment to ticket ${t}: "${e}"`)}markDirty(),saveToLocalStorage(),calculateProjection(),alert("✅ Comment Updated\n\nThe pause comment has been successfully updated.\nThe changes are automatically saved.")}else alert(`💡 Edit Comments\n\nThis feature is only available for paused tasks.\n\nCurrent status: ${n.status||"To Do"}\n\nTo add pause comments, first change the task status to "Paused".`);else console.error(`Ticket ${t} not found`)},window.cycleTaskStatus=e=>{const t=["To Do","In Progress","Paused","Done","Closed"],n=tickets.findIndex(t=>t.id===e);if(n>-1){const a=tickets[n],s=a.status||"To Do",i=t.indexOf(s),o=t[(i+1)%t.length],r={"To Do":"📋","In Progress":"🚀",Paused:"⏸️",Done:"✅",Closed:"🗃️"};if("Paused"===o){const t=prompt(`⏸️ Pausing Task: "${a.description}"\n\nPlease provide a reason for pausing this task:\n(This will help track why work was stopped)`);if(null===t)return void console.log(`❌ Status change to Paused cancelled for Ticket #${e} - no comment provided`);a.pauseComments||(a.pauseComments=[]);const i=(new Date).toLocaleString();a.pauseComments.push({timestamp:i,comment:t||"(No reason specified)",previousStatus:s}),tickets[n].status=o,console.log(`⏸️ Ticket #${e} paused with comment: "${t}"`)}else{const t=`🔄 Change Task Status?\n\nTask: "${a.description}"\n\n${r[s]} Current: ${s}\n${r[o]} New: ${o}\n\nContinue with status change?`;if(!confirm(t))return void console.log(`❌ Status change cancelled for Ticket #${e}`);tickets[n].status=o,console.log(`📊 Ticket #${e} status changed from "${s}" to "${o}"`)}const l=document.querySelector(`[onclick="cycleTaskStatus(${e})"]`);l&&(l.style.transform="scale(1.1)",setTimeout(()=>{l.style.transform="scale(1)"},150)),markDirty(),saveToLocalStorage(),calculateProjection()}},window.handleStartDateChange=(e,t)=>{const n=e.value,a=tickets.find(e=>e.id===t);if(a){const s=a.startDate;a.startDate=n,trackStartDateChange(a,s,n,"Manual update via UI"),recalculateAllInitiativeStartDates(),e.style.background="#dcfce7",setTimeout(()=>{e.style.background="white"},500),markDirty(),useCommonStartDate||renderPeople(),calculateProjection(),saveToLocalStorage(),console.log(`📅 Ticket #${t} start date changed from ${formatDate(s)} to ${formatDate(n)} - recalculating...`)}},window.showCalculationDetails=e=>{const t=getProjectedTickets().find(t=>t.id===e);if(!t)return void alert("Ticket not found.");const n=!1!==t.isFixedLength,a=n?"🔒":"⚡",s=n?"Fixed-Length":"Flexible",i=t.priority||"P2",o="P1"===i?"🔴":"P2"===i?"🟡":"🟢",r="P1"===i?"Critical priority - blocking other work or on critical path":"P2"===i?"Important but has some scheduling flexibility":"Can be scheduled around higher priorities",l=taskSizeDefinitions[t.size],d=l?l.days:0,c=n?`Everyone works together for the full ${d} days`:`Team splits the work - each person works for ${Math.ceil(d/t.assigned.length)} days`,u=new Date(t.startDate),g=calculateWorkloadHeatMap(),m=getHeatMapBaselineDate(tickets),p=Math.floor((u-m)/864e5),h=Math.max(0,Math.min(7,Math.floor(p/7)));let k="";t.assigned.forEach(e=>{const n=tickets.filter(t=>t.assigned.includes(e)&&("To Do"===t.status||"In Progress"===t.status)),a=g.find(t=>t.name===e),s=a&&a.weeks[h]?a.weeks[h].utilization:0;k+=`\n${e}'s Workload (Week ${h+1} - when this task is active):\n`,k+=`• This task: ${t.description} (Priority: ${i})\n`;const o=n.filter(e=>e.id!==t.id);o.length>0?(k+="• Also working on:\n",o.forEach(e=>{k+=`  - ${e.description} (Priority: ${e.priority||"P2"})\n`})):k+="• No other active tasks\n",k+=`• Total workload: ${s}% capacity utilization\n`});const f=t.assigned.join(", "),y=t.assigned.map(e=>{const t=g.find(t=>t.name===e);return t&&t.weeks[h]?t.weeks[h].utilization:0}).reduce((e,t)=>e+t,0)/t.assigned.length;let D="";t.initiative&&"None"!==t.initiative&&"General"!==t.initiative?D=t.stakeholder&&"None"!==t.stakeholder&&"General"!==t.stakeholder?` This task is under the ${t.initiative} initiative for ${t.stakeholder}.`:` This task is under the ${t.initiative} initiative.`:t.stakeholder&&"None"!==t.stakeholder&&"General"!==t.stakeholder&&(D=` This task is for ${t.stakeholder}.`);const v=1===t.assigned.length?`${f} is working on "${t.description}" (Priority ${i}, ${d} days). They're at ${Math.round(y)}% capacity in Week ${h+1}. Expected completion: ${t.endDate}.${D}`:`${f} are working on "${t.description}" (Priority ${i}, ${d} days). Team is at ${Math.round(y)}% average capacity in Week ${h+1}. Expected completion: ${t.endDate}.${D}`,b=`\n🎯 Task Overview: ${t.description}\n\nHi! Let me explain this task to you in plain terms.\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n\n📌 WHAT IS THIS TASK?\n${t.description}\n\nPriority: ${o} ${i}\n${r}\n\nSize: ${t.size} (${d} business days)\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n\n� WHO'S WORKING ON IT?\nAssigned to: ${f}\n${k}\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n\n⏱️ WHY DOES IT TAKE ${d} DAYS?\n• Task size: ${t.size} = ${d} business days of work\n• Team size: ${t.assigned.length} ${1===t.assigned.length?"person":"people"} working on this\n• Task type: ${a} ${s}\n  → ${c}\n\nExpected completion: ${t.endDate}\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n\n🎯 PRIORITY & IMPACT\n${r}\n\nThis ${i} task ${"P1"===i?"needs immediate attention and may block other work":"P2"===i?"is important for the project timeline":"can be flexibly scheduled"}.\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n\n📋 QUICK SUMMARY (copy-paste ready)\n${v}\n            `.trim();document.getElementById("modal-title").textContent=`📊 Task Details - ${t.description}`;const x=document.getElementById("calculation-content");x.textContent=b;let $=document.getElementById("copy-details-btn");$||($=document.createElement("button"),$.id="copy-details-btn",$.className="btn-enterprise mt-4",$.innerHTML="📋 Copy Quick Summary",$.onclick=()=>{navigator.clipboard.writeText(v).then(()=>{$.innerHTML="✅ Copied!",setTimeout(()=>{$.innerHTML="📋 Copy Quick Summary"},2e3)})},x.parentElement.appendChild($));const S=document.getElementById("calculation-modal");S.classList.add("active"),S.addEventListener("click",e=>{e.target===S&&closeCalculationModal()})},window.closeCalculationModal=()=>{document.getElementById("calculation-modal").classList.remove("active")},document.addEventListener("keydown",e=>{"Escape"===e.key&&(closeCalculationModal(),closeOverdueTasksModal())});let overdueTasksToHandle=[],handledTaskIds=new Set;function renderOverdueTasksList(){const e=document.getElementById("overdue-tasks-list"),t=overdueTasksToHandle.filter(e=>!handledTaskIds.has(e.id));if(0===t.length)return void closeOverdueTasksModal();let n='<ul style="list-style: none; padding: 0; margin: 0;">';t.forEach(e=>{const t=Math.floor((new Date-new Date(e.startDate))/864e5);n+=`\n                    <li id="task-item-${e.id}" style="padding: 10px; margin-bottom: 8px; border-left: 3px solid var(--primary-color); background: var(--card-background); border-radius: 4px;">\n                        <div style="display: flex; justify-content: space-between; align-items: flex-start; gap: 10px;">\n                            <div style="flex: 1;">\n                                <div style="font-weight: 600; color: var(--text-color); margin-bottom: 4px;">${e.description}</div>\n                                <div style="font-size: 12px; color: var(--text-secondary);">\n                                    Start Date: ${e.startDate} (${t} day${1!==t?"s":""} overdue)\n                                </div>\n                            </div>\n                            <div style="display: flex; gap: 6px; flex-shrink: 0;">\n                                <button onclick="handleIndividualTask(${e.id}, 'move')"\n                                    style="padding: 4px 8px; font-size: 11px; background: var(--primary-color); color: white; border: none; border-radius: 4px; cursor: pointer; white-space: nowrap;"\n                                    title="Move to Today">\n                                    📅 Today\n                                </button>\n                                <button onclick="handleIndividualTask(${e.id}, 'progress')"\n                                    style="padding: 4px 8px; font-size: 11px; background: var(--primary-color); color: white; border: none; border-radius: 4px; cursor: pointer; white-space: nowrap;"\n                                    title="Change to In Progress">\n                                    ▶️ Progress\n                                </button>\n                            </div>\n                        </div>\n                    </li>\n                `}),n+="</ul>",e.innerHTML=n}function initializeDefaultData(){console.log("Setting up default people data."),people=[{name:"Vipul",availability:[25,25,25,25,25,25,25,25],isProjectReady:!0},{name:"Sameet",availability:[25,25,25,25,25,25,25,25],isProjectReady:!0},{name:"Peter",availability:[25,25,25,25,25,25,25,25],isProjectReady:!0},{name:"Sharanya",availability:[25,25,25,25,25,25,25,25],isProjectReady:!0},{name:"Divya",availability:[25,25,25,25,25,25,25,25],isProjectReady:!0}],stakeholders=["General"],initiatives=[{name:"General",creationDate:getLocalDateString(new Date),startDate:null}];new Date;const e=getNextMonday(new Date);tickets=[{id:1,description:"Sample Task - Delete Me",size:"M",priority:"P3",status:"To Do",assigned:["Vipul"],startDate:getLocalDateString(e)}],tickets=tickets.map(e=>e=initializeSizeHistory(e=initializeEndDateHistory(e=initializeStartDateHistory(e)))),currentTicketId=2,saveToLocalStorage()}function checkOverdueTasks(){console.log("🔍 Checking for overdue tasks...");const e=new Date;e.setHours(0,0,0,0);const t=getLocalDateString(e);console.log(`📅 Today's date: ${t}`),console.log(`📋 Total tickets: ${tickets.length}`);const n=tickets.filter(t=>{const n=t.status||"To Do";if(console.log(`🎫 Ticket #${t.id}: "${t.description}" - Status: "${n}", Start: ${t.startDate}`),"To Do"!==n)return console.log('  ⏭️ Skipping - not "To Do" status'),!1;const a=new Date(t.startDate);a.setHours(0,0,0,0);const s=a<e;return console.log(`  📅 Start date: ${getLocalDateString(a)}, Overdue: ${s}`),s});console.log(`⚠️ Found ${n.length} overdue tasks`),0!==n.length?openOverdueTasksModal(n):console.log("✅ No overdue tasks found")}function initializeScheduler(){loadFromLocalStorage()||initializeDefaultData();const e=Object.keys(taskSizeDefinitions).length;Object.keys(taskSizeDefinitions).forEach(e=>{e&&""!==e.trim()||(console.warn("🧹 Removing invalid task size key from taskSizeDefinitions:",`"${e}"`),delete taskSizeDefinitions[e])});const t=Object.keys(taskSizeDefinitions).length;e!==t&&(console.log(`✅ Cleaned ${e-t} empty keys from taskSizeDefinitions`),saveToLocalStorage());let n=!1;tickets.forEach(e=>{e.priority||(e.priority="P3",n=!0),e.status||(e.status="To Do",n=!0)}),n&&(saveToLocalStorage(),console.log("📊 Migrated existing tasks to include priority and status fields"));const a=getLocalDateString(getDefaultTaskStartDate());document.getElementById("new-ticket-start-date").value=a,document.getElementById("common-start-date").value=a;document.getElementById("use-common-start-date").checked=useCommonStartDate,useCommonStartDate&&toggleCommonStartDate(),calculateEffortMap(),renderEffortMap(),renderPeople(),calculateProjection(),updateTicketSizeDropdown(),updateExportButtonsState(),updateFilterUI(),document.getElementById("estimation-base-hours").value=estimationBaseHours,document.getElementById("project-hours-per-day").value=projectHoursPerDay,document.getElementById("estimation-base-display").textContent=estimationBaseHours,checkOverdueTasks()}window.openOverdueTasksModal=e=>{overdueTasksToHandle=e,handledTaskIds.clear();const t=document.getElementById("overdue-tasks-modal");document.getElementById("overdue-tasks-list");renderOverdueTasksList(),t.classList.add("active"),t.addEventListener("click",e=>{e.target===t&&closeOverdueTasksModal()})},window.closeOverdueTasksModal=()=>{document.getElementById("overdue-tasks-modal").classList.remove("active"),overdueTasksToHandle=[],handledTaskIds.clear()},window.handleIndividualTask=(e,t)=>{const n=overdueTasksToHandle.find(t=>t.id===e);if(!n)return;const a=new Date;a.setHours(0,0,0,0);const s=getLocalDateString(a);if("move"===t){const e=n.startDate;n.startDate=s,trackStartDateChange(n,e,s,"Overdue task correction"),console.log(`📅 Moved task #${n.id} "${n.description}" to today`)}else"progress"===t&&(setTaskStatusDirect(n.id,"In Progress"),console.log(`🚀 Changed task #${n.id} "${n.description}" to In Progress`));handledTaskIds.add(e),markDirty(),saveToLocalStorage(),calculateProjection(),renderOverdueTasksList()},window.handleOverdueTasksAction=e=>{if("skip"===e)return console.log("⏭️ User skipped overdue task resolution"),void closeOverdueTasksModal();const t=new Date;t.setHours(0,0,0,0);const n=getLocalDateString(t);let a=0;const s=overdueTasksToHandle.filter(e=>!handledTaskIds.has(e.id));if(0===s.length)return console.log("✅ All tasks already handled individually"),void closeOverdueTasksModal();"move"===e?(s.forEach(e=>{const t=e.startDate;e.startDate=n,trackStartDateChange(e,t,n,"Overdue task correction"),a++}),console.log(`📅 Updated ${a} remaining overdue tasks to start today (${n})`),alert(`📅 Success!\n\nUpdated ${a} task(s) to start today.\nStart dates have been moved to ${formatDate(n)}.`)):"progress"===e&&(s.forEach(e=>{setTaskStatusDirect(e.id,"In Progress")&&a++}),console.log(`🚀 Changed ${a} remaining overdue tasks to "In Progress" status`),alert(`🚀 Success!\n\nChanged ${a} task(s) to "In Progress" status.\nThese tasks are now marked as actively being worked on.`)),markDirty(),saveToLocalStorage(),calculateProjection(),closeOverdueTasksModal()};let heatMapStartDate=null,showP1Percentages=!0;function calculateWorkloadHeatMap(){const e=getProjectedTickets().filter(e=>"Done"!==e.status&&"Paused"!==e.status&&"Closed"!==e.status);if(0===e.length||0===people.length)return[];const t=getHeatMapBaselineDate(e);heatMapStartDate=new Date(t),console.log("🔄 ===== CAPACITY ALLOCATION WITH P1 PRIORITY ====="),console.log("� CODE VERSION: 2025-10-19-v2 (with null safety checks)"),console.log("�📅 Heat Map Start Date:",t.toISOString().split("T")[0]),console.log("🎫 Active Tickets:",e.length),console.log("👥 People:",people.length);const n={},a={};people.forEach(e=>{n[e.name]={};for(let t=0;t<8;t++)n[e.name][t]={used:0,allocations:{},p1Hours:0,otherHours:0}});const s={};e.forEach(e=>{a[e.id]={};const t=taskSizeDefinitions[e.size]?.days||1,n=effortMap[e.size]||t*estimationBaseHours,i=!1!==e.isFixedLength;s[e.id]={isFixedLength:i,totalDays:t,dailyHoursPerPerson:i?n/(t*Math.max(e.assigned.length,1)):null},e.assigned.forEach(t=>{a[e.id][t]=i?n/Math.max(e.assigned.length,1):n;const o=a[e.id][t]||0,r=s[e.id].dailyHoursPerPerson,l=null!=r?` (${r.toFixed(1)}h/day max)`:"";console.log(`📊 Task ${e.id} (${e.priority}${i?" 🔒Fixed":" ⚡Flex"}): ${t} has ${o.toFixed(1)}h effort${i?l:""}`)})});const i=[...e].sort((e,t)=>new Date(e.startDate)-new Date(t.startDate));console.log("📅 Processing tickets chronologically:"),i.forEach(e=>console.log(`  - Task ${e.id} (${e.priority}): ${e.description}, Start: ${e.startDate}`));for(let e=0;e<8;e++){const{weekStart:o,weekEnd:r}=calculateWeekDateRange(t,e,!0);console.log(`\n📆 === WEEK ${e+1} (${formatDate(o)} - ${formatDate(r)}) ===`),people.forEach(t=>{const l=t.availability[e]||5*projectHoursPerDay;console.log(`\n👤 ${t.name}: ${l}h capacity`);const d=i.filter(e=>{if(!e.assigned.includes(t.name))return!1;if(a[e.id][t.name]<=0)return!1;return getNextBusinessDay(new Date(e.startDate))<=r});if(0===d.length)return void console.log("  ✓ No active tasks this week");const c=d.filter(e=>s[e.id].isFixedLength),u=d.filter(e=>!s[e.id].isFixedLength);console.log(`  📌 Fixed-Length Tasks: ${c.length}, Flexible Tasks: ${u.length}`),c.forEach(i=>{const l=a[i.id][t.name]||0,d=s[i.id]?.dailyHoursPerPerson||0,c=getNextBusinessDay(new Date(i.startDate)),u=calculateTaskEndDate(c,s[i.id].totalDays,!0,i.assigned.length),g=u<r?u:r;let m=0;const p=new Date(c>o?c:o);for(;p<=g;){const e=p.getDay();0!==e&&6!==e&&m++,p.setDate(p.getDate()+1)}const h=Math.min(l,d*m);n[t.name][e].allocations[i.id]=h,n[t.name][e].used+=h,"P1"===i.priority?n[t.name][e].p1Hours+=h:n[t.name][e].otherHours+=h,a[i.id][t.name]-=h,console.log(`    📌 FIXED ${i.priority} Task ${i.id}: Allocated ${h.toFixed(1)}h (${d.toFixed(1)}h/day × ${m} business days), Remaining: ${a[i.id][t.name].toFixed(1)}h`)});const g=n[t.name][e].used,m=Math.max(0,l-g);if(console.log(`  🔄 After Fixed tasks: Used ${g.toFixed(1)}h, Remaining: ${m.toFixed(1)}h`),u.length>0&&m>0){const s=u.filter(e=>"P1"===e.priority),i=u.filter(e=>"P1"!==e.priority);console.log(`  🎯 Flexible P1: ${s.length}, Flexible Other: ${i.length}`);let o=0,r=0;s.length>0?(o=.8*m,r=.2*m,console.log(`  📊 Flexible P1 Capacity: ${o.toFixed(1)}h (80%), Other: ${r.toFixed(1)}h (20%)`)):(r=m,console.log(`  📊 Flexible Other Capacity: ${r.toFixed(1)}h (100% - no P1 tasks)`));const l=s.length>0?o/s.length:0;s.forEach(s=>{const i=a[s.id]?.[t.name]||0,o=Math.min(i,l);n[t.name][e].allocations[s.id]=o,n[t.name][e].used+=o,n[t.name][e].p1Hours+=o,a[s.id][t.name]-=o,console.log(`    ✅ Flexible P1 Task ${s.id}: Allocated ${o.toFixed(1)}h, Remaining: ${(a[s.id]?.[t.name]||0).toFixed(1)}h`)});const d=i.reduce((e,n)=>e+(a[n.id]?.[t.name]||0),0);i.forEach(s=>{const i=a[s.id]?.[t.name]||0,o=d>0?i/d:0,l=Math.min(i,r*o);n[t.name][e].allocations[s.id]=l,n[t.name][e].used+=l,n[t.name][e].otherHours+=l,a[s.id][t.name]-=l,console.log(`    ✅ Flexible ${s.priority} Task ${s.id}: Allocated ${l.toFixed(1)}h, Remaining: ${(a[s.id]?.[t.name]||0).toFixed(1)}h`)})}const p=n[t.name][e].used,h=Math.round(p/l*100);p>l?console.log(`  ⚠️ OVER CAPACITY: ${p.toFixed(1)}h / ${l}h (${h}%) - Fixed-Length tasks exceed capacity!`):console.log(`  📈 Total Used: ${p.toFixed(1)}h / ${l}h (${h}%)`)})}const o=[];return people.forEach(e=>{const a={name:e.name,weeks:[]};for(let s=0;s<8;s++){const i=new Date(t);i.setDate(t.getDate()+7*s);const o=new Date(i);o.setDate(i.getDate()+6);const r=e.availability[s]||5*projectHoursPerDay,l=n[e.name][s].used;let d=0;r>0?d=Math.round(l/r*100):l>0&&(d=999);let c="bg-green-100 border-green-300 text-green-800";999===d||d>90?c="bg-red-100 border-red-300 text-red-800":d>60&&(c="bg-yellow-100 border-yellow-300 text-yellow-800"),a.weeks.push({weekIndex:s+1,weekStart:formatDate(i),weekEnd:formatDate(o),availability:r,assignedHours:Math.round(10*l)/10,utilization:d,colorClass:c,taskBreakdown:n[e.name][s].allocations,p1Hours:Math.round(10*n[e.name][s].p1Hours)/10,otherHours:Math.round(10*n[e.name][s].otherHours)/10})}o.push(a)}),console.log("✅ Heat map calculation complete\n"),o}function calculateBusinessDays(e,t){let n=0;const a=new Date(e);for(;a<=t;){const e=a.getDay();e>=1&&e<=5&&n++,a.setDate(a.getDate()+1)}return n}function addBusinessDays(e,t){const n=new Date(e);let a=0;for(;a<t;){n.setDate(n.getDate()+1);const e=n.getDay();e>=1&&e<=5&&a++}return n}function getNextBusinessDay(e){const t=new Date(e),n=t.getDay();return 0===n?t.setDate(t.getDate()+1):6===n&&t.setDate(t.getDate()+2),t}function getPreviousMonday(e){const t=new Date(e);for(;1!==t.getDay();)t.setDate(t.getDate()-1);return t}function getHeatMapBaselineDate(e){if(!e||0===e.length)return getPreviousMonday(new Date);let t=null;return e.forEach(e=>{const n=getNextBusinessDay(new Date(e.startDate));(!t||n<t)&&(t=new Date(n))}),getPreviousMonday(t||new Date)}function calculateWeekDateRange(e,t,n=!0){const a=new Date(e);a.setDate(e.getDate()+7*t);const s=new Date(a),i=n?6:4;return s.setDate(a.getDate()+i),{weekStart:a,weekEnd:s}}function calculateTaskEndDate(e,t,n=!0,a=1){let s,i=new Date(e);if(i=getNextBusinessDay(i),n)s=Math.ceil(t);else{const e=t/Math.max(a,1);s=Math.ceil(e)}return addBusinessDays(new Date(i),s-1)}function renderWorkloadHeatMap(){const e=calculateWorkloadHeatMap(),t=document.getElementById("workload-heatmap");if(0===e.length)return void(t.innerHTML='<p class="text-center py-4 text-gray-500">No team members defined. Add team members to see workload heat map.</p>');let n='<table class="w-full border-collapse">';n+='<thead><tr class="bg-gray-50">',n+='<th class="border border-gray-300 px-3 py-2 text-left font-semibold">Team Member</th>';for(let e=1;e<=8;e++){const t=getWeekDateRange(e-1);n+=`<th class="border border-gray-300 px-2 py-2 text-center font-semibold text-sm">\n                    <div>Week ${e}</div>\n                    <div class="text-xs text-gray-600 font-normal">${t}</div>\n                </th>`}n+="</tr></thead>",n+="<tbody>",e.forEach(e=>{n+="<tr>",n+=`<td class="border border-gray-300 px-3 py-2 font-medium">${e.name}</td>`,e.weeks.forEach((t,a)=>{let s=`Week ${t.weekIndex} (${t.weekStart} - ${t.weekEnd})\\nAvailable: ${t.availability}h\\nAssigned: ${t.assignedHours}h`;(t.p1Hours>0||t.otherHours>0)&&(s+=`\\n\\n🎯 P1 Tasks: ${t.p1Hours}h`,s+=`\\n📋 Other Tasks: ${t.otherHours}h`),s+="\\nUtilization: "+(999===t.utilization?"Overloaded":t.utilization+"%");const i=999===t.utilization?"OVR":`${t.utilization}%`;let o="";if(showP1Percentages&&t.p1Hours>0){o=`<div class="text-xs mt-1 text-red-600 font-bold">P1: ${t.assignedHours>0?Math.round(t.p1Hours/t.assignedHours*100):0}%</div>`}n+=`<td class="border border-gray-300 p-1">\n                        <div class="${t.colorClass} rounded px-2 py-1 text-center text-sm font-medium cursor-pointer hover:opacity-80 transition-opacity"\n                             title="${s}"\n                             onclick="showWeekTaskDetails('${e.name}', ${a}, '${t.weekStart}', '${t.weekEnd}')">\n                            ${i}\n                            ${o}\n                        </div>\n                    </td>`}),n+="</tr>"}),n+="</tbody></table>",t.innerHTML=n}function generateTaskCalendar(e,t){if(0===e.length)return"";const n=new Date(Math.min(...e.map(e=>e.taskStartDate.getTime()))),a=new Date(Math.max(...e.map(e=>e.taskEndDate?e.taskEndDate.getTime():e.taskStartDate.getTime()))),s=new Date(n.getFullYear(),n.getMonth(),1),i=new Date(a.getFullYear(),a.getMonth()+1,0);let o='\n                <div class="mt-6 border-t pt-4">\n                    <h5 class="font-semibold text-gray-800 mb-3">📅 Task Timeline Calendar</h5>\n                    <div class="bg-white border border-gray-200 rounded-lg p-3">\n            ';const r=["bg-blue-200 border-blue-400 text-blue-900","bg-green-200 border-green-400 text-green-900","bg-purple-200 border-purple-400 text-purple-900","bg-orange-200 border-orange-400 text-orange-900","bg-pink-200 border-pink-400 text-pink-900"];let l=s.getMonth(),d=new Date(s);for(;d<=i;){d.getMonth()!==l&&(l=d.getMonth());const t=d.toLocaleDateString("en-US",{month:"long",year:"numeric"});o+=`<div class="text-center font-semibold text-gray-700 mb-2">${t}</div>`,o+='\n                    <div class="grid grid-cols-7 gap-1 mb-2 text-xs text-gray-600 text-center">\n                        <div>Sun</div><div>Mon</div><div>Tue</div><div>Wed</div><div>Thu</div><div>Fri</div><div>Sat</div>\n                    </div>\n                ';const n=new Date(d.getFullYear(),d.getMonth(),1).getDay(),a=new Date(d.getFullYear(),d.getMonth()+1,0).getDate();o+='<div class="grid grid-cols-7 gap-1">';for(let e=0;e<n;e++)o+='<div class="h-8"></div>';for(let t=1;t<=a;t++){const n=new Date(d.getFullYear(),d.getMonth(),t),a=(getLocalDateString(n),n.getDay()),s=e.filter(e=>{const t=e.taskStartDate,s=e.taskEndDate||e.taskStartDate,i=new Date(n.getFullYear(),n.getMonth(),n.getDate()),o=new Date(t.getFullYear(),t.getMonth(),t.getDate()),r=new Date(s.getFullYear(),s.getMonth(),s.getDate());return i>=o&&i<=r&&a>=1&&a<=5});let i="h-8 flex items-center justify-center text-xs border border-gray-200",l=t,c="";if(0!==a&&6!==a||(i+=" bg-gray-100 text-gray-400"),s.length>0){const t=s[0],n=e.findIndex(e=>e.id===t.id);i+=` ${r[n%r.length]} font-medium`;c=`title="${s.map(e=>`${e.title||`Task ${e.id}`} (${e.size})`).join(", ")}"`,s.length>1&&(l+=`<span class="ml-1 text-xs">+${s.length-1}</span>`)}else i+=" hover:bg-gray-50";o+=`<div class="${i}" ${c}>${l}</div>`}o+="</div>",d=new Date(d.getFullYear(),d.getMonth()+1,1)}return e.length>0&&(o+='\n                    <div class="mt-3 pt-3 border-t border-gray-200">\n                        <div class="text-xs text-gray-600 mb-2">Legend:</div>\n                        <div class="grid grid-cols-1 gap-1 text-xs">\n                ',e.forEach((e,t)=>{o+=`\n                        <div class="flex items-center gap-2">\n                            <div class="w-4 h-3 ${r[t%r.length]} border rounded"></div>\n                            <span>${e.title||`Task ${e.id}`} (${e.size})</span>\n                        </div>\n                    `}),o+="\n                        </div>\n                    </div>\n                "),o+="</div></div>",o}function showWeekTaskDetails(e,t,n,a){const s=document.getElementById("week-task-modal"),i=document.getElementById("modal-title"),o=document.getElementById("modal-content");i.textContent=`${e} - Week ${t+1} (${n} - ${a})`;const r=getProjectedTickets(),l=getHeatMapBaselineDate(r.filter(e=>"Done"!==e.status&&"Paused"!==e.status)),{weekStart:d,weekEnd:c}=calculateWeekDateRange(l,t,!0),u=[];r.forEach(t=>{if(Array.isArray(t.assigned)&&t.assigned.includes(e)){const e=t.rawEndDate||new Date(t.endDate),n=getNextBusinessDay(new Date(t.startDate));n<=c&&e>=d&&u.push({...t,taskStartDate:n,taskEndDate:e,originalStartDate:new Date(t.startDate)})}});let g="";if(0===u.length)g='<p class="text-gray-500 text-center py-4">No tasks assigned for this week.</p>';else{g='<div class="space-y-3">';const e=calculateWorkloadHeatMap();u.forEach(n=>{n.taskStartDate.toLocaleDateString("en-US",{month:"short",day:"numeric"});const a=n.endDate||"N/A";g+=`<div class="border border-gray-200 rounded-lg p-4 bg-gray-50">\n                        <div class="flex justify-between items-start mb-2">\n                            <h4 class="font-semibold text-lg">${n.title||`Task ${n.id}`}</h4>\n                            <span class="text-sm font-medium px-2 py-1 bg-blue-100 text-blue-800 rounded">${n.size}</span>\n                        </div>\n                        <p class="text-gray-700 mb-2">${n.description}</p>\n                        <div class="text-sm text-gray-600 mb-2">\n                            <label><strong>Start Date:</strong><input type="date" value="${n.originalStartDate.toISOString().split("T")[0]}" onchange="updateTaskStartDate(${n.id}, this.value)" class="border rounded p-1 text-xs ml-2" /></label>\n                            <div><strong>End Date:</strong> ${a}</div>\n                            <div><strong>Priority:</strong> ${n.priority}</div>\n                            <div class="mt-2">\n                                <label class="flex items-center space-x-2">\n                                    <input type="checkbox"\n                                           ${!1===n.isFixedLength?"checked":""}\n                                           onchange="toggleTaskTypeInModal(${n.id}, this.checked, ${t})"\n                                           class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500">\n                                    <span class="font-medium">\n                                        ${!1===n.isFixedLength?"⚡ Flexible Task":"🔒 Fixed-Length Task"}\n                                        <span class="text-xs text-gray-500 ml-1">(check for Flexible)</span>\n                                    </span>\n                                </label>\n                            </div>\n                        </div>\n                        <div class="mb-2"><strong>Assigned:</strong></div>\n                        <div class="flex flex-wrap gap-2 mb-2">`,people.forEach(a=>{const s=e.find(e=>e.name===a.name),i=s?s.weeks[t]?.utilization:0,o=a.name.trim().replace(/^"|"$/g,"").toLowerCase(),r=n.assigned.map(e=>e.trim().toLowerCase()).includes(o),l=a.name.replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(/"/g,"&quot;");g+=`<label class="flex items-center space-x-1 text-xs whitespace-nowrap">\n                            <input type="checkbox" value="${l}" ${r?"checked":""}\n                                onchange="updateTaskAssignment(${n.id}, '${l}', this.checked, ${t})"\n                                class="w-3 h-3 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500">\n                            <span class="text-gray-700 cursor-pointer hover:text-blue-600" title="${999===i?"Overloaded":i+"% allocated"}">\n                                📅 ${a.name} (${999===i?"OVR":i+"%"})\n                            </span>\n                        </label>`}),g+="</div></div>"}),g+="</div>";const{weekStart:n}=calculateWeekDateRange(l,t,!0);g+=generateTaskCalendar(u,n)}o.innerHTML=g,s.classList.remove("hidden")}function closeWeekTaskModal(){document.getElementById("week-task-modal").classList.add("hidden")}function toggleTaskTypeInModal(e,t,n){const a=tickets.find(t=>t.id===e);if(!a)return;a.isFixedLength=!t,markDirty(),saveToLocalStorage(),calculateProjection();const s=a.assigned[0];if(s){const e=calculateWorkloadHeatMap().find(e=>e.name===s);if(e&&e.weeks[n]){const t=e.weeks[n];showWeekTaskDetails(s,n,t.weekStart,t.weekEnd)}}}function exportTaskMapCSV(){const e=getProjectedTickets(),t=getEffectiveStartDate(),n=[];new Date(t);for(let e=0;e<8;e++)for(let a=0;a<7;a++){const s=new Date(t);s.setDate(s.getDate()+7*e+a);const i=s.getDay();i>=1&&i<=5&&n.push(new Date(s))}const a=["Employee"];n.forEach(e=>{const t=e.toLocaleDateString("en-US",{month:"short",day:"numeric"});a.push(t)});const s=[a],i=[];e.forEach(e=>{e.assigned.forEach(t=>{i.push({person:t,task:e,taskName:e.description||e.title||`Task ${e.id}`})})});const o={};i.forEach(e=>{o[e.person]||(o[e.person]=[]),o[e.person].push(e)}),people.forEach(e=>{const a=o[e.name]||[];if(0===a.length){const t=[e.name];n.forEach(e=>{const n=e.getDay();0===n||6===n?t.push("Weekend"):t.push("")}),s.push(t)}else a.forEach((a,i)=>{const o=[e.name],r=a.task,l=new Date(r.startDate||t),d=r.rawEndDate?new Date(r.rawEndDate):null;n.forEach(e=>{let t="";if(d?e>=l&&e<=d&&(t=a.taskName):e.toDateString()===l.toDateString()&&(t=a.taskName),!t){const n=e.getDay();0!==n&&6!==n||(t="Weekend")}o.push(t)}),s.push(o)})});const r=s.map(e=>e.map(e=>{const t=String(e||"");return t.includes(",")||t.includes('"')||t.includes("\n")?`"${t.replace(/"/g,'""')}"`:t}).join(",")).join("\n"),l=new Blob([r],{type:"text/csv;charset=utf-8;"}),d=document.createElement("a");if(void 0!==d.download){const e=URL.createObjectURL(l);d.setAttribute("href",e);const t=getLocalDateString(new Date);d.setAttribute("download",`task-map-${t}.csv`),d.style.visibility="hidden",document.body.appendChild(d),d.click(),document.body.removeChild(d),alert("Task map CSV exported successfully!")}else alert("CSV export not supported in this browser")}function generateDelayAnalysisGeneric(e){console.log(`⏰ Generating ${e} delay analysis...`),tickets.forEach(e=>{initializeStartDateHistory(e),initializeEndDateHistory(e),initializeSizeHistory(e)});const t=getDelayAnalysisConfig(e),n=tickets;let a;a="comprehensive"===e?extractComprehensiveData(n,t):extractStandardDelayData(n,t),document.getElementById("delayAnalysisModal").classList.remove("hidden"),renderDelayAnalysisGeneric(a,t)}function getDelayAnalysisConfig(e){return{start:{type:"start",title:"📊 Delay Analysis Summary",historyField:"startDateHistory",dateField:"date",bgColor:"blue",labels:{metric:"delays",action:"delayed",problematic:"High Delay Risk"},isProblematic:(e,t)=>e>=2||t>=7},end:{type:"end",title:"📊 End Date Delay Analysis Summary",historyField:"endDateHistory",dateField:"endDate",bgColor:"orange",labels:{metric:"extensions",action:"extended",problematic:"Significant End Date Delays"},isProblematic:(e,t)=>e>=2||t>=7,checkCustomEndDate:!0},comprehensive:{type:"comprehensive",title:"🔍 Comprehensive Delay Analysis",bgColor:"purple",labels:{highRisk:"High Risk Tasks",mediumRisk:"Medium Risk Tasks",lowRisk:"Low Risk Tasks"},isHighRisk:(e,t)=>e>=3||t>=10,isMediumRisk:(e,t)=>e>=2||t>=5}}[e]}function extractStandardDelayData(e,t){return e.map(e=>{const n=e[t.historyField]||[],a=Math.max(0,n.length-1),s=calculateDelayDays(n,t.dateField),i={ticket:e,delayCount:a,totalDelayDays:s,history:n,isProblematic:t.isProblematic(a,s)};if(t.checkCustomEndDate&&e.customEndDate&&0===a){const t=getProjectedTickets().find(t=>t.id===e.id);if(t&&t.rawEndDate){const n=new Date(t.rawEndDate),a=new Date(e.customEndDate),s=Math.floor((a-n)/864e5);s>0&&(i.delayCount=1,i.totalDelayDays=s,i.hasCustomEndDate=!0)}}else t.checkCustomEndDate&&(i.hasCustomEndDate=!!e.customEndDate);return i}).sort((e,t)=>e.isProblematic!==t.isProblematic?e.isProblematic?-1:1:t.delayCount-e.delayCount)}function extractComprehensiveData(e,t){return e.map(e=>{const n=e.startDateHistory||[],a=e.endDateHistory||[],s=e.sizeHistory||[],i=Math.max(0,n.length-1),o=Math.max(0,a.length-1),r=Math.max(0,s.length-1),l=calculateDelayDays(n,"date"),d=calculateDelayDays(a,"endDate"),c=i+o+r,u=l+d;return{ticket:e,startDelayCount:i,endDelayCount:o,sizeChangeCount:r,startDelayDays:l,endDelayDays:d,totalIssues:c,totalDelayDays:u,startHistory:n,endHistory:a,sizeHistory:s,isHighRisk:t.isHighRisk(c,u),isMediumRisk:t.isMediumRisk(c,u)}}).sort((e,t)=>e.isHighRisk!==t.isHighRisk?e.isHighRisk?-1:1:e.isMediumRisk!==t.isMediumRisk?e.isMediumRisk?-1:1:t.totalIssues-e.totalIssues)}function calculateDelayDays(e,t){if(e.length<=1)return 0;const n=new Date(e[0][t]),a=new Date(e[e.length-1][t]);return Math.max(0,Math.floor((a-n)/864e5))}function renderDelayAnalysisGeneric(e,t){const n=document.getElementById("delayAnalysisContent");"comprehensive"===t.type?n.innerHTML=renderComprehensiveAnalysis(e,t):n.innerHTML=renderStandardAnalysis(e,t)}function renderStandardAnalysis(e,t){const n=e.filter(e=>e.isProblematic),a=e.filter(e=>!e.isProblematic),s=e.reduce((e,t)=>e+t.delayCount,0);return`\n                <div class="space-y-6">\n                    <div class="bg-${t.bgColor}-50 border border-${t.bgColor}-200 rounded-lg p-4">\n                        <h3 class="text-lg font-semibold text-${t.bgColor}-800 mb-2">${t.title}</h3>\n                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 text-sm">\n                            <div class="bg-white rounded p-3 text-center">\n                                <div class="text-2xl font-bold text-gray-800">${e.length}</div>\n                                <div class="text-gray-600">Total Tasks</div>\n                            </div>\n                            <div class="bg-white rounded p-3 text-center">\n                                <div class="text-2xl font-bold text-red-600">${n.length}</div>\n                                <div class="text-gray-600">${"end"===t.type?"Delayed":"Problematic"} Tasks</div>\n                            </div>\n                            <div class="bg-white rounded p-3 text-center">\n                                <div class="text-2xl font-bold text-green-600">${a.length}</div>\n                                <div class="text-gray-600">On-${"end"===t.type?"Time":"Track"} Tasks</div>\n                            </div>\n                            <div class="bg-white rounded p-3 text-center">\n                                <div class="text-2xl font-bold text-orange-600">${s}</div>\n                                <div class="text-gray-600">Total ${t.labels.metric.charAt(0).toUpperCase()+t.labels.metric.slice(1)}</div>\n                            </div>\n                        </div>\n                    </div>\n\n                    ${n.length>0?`\n                    <div class="bg-red-50 border border-red-200 rounded-lg p-4">\n                        <h3 class="text-lg font-semibold text-red-800 mb-4">🚨 ${t.labels.problematic}</h3>\n                        <div class="space-y-3">\n                            ${n.map(e=>generateStandardDelayCard(e,"red",t)).join("")}\n                        </div>\n                    </div>\n                    `:""}\n\n                    ${a.length>0?`\n                    <div class="bg-green-50 border border-green-200 rounded-lg p-4">\n                        <h3 class="text-lg font-semibold text-green-800 mb-4">✅ On-${"end"===t.type?"Time":"Track"} Tasks</h3>\n                        <div class="space-y-2">\n                            ${a.slice(0,10).map(e=>generateStandardDelayCard(e,"green",t)).join("")}\n                            ${a.length>10?`<div class="text-sm text-gray-600 italic">... and ${a.length-10} more tasks</div>`:""}\n                        </div>\n                    </div>\n                    `:""}\n\n                    <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">\n                        <h3 class="text-lg font-semibold text-gray-800 mb-4">📈 ${"end"===t.type?"End Date Extension":"Delay"} Pattern${"end"===t.type?"":" Visualization"}</h3>\n                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">\n                            ${renderStandardChart(e,t)}\n                        </div>\n                    </div>\n                </div>\n            `}function generateStandardDelayCard(e,t,n){const a=e.ticket;return`\n                <div class="border rounded-lg p-3 ${{red:"bg-red-100 border-red-300",green:"bg-green-100 border-green-300"}[t]}">\n                    <div class="flex justify-between items-start">\n                        <div class="flex-1">\n                            <div class="font-semibold text-sm">\n                                ${a.description}\n                                ${e.hasCustomEndDate?'<span class="ml-1 text-xs text-blue-600" title="Custom deadline set">📅</span>':""}\n                            </div>\n                            <div class="text-xs text-gray-600 mt-1">\n                                ${e.delayCount} ${n.labels.metric} • ${e.totalDelayDays} days ${n.labels.action}\n                                ${e.hasCustomEndDate?" • Custom deadline active":""}\n                            </div>\n                        </div>\n                        <div class="text-xs">\n                            Size: ${a.size} • Priority: ${a.priority||"P3"}\n                        </div>\n                    </div>\n                    ${e.history.length>1||e.hasCustomEndDate?`\n                    <div class="mt-2 text-xs">\n                        ${e.history.length>1?`\n                        <div class="font-medium">${"start"===n.type?"Start Date History":"Extension History"}:</div>\n                        ${e.history.map((e,t)=>`\n                            <div class="ml-2">${t+1}. ${formatDate(e[n.dateField])} ${e.reason?`(${e.reason})`:""}</div>\n                        `).join("")}\n                        `:""}\n                        ${e.hasCustomEndDate&&e.history.length<=1?`\n                        <div class="font-medium">Current Status:</div>\n                        <div class="ml-2">• Custom deadline: ${a.customEndDate} (Set via bulk resolution)</div>\n                        `:""}\n                    </div>\n                    `:""}\n                </div>\n            `}function renderStandardChart(e,t){const n={};e.forEach(e=>{const t=e.delayCount;n[t]=(n[t]||0)+1});const a=Math.max(...Object.values(n)),s=Object.keys(n).sort((e,t)=>parseInt(e)-parseInt(t)).map(e=>{const s=n[e],i=s/a*100;return`\n                    <div class="text-center">\n                        <div class="${"0"===e?"bg-green-200 border-green-300":e>="2"?"bg-red-200 border-red-300":"bg-yellow-200 border-yellow-300"} border mx-auto mb-1" style="width: 40px; height: ${Math.max(i,5)}px; max-height: 100px;"></div>\n                        <div class="text-xs">${e} ${t.labels.metric}</div>\n                        <div class="text-xs font-semibold">${s} tasks</div>\n                    </div>\n                `}).join("");return`\n                <div>\n                    <h4 class="font-semibold mb-2">${t.labels.metric.charAt(0).toUpperCase()+t.labels.metric.slice(1)} Distribution</h4>\n                    <div class="flex items-end justify-center space-x-2" style="height: 120px;">\n                        ${s}\n                    </div>\n                </div>\n                <div>\n                    <h4 class="font-semibold mb-2">Key Insights</h4>\n                    <ul class="text-sm space-y-1">\n                        <li>• ${e.filter(e=>0===e.delayCount).length} tasks ${"start"===t.type?"started on original date":"completed on original timeline"}</li>\n                        <li>• ${e.filter(e=>e.delayCount>=1).length} tasks experienced ${t.labels.metric}</li>\n                        <li>• ${e.filter(e=>e.isProblematic).length} tasks need attention</li>\n                        <li>• Avg ${t.labels.metric} per task: ${(e.reduce((e,t)=>e+t.delayCount,0)/e.length).toFixed(1)}</li>\n                    </ul>\n                </div>\n            `}function renderComprehensiveAnalysis(e,t){const n=e.filter(e=>e.isHighRisk),a=e.filter(e=>e.isMediumRisk&&!e.isHighRisk),s=e.filter(e=>!e.isMediumRisk&&!e.isHighRisk);return`\n                <div class="space-y-6">\n                    <div class="bg-${t.bgColor}-50 border border-${t.bgColor}-200 rounded-lg p-4">\n                        <h3 class="text-lg font-semibold text-${t.bgColor}-800 mb-2">${t.title}</h3>\n                        <div class="grid grid-cols-1 md:grid-cols-5 gap-4 text-sm">\n                            <div class="bg-white rounded p-3 text-center">\n                                <div class="text-2xl font-bold text-gray-800">${e.length}</div>\n                                <div class="text-gray-600">Total Tasks</div>\n                            </div>\n                            <div class="bg-white rounded p-3 text-center">\n                                <div class="text-2xl font-bold text-red-600">${n.length}</div>\n                                <div class="text-gray-600">High Risk</div>\n                            </div>\n                            <div class="bg-white rounded p-3 text-center">\n                                <div class="text-2xl font-bold text-orange-600">${a.length}</div>\n                                <div class="text-gray-600">Medium Risk</div>\n                            </div>\n                            <div class="bg-white rounded p-3 text-center">\n                                <div class="text-2xl font-bold text-green-600">${s.length}</div>\n                                <div class="text-gray-600">Low Risk</div>\n                            </div>\n                            <div class="bg-white rounded p-3 text-center">\n                                <div class="text-2xl font-bold text-purple-600">${e.reduce((e,t)=>e+t.totalIssues,0)}</div>\n                                <div class="text-gray-600">Total Issues</div>\n                            </div>\n                        </div>\n                    </div>\n\n                    ${n.length>0?`\n                    <div class="bg-red-50 border border-red-200 rounded-lg p-4">\n                        <h3 class="text-lg font-semibold text-red-800 mb-4">🚨 ${t.labels.highRisk} (Urgent Attention Needed)</h3>\n                        <div class="space-y-3">\n                            ${n.map(e=>generateComprehensiveDelayCard(e,"red")).join("")}\n                        </div>\n                    </div>\n                    `:""}\n\n                    ${a.length>0?`\n                    <div class="bg-orange-50 border border-orange-200 rounded-lg p-4">\n                        <h3 class="text-lg font-semibold text-orange-800 mb-4">⚠️ ${t.labels.mediumRisk} (Monitor Closely)</h3>\n                        <div class="space-y-3">\n                            ${a.map(e=>generateComprehensiveDelayCard(e,"orange")).join("")}\n                        </div>\n                    </div>\n                    `:""}\n\n                    ${s.length>0?`\n                    <div class="bg-green-50 border border-green-200 rounded-lg p-4">\n                        <h3 class="text-lg font-semibold text-green-800 mb-4">✅ ${t.labels.lowRisk}</h3>\n                        <div class="space-y-2">\n                            ${s.slice(0,5).map(e=>generateComprehensiveDelayCard(e,"green")).join("")}\n                            ${s.length>5?`<div class="text-sm text-gray-600 italic">... and ${s.length-5} more low-risk tasks</div>`:""}\n                        </div>\n                    </div>\n                    `:""}\n\n                    <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">\n                        <h3 class="text-lg font-semibold text-gray-800 mb-4">📈 Risk Distribution & Patterns</h3>\n                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">\n                            ${renderComprehensiveChart(e)}\n                        </div>\n                    </div>\n                </div>\n            `}function generateComprehensiveDelayCard(e,t){const n=e.ticket;return`\n                <div class="border rounded-lg p-3 ${{red:"bg-red-100 border-red-300",orange:"bg-orange-100 border-orange-300",green:"bg-green-100 border-green-300"}[t]}">\n                    <div class="flex justify-between items-start">\n                        <div class="flex-1">\n                            <div class="font-semibold text-sm">\n                                Task #${n.id}: ${n.description}\n                            </div>\n                            <div class="text-xs text-gray-600 mt-1">\n                                📅 ${e.startDelayCount} start delays • ⏰ ${e.endDelayCount} deadline extensions • 📏 ${e.sizeChangeCount} size changes\n                            </div>\n                            <div class="text-xs text-gray-600">\n                                Total delay impact: ${e.totalDelayDays} days • Risk score: ${e.totalIssues} issues\n                            </div>\n                        </div>\n                        <div class="text-xs">\n                            ${n.assigned.join(", ")}\n                        </div>\n                    </div>\n                    ${e.startHistory.length>1||e.endHistory.length>1||e.sizeHistory.length>1?`\n                    <div class="mt-2 text-xs">\n                        ${e.startHistory.length>1?`\n                        <div class="text-gray-700 font-medium">Start Date Changes:</div>\n                        ${e.startHistory.slice(1).map(e=>`<div class="ml-2">• ${e.date} ${e.reason?`(${e.reason})`:""}</div>`).join("")}\n                        `:""}\n                        ${e.endHistory.length>1?`\n                        <div class="text-gray-700 font-medium mt-1">End Date Extensions:</div>\n                        ${e.endHistory.slice(1).map(e=>`<div class="ml-2">• ${e.endDate} ${e.reason?`(${e.reason})`:""}</div>`).join("")}\n                        `:""}\n                        ${e.sizeHistory.length>1?`\n                        <div class="text-gray-700 font-medium mt-1">Size Changes:</div>\n                        ${e.sizeHistory.slice(1).map(e=>`<div class="ml-2">• ${e.oldSize} → ${e.newSize} ${e.reason?`(${e.reason})`:""}</div>`).join("")}\n                        `:""}\n                    </div>\n                    `:""}\n                </div>\n            `}function renderComprehensiveChart(e){const t={"High Risk":e.filter(e=>e.isHighRisk).length,"Medium Risk":e.filter(e=>e.isMediumRisk&&!e.isHighRisk).length,"Low Risk":e.filter(e=>!e.isMediumRisk&&!e.isHighRisk).length},n=Math.max(...Object.values(t));return`\n                <div>\n                    <h4 class="font-semibold mb-2">Risk Distribution</h4>\n                    <div class="flex items-end justify-center space-x-4" style="height: 120px;">\n                        ${Object.entries(t).map(([e,t])=>`\n                    <div class="flex flex-col items-center">\n                        <div class="${"High Risk"===e?"bg-red-500":"Medium Risk"===e?"bg-orange-500":"bg-green-500"}" style="width: 40px; height: ${n>0?t/n*100:0}px; min-height: 4px;"></div>\n                        <div class="text-xs mt-1">${t}</div>\n                        <div class="text-xs text-gray-600">${e}</div>\n                    </div>\n                `).join("")}\n                    </div>\n                </div>\n                <div>\n                    <h4 class="font-semibold mb-2">Key Risk Indicators</h4>\n                    <ul class="text-sm space-y-1">\n                        <li>• ${e.filter(e=>e.startDelayCount>0).length} tasks had start delays</li>\n                        <li>• ${e.filter(e=>e.endDelayCount>0).length} tasks had deadline extensions</li>\n                        <li>• ${e.filter(e=>e.sizeChangeCount>0).length} tasks had size changes</li>\n                        <li>• Avg issues per task: ${(e.reduce((e,t)=>e+t.totalIssues,0)/e.length).toFixed(1)}</li>\n                        <li>• Total delay impact: ${e.reduce((e,t)=>e+t.totalDelayDays,0)} days</li>\n                    </ul>\n                </div>\n            `}function generateDelayAnalysis(){generateDelayAnalysisGeneric("start")}function generateEndDateDelayAnalysis(){generateDelayAnalysisGeneric("end")}function generateComprehensiveDelayAnalysis(){generateDelayAnalysisGeneric("comprehensive")}function closeDelayAnalysis(){document.getElementById("delayAnalysisModal").classList.add("hidden")}function openBulkTaskResolution(){const e=getOverdueInProgressTasks();0!==e.length?(renderBulkTaskResolutionContent(e),document.getElementById("bulkTaskResolutionModal").classList.remove("hidden")):alert('✅ No overdue "In Progress" tasks found!\n\nAll tasks are either on track or not yet in progress.')}function closeBulkTaskResolution(){document.getElementById("bulkTaskResolutionModal").classList.add("hidden")}function getOverdueInProgressTasks(){const e=new Date;e.setHours(0,0,0,0);const t=getProjectedTickets();return tickets.filter(n=>{if("In Progress"!==n.status)return!1;const a=t.find(e=>e.id===n.id);if(!a||!a.rawEndDate)return!1;const s=new Date(a.rawEndDate);return s.setHours(0,0,0,0),s<e})}function renderBulkTaskResolutionContent(e){const t=getProjectedTickets();let n=`\n                <div class="space-y-4">\n                    <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-4">\n                        <h3 class="text-lg font-semibold text-yellow-800 mb-2">📊 Summary</h3>\n                        <p class="text-yellow-700">\n                            Found <strong>${e.length}</strong> overdue "In Progress" task${1!==e.length?"s":""} that need resolution.\n                        </p>\n                    </div>\n            `;e.forEach(e=>{const a=t.find(t=>t.id===e.id),s=a?new Date(a.rawEndDate):null,i=s?Math.floor((new Date-s)/864e5):0;n+=`\n                    <div class="border border-gray-200 rounded-lg p-4 bg-white" id="task-${e.id}">\n                        <div class="flex justify-between items-start mb-3">\n                            <div class="flex-1">\n                                <h4 class="text-lg font-semibold text-gray-800">Task #${e.id}: ${e.description}</h4>\n                                <div class="text-sm text-gray-600 mt-1">\n                                    <span class="inline-block mr-4">📅 Started: ${e.startDate}</span>\n                                    <span class="inline-block mr-4">📊 Size: ${e.size} (${taskSizeDefinitions[e.size]?.days||0} days)</span>\n                                    <span class="inline-block mr-4">👥 Assigned: ${e.assigned.join(", ")}</span>\n                                </div>\n                                <div class="text-sm mt-1">\n                                    <span class="text-red-600 font-medium">\n                                        🚨 Overdue by ${i} day${1!==i?"s":""}\n                                        (expected completion: ${s?s.toLocaleDateString():"Unknown"})\n                                    </span>\n                                </div>\n                            </div>\n                        </div>\n\n                        <div class="grid grid-cols-1 md:grid-cols-3 gap-3">\n                            \x3c!-- Mark Done --\x3e\n                            <div class="bg-green-50 border border-green-200 rounded p-3">\n                                <h5 class="font-medium text-green-800 mb-2">✅ Mark as Done</h5>\n                                <button onclick="markTaskDone(${e.id})"\n                                        class="w-full px-3 py-2 bg-green-600 text-white rounded hover:bg-green-700 transition-colors">\n                                    Complete Task\n                                </button>\n                            </div>\n\n                            \x3c!-- Pause with Comment --\x3e\n                            <div class="bg-yellow-50 border border-yellow-200 rounded p-3">\n                                <h5 class="font-medium text-yellow-800 mb-2">⏸️ Pause Task</h5>\n                                <textarea id="pause-comment-${e.id}" placeholder="Reason for pausing..."\n                                          class="w-full p-2 border border-yellow-300 rounded text-sm mb-2 h-16 resize-none"></textarea>\n                                <button onclick="pauseTaskWithComment(${e.id})"\n                                        class="w-full px-3 py-2 bg-yellow-600 text-white rounded hover:bg-yellow-700 transition-colors">\n                                    Pause Task\n                                </button>\n                            </div>\n\n                            \x3c!-- Extend End Date --\x3e\n                            <div class="bg-blue-50 border border-blue-200 rounded p-3">\n                                <h5 class="font-medium text-blue-800 mb-2">📅 Extend Deadline</h5>\n                                <input type="date" id="new-end-date-${e.id}"\n                                       class="w-full p-2 border border-blue-300 rounded text-sm mb-2"\n                                       min="${getLocalDateString(new Date)}"\n                                       onchange="validateNewEndDate(${e.id})">\n                                <div id="size-info-${e.id}" class="text-xs text-blue-600 mb-2 min-h-[2rem]">\n                                    Select a new end date to see size impact\n                                </div>\n                                <button onclick="extendTaskDeadline(${e.id})"\n                                        id="extend-btn-${e.id}"\n                                        class="w-full px-3 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors disabled:bg-gray-400"\n                                        disabled>\n                                    Extend Deadline\n                                </button>\n                            </div>\n                        </div>\n                    </div>\n                `}),n+='\n                </div>\n                <div class="mt-6 pt-4 border-t border-gray-200 text-center">\n                    <button onclick="closeBulkTaskResolution()"\n                            class="px-6 py-2 bg-gray-500 text-white rounded hover:bg-gray-600 transition-colors">\n                        Close\n                    </button>\n                </div>\n            ',document.getElementById("bulkTaskResolutionContent").innerHTML=n}function markTaskDone(e){const t=tickets.find(t=>t.id===e);if(!t)return;const n=t.status;t.status="Done",console.log(`✅ Marked task #${e} as Done (was: ${n})`);const a=document.getElementById(`task-${e}`);a&&(a.style.opacity="0.5",a.innerHTML='\n                    <div class="text-center py-4">\n                        <div class="text-green-600 font-semibold">✅ Task marked as Done!</div>\n                        <div class="text-sm text-gray-600 mt-1">Status updated successfully</div>\n                    </div>\n                '),saveToLocalStorage(),selectedStatusFilters=[];renderTickets(getProjectedTickets()),setTimeout(()=>checkAllTasksResolved(),1e3)}function pauseTaskWithComment(e){const t=tickets.find(t=>t.id===e);if(!t)return;const n=document.getElementById(`pause-comment-${e}`).value.trim();if(!n)return void alert("Please provide a reason for pausing this task.");const a=t.status;t.status="Paused",t.pauseComments||(t.pauseComments=[]),t.pauseComments.push({comment:n,timestamp:(new Date).toISOString(),action:"Paused from bulk resolution"}),console.log(`⏸️ Paused task #${e} (was: ${a}): ${n}`);const s=document.getElementById(`task-${e}`);s&&(s.style.opacity="0.5",s.innerHTML=`\n                    <div class="text-center py-4">\n                        <div class="text-yellow-600 font-semibold">⏸️ Task paused!</div>\n                        <div class="text-sm text-gray-600 mt-1">Reason: ${n}</div>\n                    </div>\n                `),saveToLocalStorage(),selectedStatusFilters=[];renderTickets(getProjectedTickets()),setTimeout(()=>checkAllTasksResolved(),1e3)}function validateNewEndDate(e){const t=tickets.find(t=>t.id===e);if(!t)return;const n=document.getElementById(`new-end-date-${e}`),a=document.getElementById(`size-info-${e}`),s=document.getElementById(`extend-btn-${e}`),i=n.value;if(!i)return a.innerHTML="Select a new end date to see size impact",void(s.disabled=!0);const o=calculateBusinessDays(new Date(t.startDate),new Date(i)),r=calculateSizeFromDays(o),l=getMaximumSize(),d=taskSizeDefinitions[l]?.days||0;if(o>d){const e=addBusinessDays(new Date(t.startDate),d-1).toLocaleDateString("en-GB");a.innerHTML=`\n                    <span class="text-red-600">\n                        ❌ Duration too long: ${o} business days exceeds maximum (${d} days for ${l}). Latest allowed is ${e}\n                    </span>\n                `,s.disabled=!0}else{const e=t.size,n=taskSizeDefinitions[e]?.days||0;a.innerHTML=`\n                    <div class="text-blue-700">\n                        📊 New duration: ${o} business days<br>\n                        📏 Size change: ${e} (${n}d) → ${r} (${taskSizeDefinitions[r]?.days||0}d)\n                    </div>\n                `,s.disabled=!1}}function calculateSizeFromDays(e){const t=Object.keys(taskSizeDefinitions).sort((e,t)=>taskSizeDefinitions[e].days-taskSizeDefinitions[t].days);for(const n of t)if(taskSizeDefinitions[n].days>=e)return n;return t[t.length-1]}function getMaximumSize(){let e="S",t=0;for(const[n,a]of Object.entries(taskSizeDefinitions))a.days>t&&(t=a.days,e=n);return e}function extendTaskDeadline(e){const t=tickets.find(t=>t.id===e);if(!t)return;const n=document.getElementById(`new-end-date-${e}`).value;if(!n)return void alert("Please select a new end date.");const a=calculateBusinessDays(new Date(t.startDate),new Date(n)),s=t.size,i=calculateSizeFromDays(a);trackSizeChange(t,s,i,"Deadline extension via bulk resolution");const o=getProjectedTickets().find(t=>t.id===e),r=o?o.rawEndDate:null;r&&trackEndDateChange(t,r,n,"Deadline extension via bulk resolution"),t.size=i,t.customEndDate=n,console.log(` Extended deadline for task #${e}: ${s} → ${i} (${a} business days)`);const l=document.getElementById(`task-${e}`);l&&(l.style.opacity="0.5",l.innerHTML=`\n                    <div class="text-center py-4">\n                        <div class="text-blue-600 font-semibold">📅 Deadline extended!</div>\n                        <div class="text-sm text-gray-600 mt-1">\n                            Size updated: ${s} → ${i}<br>\n                            New target: ${new Date(n).toLocaleDateString()}\n                        </div>\n                    </div>\n                `),saveToLocalStorage();renderTickets(getProjectedTickets()),setTimeout(()=>checkAllTasksResolved(),1e3)}function checkAllTasksResolved(){0===getOverdueInProgressTasks().length&&(document.getElementById("bulkTaskResolutionContent").innerHTML='\n                    <div class="text-center py-8">\n                        <div class="text-6xl mb-4">🎉</div>\n                        <h3 class="text-2xl font-bold text-green-600 mb-2">All Tasks Resolved!</h3>\n                        <p class="text-gray-600 mb-4">Great job! All overdue tasks have been addressed.</p>\n                        <button onclick="closeBulkTaskResolution()"\n                                class="px-6 py-3 bg-green-600 text-white rounded hover:bg-green-700 transition-colors">\n                            Close\n                        </button>\n                    </div>\n                ')}function generateCompletionGraph(){console.log("📈 Generating completion projection graph...");const e=getProjectedTickets();if(console.log("🔍 Projected tickets:",e),0===e.length)return void alert("No tasks found to generate completion graph. Please add some tasks first.");const t=e.filter(e=>e.rawEndDate&&"N/A"!==e.rawEndDate).sort((e,t)=>new Date(e.rawEndDate)-new Date(t.rawEndDate));if(console.log("🔍 Filtered and sorted tasks:",t),0===t.length)return void alert("No scheduled tasks found. Please ensure tasks have valid start dates and team assignments.");const n=[];let a=0;t.forEach((e,t)=>{a++,n.push({taskNumber:a,completionDate:formatDate(getLocalDateString(e.rawEndDate)),task:e,dateString:getLocalDateString(e.rawEndDate)})}),console.log("📊 Graph data prepared:",n),document.getElementById("completionGraphModal").classList.remove("hidden"),renderCompletionChart(n)}function renderCompletionChart(e){const t=document.getElementById("completionGraphContent"),n=[...new Set(e.map(e=>e.dateString))].sort(),a=(n.map(e=>formatDate(e)),[]);let s=0;n.forEach(t=>{const n=e.filter(e=>e.dateString===t).length;s+=n,a.push({date:t,dateLabel:formatDate(t),cumulativeCount:s,tasksThisDate:n})});let i=`\n                <div class="w-full h-full bg-gray-50 border rounded-lg p-4">\n                    <div class="mb-4">\n                        <h3 class="text-lg font-semibold text-gray-800 mb-2">Task Completion Timeline</h3>\n                        <div class="mb-4 p-3 bg-blue-50 border border-blue-200 rounded text-sm text-blue-800">\n                            <p><strong>📊 Chart Explanation:</strong> This graph shows the projected completion dates for all tasks based on current scheduling and team capacity. The line shows cumulative tasks completed over time, with each point representing when tasks are scheduled to finish.</p>\n                        </div>\n                        <p class="text-sm text-gray-600">Showing projected completion dates for ${e.length} scheduled tasks across ${n.length} completion dates</p>\n                    </div>\n\n                    <div class="relative h-64 mb-6 bg-white border rounded">\n                        \x3c!-- Y-axis labels (Task Count) --\x3e\n                        <div class="absolute left-0 top-0 bottom-0 w-12 flex flex-col justify-between text-xs text-gray-500 py-4">\n                            <span>${e.length}</span>\n                            <span>${Math.floor(.75*e.length)}</span>\n                            <span>${Math.floor(.5*e.length)}</span>\n                            <span>${Math.floor(.25*e.length)}</span>\n                            <span>0</span>\n                        </div>\n\n                        \x3c!-- Chart area --\x3e\n                        <div class="ml-12 h-full relative">\n                            <svg class="w-full h-full" viewBox="0 0 800 200">\n                                \x3c!-- Grid lines --\x3e\n                                ${generateGridLines(e.length)}\n\n                                \x3c!-- Data points and line --\x3e\n                                ${generateRealisticChartPath(a,800,200,e.length)}\n\n                                \x3c!-- Data points --\x3e\n                                ${generateRealisticDataPoints(a,800,200,e.length)}\n                            </svg>\n                        </div>\n\n                        \x3c!-- X-axis labels (Dates) --\x3e\n                        <div class="ml-12 mt-2 flex justify-between text-xs text-gray-500">\n                            ${generateDateLabels(a)}\n                        </div>\n                    </div>\n\n                    \x3c!-- Task list --\x3e\n                    <div class="max-h-48 overflow-y-auto">\n                        <h4 class="font-semibold mb-2 text-gray-800">Task Details:</h4>\n                        <div class="space-y-1">\n                            ${e.map(e=>`\n                                <div class="flex justify-between items-center p-2 bg-gray-50 rounded text-sm">\n                                    <span class="font-medium text-blue-600">Task #${e.taskNumber}</span>\n                                    <span class="text-gray-600">${e.task.description}</span>\n                                    <span class="text-gray-800 font-medium">${e.completionDate}</span>\n                                </div>\n                            `).join("")}\n                        </div>\n                    </div>\n                </div>\n            `;t.innerHTML=i}function generateGridLines(e){let t="";for(let e=0;e<=4;e++){const n=e/4*200;t+=`<line x1="0" y1="${n}" x2="800" y2="${n}" stroke="#e5e7eb" stroke-width="1"/>`}return t}function generateChartPath(e,t,n){if(e.length<2)return"";let a="";return e.forEach((s,i)=>{const o=i/(e.length-1)*t,r=n-s.taskNumber/e.length*n;a+=0===i?`M ${o} ${r}`:` L ${o} ${r}`}),`<path d="${a}" stroke="#3b82f6" stroke-width="2" fill="none"/>`}function generateRealisticChartPath(e,t,n,a){if(e.length<2)return"";let s="";return e.forEach((i,o)=>{const r=o/(e.length-1)*t,l=n-i.cumulativeCount/a*n;s+=0===o?`M ${r} ${l}`:` L ${r} ${l}`}),`<path d="${s}" stroke="#3b82f6" stroke-width="2" fill="none"/>`}function generateDataPoints(e,t,n){return e.map((a,s)=>`<circle cx="${s/(e.length-1)*t}" cy="${n-a.taskNumber/e.length*n}" r="4" fill="#3b82f6" stroke="white" stroke-width="2">\n                    <title>Task ${a.taskNumber}: ${a.task.description} - ${a.completionDate}</title>\n                </circle>`).join("")}function generateRealisticDataPoints(e,t,n,a){return e.map((s,i)=>`<circle cx="${i/(e.length-1)*t}" cy="${n-s.cumulativeCount/a*n}" r="4" fill="#3b82f6" stroke="white" stroke-width="2">\n                    <title>${s.cumulativeCount} tasks completed by ${s.dateLabel} (${s.tasksThisDate} task${s.tasksThisDate>1?"s":""} completing this date)</title>\n                </circle>`).join("")}function generateDateLabels(e){if(e.length<=3)return e.map(e=>`<span>${e.dateLabel}</span>`).join("");const t=e[0],n=e[Math.floor(e.length/2)],a=e[e.length-1];return`\n                <span>${t.dateLabel}</span>\n                <span>${n.dateLabel}</span>\n                <span>${a.dateLabel}</span>\n            `}function closeCompletionGraph(){document.getElementById("completionGraphModal").classList.add("hidden")}function getEndDateFormula(){return"How Task End Dates are Calculated:\n\n1. FIXED-LENGTH TASKS (Default - marked with 🔒):\n   • Duration = Task Size (in days)\n   • Multiple people do NOT reduce the duration\n   • People work in parallel on different aspects\n\n   Formula: End Date = Start Date + Task Size Days\n\n   Example 1: 10-day task (XL) with 1 person\n     → Takes 10 business days\n\n   Example 2: 10-day task (XL) with 5 people\n     → Still takes 10 business days\n     → Each person works 20% capacity (10 days ÷ 5 people)\n\n2. FLEXIBLE TASKS (Opt-in - marked with ⚡):\n   • Duration = Task Size ÷ Number of Assignees\n   • More people = shorter duration (work is divided)\n   • People work on same tasks, splitting the effort\n\n   Formula: End Date = Start Date + (Task Size Days ÷ Number of Assignees)\n\n   Example 1: 10-day task with 1 person\n     → Takes 10 business days (100% capacity)\n\n   Example 2: 10-day task with 2 people\n     → Takes 5 business days (100% capacity each)\n\n   Example 3: 10-day task with 5 people\n     → Takes 2 business days (100% capacity each)\n\n3. WEEKEND HANDLING (Both task types):\n   • All dates automatically skip weekends (Saturday/Sunday)\n   • If a calculated end date falls on Saturday: moved to Monday\n   • If a calculated end date falls on Sunday: moved to Monday\n   • Only business days (Monday-Friday) count toward duration\n\n4. CUSTOM END DATES:\n   • You can manually override any calculated end date\n   • Useful for external deadlines or dependencies\n   • Custom dates are preserved until you clear them\n\n5. TASK SIZES:\n   • S (Small) = 1 day\n   • M (Medium) = 2 days\n   • L (Large) = 5 days\n   • XL (Extra Large) = 10 days\n   • XXL (Extra Extra Large) = 15 days\n   • Custom sizes can be configured"}function getHeatMapFormula(){return"How Team Workload Heat Map Cells are Calculated:\n\n1. WEEK GROUPING:\n   • Heat map shows the next 8 weeks from today (or earliest task)\n   • Each column represents one week (Monday to Friday)\n   • Weekends (Saturday/Sunday) are excluded from calculations\n\n2. CAPACITY CALCULATION PER PERSON PER WEEK:\n   • Each person has a weekly availability (e.g., 25 hours/week)\n   • Tasks consume capacity based on task type and assignees\n\n   For FIXED-LENGTH TASKS (🔒):\n     Capacity per Person = (Task Size × Base Hours) ÷ Number of Assignees ÷ Task Duration\n\n     Example: 10-day task, 5 base hours/day, 2 people\n       → Total effort: 10 days × 5 hours = 50 hours\n       → Per person: 50 hours ÷ 2 people = 25 hours each\n       → Duration: 10 business days (not reduced)\n       → Weekly capacity: 25 hours ÷ 2 weeks = 12.5 hours/week\n\n   For FLEXIBLE TASKS (⚡):\n     Capacity per Person = (Task Size × Base Hours) ÷ Task Duration\n\n     Example: 10-day task, 5 base hours/day, 2 people\n       → Total effort: 10 days × 5 hours = 50 hours\n       → Duration: 10 days ÷ 2 people = 5 business days\n       → Per person: 50 hours (each does full work faster)\n       → Weekly capacity: 50 hours ÷ 1 week = 50 hours/week\n\n3. UTILIZATION PERCENTAGE:\n   • Utilization % = (Hours Consumed ÷ Available Hours) × 100\n\n   Example: Person with 25 hours/week availability\n     • 10 hours consumed → 40% utilization (Green - under capacity)\n     • 25 hours consumed → 100% utilization (Yellow - at capacity)\n     • 35 hours consumed → 140% utilization (Red - overallocated)\n\n4. COLOR CODING:\n   • 0-50%: Light green (plenty of capacity)\n   • 51-80%: Yellow-green (moderate load)\n   • 81-100%: Yellow (at capacity)\n   • 101-120%: Orange (slightly overallocated)\n   • 121%+: Red (significantly overallocated)\n\n5. TASK STATUS FILTERING:\n   • Only active tasks are included (To Do, In Progress)\n   • Done, Paused, and Closed tasks are excluded\n   • This shows current/future workload only\n\n6. MULTI-TASK ALLOCATION:\n   • If a person has multiple tasks in the same week\n   • All task capacities are summed together\n   • This can lead to >100% utilization (overallocation)\n\n7. CLICKING A CELL:\n   • Shows all tasks for that person in that week\n   • Displays capacity breakdown per task\n   • Allows toggling between Fixed/Flexible task types"}function showEndDateFormula(){const e=getEndDateFormula();document.getElementById("formula-modal-title").textContent="📅 End Date Calculation Formula",document.getElementById("formula-modal-content").textContent=e,document.getElementById("formula-modal").classList.add("active")}function showHeatMapFormula(){const e=getHeatMapFormula();document.getElementById("formula-modal-title").textContent="📊 Heat Map Calculation Formula",document.getElementById("formula-modal-content").textContent=e,document.getElementById("formula-modal").classList.add("active")}function closeFormulaModal(){document.getElementById("formula-modal").classList.remove("active")}document.addEventListener("click",function(e){const t=document.getElementById("week-task-modal");e.target===t&&closeWeekTaskModal()}),document.addEventListener("click",function(e){const t=document.getElementById("delayAnalysisModal");e.target===t&&closeDelayAnalysis()}),document.addEventListener("click",function(e){const t=document.getElementById("bulkTaskResolutionModal");e.target===t&&closeBulkTaskResolution()}),document.addEventListener("click",function(e){const t=document.getElementById("completionGraphModal");e.target===t&&closeCompletionGraph()}),document.addEventListener("click",function(e){const t=document.getElementById("formula-modal");e.target===t&&closeFormulaModal()}),window.onload=initializeScheduler;
</script></body></html>
